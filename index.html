<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Cairo&family=Roboto&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <link rel="icon" type="image/x-icon" href="img//icon1.jpg">

  <style>
    /* ====== المتغيرات والألوان الأساسية ====== */
    :root {
      --primary-color: #ff6b35;
      --secondary-color: #1a73e8;
      --accent-color: #ffab00;
      --dark-bg: #121212;
      --darker-bg: #0d0d0d;
      --card-bg: #1e1e1e;
      --card-hover: #2a2a2a;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --text-muted: #888888;
      --success-color: #4caf50;
      --warning-color: #ff9800;
      --danger-color: #f44336;
      --border-color: #333333;
      --shadow-light: rgba(255, 107, 53, 0.1);
      --shadow-medium: rgba(0, 0, 0, 0.3);
      --gradient-primary: linear-gradient(135deg, #ff6b35, #ff8e53);
      --gradient-secondary: linear-gradient(135deg, #1a73e8, #4285f4);
      --gradient-accent: linear-gradient(135deg, #ffab00, #ffca28);
      --gradient-dark: linear-gradient(135deg, #1e1e1e, #2d2d2d);
      --border-radius-sm: 8px;
      --border-radius-md: 12px;
      --border-radius-lg: 16px;
      --transition-speed: 0.3s;
    }

    /* ====== نص اللغة الإنجليزية ====== */
    :root[lang="en"] {
      font-family: 'Roboto', sans-serif;
    }

    :root[lang="en"] .rtl-text {
      display: none;
    }

    :root[lang="ar"] .ltr-text {
      display: none;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ====== الجسم العام ====== */
    body {
      font-family: 'Cairo', 'Amiri', sans-serif;
      background: var(--dark-bg);
      color: var(--text-primary);
      overflow-x: hidden;
      min-height: 100vh;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(255, 107, 53, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(26, 115, 232, 0.05) 0%, transparent 20%);
    }

    /* ====== الخلفية ====== */
    #img1 {
      position: fixed;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
      z-index: -1;
      opacity: 0.3;
      object-fit: cover;
      filter: brightness(0.4) saturate(1.5);
    }

    /* ====== الشريط العلوي ====== */
    .top {
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      height: 70px;
      z-index: 100;
      background: rgba(18, 18, 18, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 4px 12px var(--shadow-medium);
    }

    #icon {
      height: 50px;
      border-radius: var(--border-radius-sm);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .top-icons {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--gradient-dark);
      border-radius: 50%;
      transition: all var(--transition-speed);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .icon-wrapper:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      background: var(--gradient-primary);
    }

    .icon-wrapper i {
      font-size: 20px;
      color: var(--text-primary);
    }

    #cart-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--gradient-primary);
      color: white;
      font-size: 11px;
      font-weight: bold;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      z-index: 101;
    }

    /* ====== قسم الترحيب المتحرك ====== */
    .top2 {
      position: relative;
      top: 70px;
      width: 100%;
      height: 140px;
      background: var(--gradient-dark);
      overflow: hidden;
      border-bottom: 1px solid var(--border-color);
    }

    .welcome-banner {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 0 20px;
      animation: slideIn 1s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .welcome-icon {
      width: 60px;
      height: 60px;
      background: var(--gradient-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .welcome-text {
      font-size: 24px;
      font-weight: bold;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* ====== البطاقات الرئيسية ====== */
    .main-content {
      padding: 90px 20px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 28px;
      font-weight: bold;
      margin: 40px 0 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      color: var(--accent-color);
    }

    .section-subtitle {
      color: var(--text-secondary);
      font-size: 16px;
      margin-bottom: 25px;
    }

    /* ====== بطاقات المنتجات ====== */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .product-card {
      background: var(--gradient-dark);
      border-radius: var(--border-radius-lg);
      overflow: hidden;
      transition: all var(--transition-speed);
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;
      cursor: pointer;
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 20px rgba(0,0,0,0.3);
      border-color: var(--primary-color);
    }

    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: transform 0.5s;
    }

    .product-card:hover .card-image {
      transform: scale(1.05);
    }

    .card-content {
      padding: 20px;
    }

    .card-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .card-category {
      color: var(--accent-color);
      font-size: 14px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .card-description {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }

    .card-price {
      font-size: 20px;
      font-weight: bold;
      color: var(--success-color);
    }

    .card-button {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: var(--border-radius-sm);
      font-weight: bold;
      cursor: pointer;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px var(--shadow-light);
    }

    /* ====== أقسام التمرير الأفقي ====== */
    .scroll-section {
      margin: 40px 0;
      position: relative;
    }

    .scroll-container {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding: 10px 0;
      scrollbar-width: thin;
      scrollbar-color: var(--primary-color) var(--darker-bg);
      scroll-behavior: smooth;
    }

    .scroll-container::-webkit-scrollbar {
      height: 8px;
    }

    .scroll-container::-webkit-scrollbar-track {
      background: var(--darker-bg);
      border-radius: 4px;
    }

    .scroll-container::-webkit-scrollbar-thumb {
      background: var(--gradient-primary);
      border-radius: 4px;
    }

    .scroll-item {
      flex: 0 0 auto;
      width: 160px;
      background: var(--card-bg);
      border-radius: var(--border-radius-md);
      overflow: hidden;
      transition: all var(--transition-speed);
      border: 1px solid var(--border-color);
      cursor: pointer;
    }

    .scroll-item:hover {
      transform: translateY(-4px);
      border-color: var(--primary-color);
    }

    .scroll-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .scroll-info {
      padding: 12px;
    }

    .scroll-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .scroll-type {
      font-size: 12px;
      color: var(--accent-color);
    }

    /* ====== أزرار التنقل للقسم المانجا ====== */
    .manga-navigation {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 25px;
      padding: 10px;
    }

    .nav-button {
      background: var(--gradient-dark);
      color: var(--text-primary);
      border: 2px solid var(--primary-color);
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-speed);
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .nav-button:hover {
      background: var(--gradient-primary);
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(255, 107, 53, 0.3);
    }

    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: var(--text-muted);
    }

    .nav-button:disabled:hover {
      background: var(--gradient-dark);
      transform: none;
    }

    .manga-counter {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .page-dots {
      display: flex;
      gap: 8px;
      margin: 0 15px;
    }

    .page-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition-speed);
    }

    .page-dot.active {
      background: var(--primary-color);
      transform: scale(1.2);
    }

    .page-dot:hover {
      background: var(--accent-color);
    }

    /* ====== تبويبات الفيديوهات ====== */
    .video-tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: var(--border-radius-sm);
      padding: 5px;
      margin: 30px 0;
      overflow-x: auto;
      gap: 5px;
    }

    .video-tab {
      flex: 1;
      text-align: center;
      padding: 12px 15px;
      cursor: pointer;
      transition: all var(--transition-speed);
      border-radius: var(--border-radius-sm);
      font-weight: bold;
      white-space: nowrap;
      min-width: 120px;
    }

    .video-tab.active {
      background: var(--gradient-primary);
      color: white;
    }

    .video-tab-content {
      display: none;
      position: relative;
    }

    .video-tab-content.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    /* ====== أزرار التنقل للفيديوهات والروايات ====== */
    .content-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      padding: 15px 0;
      border-top: 1px solid var(--border-color);
    }

    .content-nav-button {
      background: var(--gradient-dark);
      color: var(--text-primary);
      border: 2px solid var(--primary-color);
      padding: 10px 25px;
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: all var(--transition-speed);
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .content-nav-button:hover {
      background: var(--gradient-primary);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(255, 107, 53, 0.3);
    }

    .content-nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: var(--text-muted);
    }

    .content-nav-button:disabled:hover {
      background: var(--gradient-dark);
      transform: none;
      box-shadow: none;
    }

    .content-nav-info {
      color: var(--text-secondary);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* ====== قسم الفيديوهات ====== */
    .video-section {
      background: var(--gradient-dark);
      border-radius: var(--border-radius-lg);
      padding: 25px;
      margin: 40px 0;
      border: 1px solid var(--border-color);
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .video-card {
      background: var(--card-bg);
      border-radius: var(--border-radius-md);
      overflow: hidden;
      transition: all var(--transition-speed);
      cursor: pointer;
    }

    .video-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }

    .video-player {
      width: 100%;
      height: 140px;
      background: var(--darker-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .video-player::before {
      content: '▶';
      position: absolute;
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--primary-color);
      opacity: 0.8;
      transition: all var(--transition-speed);
    }

    .video-card:hover .video-player::before {
      opacity: 1;
      transform: scale(1.1);
    }

    .video-info {
      padding: 15px;
    }

    .video-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .video-duration {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* ====== لوحة تفاصيل المنتج - نسخة محسنة ====== */
    .product-detail-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.98);
      z-index: 2000;
      overflow-y: auto;
      animation: fadeIn 0.3s ease-out;
      padding: 0;
      margin: 0;
    }

    .product-detail-container {
      width: 100%;
      min-height: 100vh;
      margin: 0;
      background: var(--gradient-dark);
      display: flex;
      flex-direction: column;
    }

    .product-detail-header {
      padding: 25px 30px 15px;
      background: var(--gradient-primary);
      position: sticky;
      top: 0;
      z-index: 10;
      flex-shrink: 0;
    }

    .close-product-detail {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all var(--transition-speed);
    }

    .close-product-detail:hover {
      background: rgba(255,255,255,0.3);
      transform: rotate(90deg);
    }

    .product-detail-title {
      font-size: 28px;
      font-weight: bold;
      color: white;
      margin-bottom: 5px;
      margin-right: 50px;
    }

    .product-detail-main {
      flex: 1;
      padding: 20px;
    }

    .product-detail-content {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .product-detail-content {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    .product-detail-poster {
      position: sticky;
      top: 100px;
      align-self: start;
    }

    .product-detail-poster img {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      border-radius: var(--border-radius-lg);
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
    }

    .product-detail-info {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .product-detail-meta {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }

    .product-detail-category {
      background: var(--gradient-primary);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .product-detail-price {
      font-size: 28px;
      font-weight: bold;
      color: var(--success-color);
    }

    .product-detail-rating {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stars {
      color: var(--accent-color);
      font-size: 18px;
    }

    .rating-value {
      font-weight: bold;
      font-size: 18px;
    }

    /* قسم معلومات المنتج الجديد */
    .product-detail-summary {
      background: rgba(255,255,255,0.05);
      padding: 25px;
      border-radius: var(--border-radius-lg);
      border: 1px solid var(--border-color);
      margin-bottom: 20px;
    }

    .product-detail-summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .summary-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      background: var(--card-bg);
      border-radius: var(--border-radius-md);
      border: 1px solid var(--border-color);
    }

    .summary-item i {
      color: var(--accent-color);
      font-size: 18px;
    }

    .summary-label {
      font-weight: bold;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .summary-value {
      font-weight: bold;
      color: var(--text-primary);
      font-size: 16px;
    }

    .product-detail-description {
      font-size: 18px;
      line-height: 1.8;
      color: var(--text-secondary);
      padding: 25px;
      background: rgba(255,255,255,0.05);
      border-radius: var(--border-radius-lg);
      border: 1px solid var(--border-color);
    }

    .product-detail-sections {
      margin-top: 30px;
    }

    .product-detail-section {
      margin-bottom: 30px;
    }

    .section-label {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border-color);
    }

    .chapters-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .chapter-item {
      background: var(--card-bg);
      padding: 15px 20px;
      border-radius: var(--border-radius-md);
      border: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all var(--transition-speed);
    }

    .chapter-item:hover {
      border-color: var(--primary-color);
      transform: translateX(5px);
    }

    .chapter-info h4 {
      margin-bottom: 5px;
      font-size: 16px;
    }

    .chapter-duration {
      color: var(--text-muted);
      font-size: 14px;
    }

    .watch-button {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
    }

    .watch-button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px var(--shadow-light);
    }

    .comments-section {
      margin-top: 20px;
    }

    .comment-item {
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--border-radius-md);
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      align-items: center;
    }

    .comment-author {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 16px;
    }

    .comment-date {
      color: var(--text-muted);
      font-size: 14px;
    }

    .comment-text {
      color: var(--text-secondary);
      line-height: 1.6;
      font-size: 15px;
    }

    .add-comment {
      margin-top: 30px;
      background: rgba(255,255,255,0.05);
      padding: 25px;
      border-radius: var(--border-radius-md);
      border: 1px solid var(--border-color);
    }

    .comment-input {
      width: 100%;
      padding: 15px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-sm);
      color: var(--text-primary);
      font-family: inherit;
      margin-bottom: 15px;
      resize: vertical;
      min-height: 120px;
      font-size: 15px;
    }

    .submit-comment {
      background: var(--gradient-secondary);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      font-size: 16px;
    }

    .submit-comment:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }

    .product-detail-footer {
      padding: 25px 30px;
      background: var(--darker-bg);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      position: sticky;
      bottom: 0;
      z-index: 10;
    }

    @media (max-width: 768px) {
      .product-detail-footer {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
    }

    .purchase-button {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: var(--border-radius-sm);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .purchase-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px var(--shadow-light);
    }

    @media (max-width: 768px) {
      .purchase-button {
        width: 100%;
      }
    }

    /* ====== لوحة البحث مع المنتجات الصغيرة - نسخة محسنة ====== */
    .search-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.98);
      z-index: 2000;
      overflow-y: auto;
      animation: fadeIn 0.3s ease-out;
    }

    .search-container {
      width: 100%;
      min-height: 100vh;
      margin: 0;
      background: var(--gradient-dark);
      display: flex;
      flex-direction: column;
    }

    .search-header {
      padding: 30px;
      background: var(--gradient-primary);
      position: sticky;
      top: 0;
      z-index: 10;
      flex-shrink: 0;
    }

    .close-search {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all var(--transition-speed);
    }

    .close-search:hover {
      background: rgba(255,255,255,0.3);
      transform: rotate(90deg);
    }

    .search-title {
      font-size: 32px;
      font-weight: bold;
      color: white;
      margin-bottom: 20px;
      text-align: center;
    }

    .search-input-container {
      position: relative;
      max-width: 800px;
      margin: 0 auto;
    }

    .search-input {
      width: 100%;
      padding: 20px 70px 20px 30px;
      background: rgba(255,255,255,0.15);
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: var(--border-radius-lg);
      color: white;
      font-size: 20px;
      outline: none;
      transition: all var(--transition-speed);
    }

    .search-input:focus {
      border-color: white;
      background: rgba(255,255,255,0.2);
      box-shadow: 0 0 30px rgba(255, 107, 53, 0.4);
    }

    .search-input::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .search-icon {
      position: absolute;
      right: 25px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.7);
      font-size: 20px;
    }

    .search-main {
      flex: 1;
      padding: 30px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    /* بطاقات البحث الصغيرة المحسنة */
    .search-products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
    }

    @media (max-width: 768px) {
      .search-products-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }

    @media (max-width: 480px) {
      .search-products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .search-product-card {
      background: var(--gradient-dark);
      border-radius: var(--border-radius-lg);
      overflow: hidden;
      transition: all var(--transition-speed);
      border: 1px solid var(--border-color);
      cursor: pointer;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .search-product-card:hover {
      transform: translateY(-8px);
      border-color: var(--primary-color);
      box-shadow: 0 12px 25px rgba(0,0,0,0.4);
    }

    .search-product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .search-product-card-content {
      padding: 20px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .search-product-card-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .search-product-card-meta {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .search-product-meta-item {
      background: rgba(255,255,255,0.1);
      padding: 5px 10px;
      border-radius: var(--border-radius-sm);
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .search-product-card-price {
      font-size: 22px;
      font-weight: bold;
      color: var(--success-color);
      margin-top: auto;
      margin-bottom: 15px;
    }

    .search-product-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
    }

    .search-product-card-button {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }

    .search-product-card-button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px var(--shadow-light);
    }

    .search-footer {
      padding: 20px 30px;
      background: var(--darker-bg);
      border-top: 1px solid var(--border-color);
      flex-shrink: 0;
      text-align: center;
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
      font-size: 18px;
      grid-column: 1 / -1;
    }

    .no-results i {
      font-size: 48px;
      margin-bottom: 20px;
      display: block;
      color: var(--text-muted);
    }

    /* ====== لوحة الإعدادات المحسنة ====== */
    #panel {
      position: fixed;
      top: 0;
      left: -300px;
      width: 280px;
      height: 100vh;
      background: var(--gradient-dark);
      transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      border-right: 1px solid var(--border-color);
      box-shadow: 4px 0 20px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    #panel.show {
      left: 0;
    }

    .settings-header {
      padding: 30px 20px;
      background: var(--gradient-primary);
      text-align: center;
      position: relative;
    }

    .close-settings {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-speed);
    }

    .close-settings:hover {
      background: rgba(255,255,255,0.3);
      transform: rotate(90deg);
    }

    .user-avatar {
      width: 70px;
      height: 70px;
      background: white;
      border-radius: 50%;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: var(--primary-color);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .settings-title {
      font-size: 24px;
      font-weight: bold;
      color: white;
      margin-bottom: 5px;
    }

    .settings-subtitle {
      color: rgba(255,255,255,0.8);
      font-size: 14px;
    }

    .settings-menu {
      flex: 1;
      padding: 20px;
    }

    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all var(--transition-speed);
      border: 1px solid transparent;
    }

    .settings-item:hover {
      background: rgba(255,255,255,0.1);
      border-color: var(--primary-color);
      transform: translateX(5px);
    }

    .settings-item i {
      width: 20px;
      color: var(--accent-color);
      margin-right: 10px;
    }

    .settings-item-content {
      flex: 1;
    }

    .settings-item-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 3px;
    }

    .settings-item-desc {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .settings-value {
      background: var(--gradient-primary);
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      min-width: 70px;
      text-align: center;
      transition: all var(--transition-speed);
    }

    .settings-item:hover .settings-value {
      background: var(--gradient-secondary);
    }

    .settings-footer {
      padding: 20px;
      text-align: center;
      border-top: 1px solid var(--border-color);
    }

    .logout-btn {
      background: var(--gradient-secondary);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: var(--border-radius-sm);
      font-weight: bold;
      cursor: pointer;
      transition: all var(--transition-speed);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }

    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }

    /* ====== عناصر تحكم الإعدادات ====== */
    .settings-control {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: 10px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--card-bg);
      transition: .4s;
      border-radius: 34px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background: var(--text-secondary);
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background: var(--gradient-primary);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(24px);
      background: white;
    }

    .range-slider {
      flex: 1;
      height: 6px;
      background: var(--card-bg);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }

    .range-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--gradient-primary);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* ====== التبويبات ====== */
    .tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: var(--border-radius-sm);
      padding: 5px;
      margin: 30px 0;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 12px;
      cursor: pointer;
      transition: all var(--transition-speed);
      border-radius: var(--border-radius-sm);
      font-weight: bold;
    }

    .tab.active {
      background: var(--gradient-primary);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    /* ====== التصنيفات ====== */
    .category-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }

    .category-badge {
      background: var(--gradient-dark);
      color: var(--text-secondary);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all var(--transition-speed);
      border: 1px solid var(--border-color);
    }

    .category-badge:hover,
    .category-badge.active {
      background: var(--gradient-primary);
      color: white;
      border-color: var(--primary-color);
    }

    /* ====== التذييل ====== */
    .footer {
      background: var(--darker-bg);
      padding: 40px 20px;
      margin-top: 60px;
      border-top: 1px solid var(--border-color);
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
    }

    .footer-section h3 {
      color: var(--text-primary);
      margin-bottom: 20px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .footer-section h3 i {
      color: var(--primary-color);
    }

    .footer-links {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 10px;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: color var(--transition-speed);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .footer-links a:hover {
      color: var(--primary-color);
    }

    .copyright {
      text-align: center;
      padding-top: 30px;
      margin-top: 30px;
      border-top: 1px solid var(--border-color);
      color: var(--text-muted);
      font-size: 14px;
    }

    /* ====== الرسوم المتحركة الإضافية ====== */
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    /* ====== الوسائط المتجاوبة ====== */
    @media (max-width: 768px) {
      .main-content {
        padding: 90px 15px 30px;
      }

      .products-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .section-title {
        font-size: 24px;
      }

      .top {
        height: 60px;
        padding: 0 15px;
      }

      .welcome-text {
        font-size: 18px;
      }

      .welcome-icon {
        width: 45px;
        height: 45px;
      }

      .manga-navigation {
        flex-wrap: wrap;
      }

      .product-detail-container,
      .search-container {
        margin: 0;
        max-height: 100vh;
      }

      .content-navigation {
        flex-direction: column;
        gap: 15px;
      }

      .content-nav-button {
        width: 100%;
        justify-content: center;
      }
      
      .product-detail-summary-grid {
        grid-template-columns: 1fr;
      }
      
      .product-detail-poster img {
        max-height: 400px;
      }
    }

    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: 1fr;
      }

      .video-grid {
        grid-template-columns: 1fr;
      }

      .section-title {
        font-size: 20px;
      }

      .card-button {
        padding: 6px 15px;
        font-size: 14px;
      }

      .manga-navigation {
        gap: 10px;
      }

      .nav-button {
        width: 40px;
        height: 40px;
      }

      .search-products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>
  <!-- الخلفية -->
  <img id="img1" src="img//Alk.jpg" alt="خلفية">

  <!-- الشريط العلوي -->
  <div class="top">
    <img id="icon" src="img//icon1.jpg" alt="شعار المتجر">
    
    <div class="top-icons">
      <div class="icon-wrapper" onclick="openSearch()">
        <i class="fas fa-search"></i>
      </div>
      
      <a href="basket.html"><div class="icon-wrapper" onclick="goToCart()">
        <i class="fas fa-shopping-cart"></i>
        <span id="cart-badge">0</span>
      </div></a>
      
      <div class="icon-wrapper" onclick="toggleSettings()">
        <i class="fas fa-cog"></i>
      </div>
    </div>
  </div>

  <!-- قسم الترحيب -->
  <div class="top2">
    <div class="welcome-banner">
      <div class="welcome-icon">
        <i class="fas fa-book-open" style="color: white; font-size: 24px;"></i>
      </div>
      <div>
        <h1 class="welcome-text rtl-text">مكتبة الفجر ترحب بكم</h1>
        <h1 class="welcome-text ltr-text" style="display: none;">Fajr Library Welcomes You</h1>
        <p style="color: var(--text-secondary); text-align: center;" class="rtl-text">اكتشف عالمًا من القصص والكتب المتنوعة</p>
        <p style="color: var(--text-secondary); text-align: center;" class="ltr-text" style="display: none;">Discover a world of diverse stories and books</p>
      </div>
    </div>
  </div>

  <!-- المحتوى الرئيسي -->
  <div class="main-content">
    <!-- أحدث القصص -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-star"></i>
        <span class="rtl-text">أحدث القصص</span>
        <span class="ltr-text" style="display: none;">Latest Stories</span>
        <a href="javascript:void(0)" class="show-all" onclick="openSearch()" style="margin-right: auto; font-size: 14px; color: var(--primary-color); text-decoration: none;">
          <span class="rtl-text">إظهار الكل <i class="fas fa-arrow-left"></i></span>
          <span class="ltr-text" style="display: none;">Show All <i class="fas fa-arrow-right"></i></span>
        </a>
      </div>
      <p class="section-subtitle rtl-text">اكتشف أحدث الإصدارات من القصص المتنوعة</p>
      <p class="section-subtitle ltr-text" style="display: none;">Discover the latest releases of diverse stories</p>
      
      <div class="products-grid" id="stories-container">
        <!-- سيتم ملؤها ديناميكياً -->
      </div>
    </div>

    <!-- المانجا -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-paint-brush"></i>
        <span class="rtl-text">مانجا</span>
        <span class="ltr-text" style="display: none;">Manga</span>
      </div>
      <p class="section-subtitle rtl-text">الفانتازيا (الخيال السحري)</p>
      <p class="section-subtitle ltr-text" style="display: none;">Fantasy (Magic Fantasy)</p>
      
      <div class="scroll-section">
        <div class="scroll-container" id="manga-container">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        
        <!-- أزرار التنقل للقسم المانجا -->
        <div class="manga-navigation">
          <button class="nav-button" id="prev-manga" onclick="scrollManga('prev')">
            <i class="fas fa-arrow-left"></i>
          </button>
          
          <div class="manga-counter">
            <span id="current-manga">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="total-manga">1</span>
          </div>
          
          <div class="page-dots" id="manga-dots">
            <!-- سيتم إنشاء النقاط ديناميكيًا -->
          </div>
          
          <button class="nav-button" id="next-manga" onclick="scrollManga('next')">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- قسم الفيديوهات مع تبويبات -->
    <div class="video-section">
      <div class="section-title">
        <i class="fas fa-video"></i>
        <span class="rtl-text">فيديوهات</span>
        <span class="ltr-text" style="display: none;">Videos</span>
      </div>
      
      <!-- تبويبات الفيديوهات -->
      <div class="video-tabs">
        <div class="video-tab active" onclick="switchVideoTab(0)">
          <span class="rtl-text">الخيال السحري</span>
          <span class="ltr-text" style="display: none;">Magic Fantasy</span>
        </div>
        <div class="video-tab" onclick="switchVideoTab(1)">
          <span class="rtl-text">الرعب</span>
          <span class="ltr-text" style="display: none;">Horror</span>
        </div>
        <div class="video-tab" onclick="switchVideoTab(2)">
          <span class="rtl-text">الغموض</span>
          <span class="ltr-text" style="display: none;">Mystery</span>
        </div>
        <div class="video-tab" onclick="switchVideoTab(3)">
          <span class="rtl-text">السخرية</span>
          <span class="ltr-text" style="display: none;">Comedy</span>
        </div>
        <div class="video-tab" onclick="switchVideoTab(4)">
          <span class="rtl-text">المغامرة</span>
          <span class="ltr-text" style="display: none;">Adventure</span>
        </div>
      </div>
      
      <!-- محتوى تبويب الخيال السحري -->
      <div class="video-tab-content active" id="video-tab-0">
        <div class="video-grid" id="fantasy-videos">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للفيديوهات -->
        <div class="content-navigation" id="fantasy-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevVideoPage('fantasy')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="fantasy-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="fantasy-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextVideoPage('fantasy')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
      
      <!-- محتوى تبويب الرعب -->
      <div class="video-tab-content" id="video-tab-1">
        <div class="video-grid" id="horror-videos">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للفيديوهات -->
        <div class="content-navigation" id="horror-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevVideoPage('horror')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="horror-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="horror-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextVideoPage('horror')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
      
      <!-- محتوى تبويب الغموض -->
      <div class="video-tab-content" id="video-tab-2">
        <div class="video-grid" id="mystery-videos">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للفيديوهات -->
        <div class="content-navigation" id="mystery-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevVideoPage('mystery')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="mystery-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="mystery-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextVideoPage('mystery')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
      
      <!-- محتوى تبويب السخرية -->
      <div class="video-tab-content" id="video-tab-3">
        <div class="video-grid" id="comedy-videos">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للفيديوهات -->
        <div class="content-navigation" id="comedy-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevVideoPage('comedy')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="comedy-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="comedy-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextVideoPage('comedy')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
      
      <!-- محتوى تبويب المغامرة -->
      <div class="video-tab-content" id="video-tab-4">
        <div class="video-grid" id="adventure-videos">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للفيديوهات -->
        <div class="content-navigation" id="adventure-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevVideoPage('adventure')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="adventure-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="adventure-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextVideoPage('adventure')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- الروايات -->
    <div class="section">
      <div class="section-title">
        <i class="fas fa-book"></i>
        <span class="rtl-text">روايات</span>
        <span class="ltr-text" style="display: none;">Novels</span>
      </div>
      
      <!-- تبويبات التصنيف -->
      <div class="tabs">
        <div class="tab active" onclick="switchNovelTab(0)">
          <span class="rtl-text">التصنيف 16+</span>
          <span class="ltr-text" style="display: none;">Rating 16+</span>
        </div>
        <div class="tab" onclick="switchNovelTab(1)">
          <span class="rtl-text">التصنيف 18+</span>
          <span class="ltr-text" style="display: none;">Rating 18+</span>
        </div>
        <div class="tab" onclick="switchNovelTab(2)">
          <span class="rtl-text">جميع الأعمار</span>
          <span class="ltr-text" style="display: none;">All Ages</span>
        </div>
      </div>
      
      <!-- محتوى التبويبات -->
      <div class="tab-content active" id="novel-tab-0">
        <div class="products-grid" id="novels-16">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للروايات -->
        <div class="content-navigation" id="novels-16-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevNovelPage('16')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="novels-16-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="novels-16-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextNovelPage('16')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
      
      <div class="tab-content" id="novel-tab-1">
        <div class="products-grid" id="novels-18">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للروايات -->
        <div class="content-navigation" id="novels-18-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevNovelPage('18')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="novels-18-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="novels-18-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextNovelPage('18')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
      
      <div class="tab-content" id="novel-tab-2">
        <div class="products-grid" id="novels-all">
          <!-- سيتم ملؤها ديناميكياً -->
        </div>
        <!-- أزرار التنقل للروايات -->
        <div class="content-navigation" id="novels-all-navigation" style="display: none;">
          <button class="content-nav-button" onclick="prevNovelPage('all')">
            <i class="fas fa-arrow-right"></i>
            <span class="rtl-text">السابق</span>
            <span class="ltr-text" style="display: none;">Previous</span>
          </button>
          
          <div class="content-nav-info">
            <span id="novels-all-current-page">1</span>
            <span class="rtl-text">من</span>
            <span class="ltr-text" style="display: none;">of</span>
            <span id="novels-all-total-pages">1</span>
          </div>
          
          <button class="content-nav-button" onclick="nextNovelPage('all')">
            <span class="rtl-text">التالي</span>
            <span class="ltr-text" style="display: none;">Next</span>
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- لوحة تفاصيل المنتج المحسنة -->
  <div class="product-detail-overlay" id="product-detail-overlay">
    <div class="product-detail-container">
      <div class="product-detail-header">
        <button class="close-product-detail" onclick="closeProductDetail()">
          <i class="fas fa-times"></i>
        </button>
        <h2 class="product-detail-title rtl-text" id="product-detail-title">اسم المنتج</h2>
        <h2 class="product-detail-title ltr-text" style="display: none;" id="product-detail-title-en">Product Name</h2>
      </div>
      
      <div class="product-detail-main">
        <div class="product-detail-content">
          <div class="product-detail-poster">
            <img id="product-detail-poster" src="" alt="صورة المنتج">
          </div>
          
          <div class="product-detail-info">
            <div class="product-detail-meta">
              <span class="product-detail-category rtl-text" id="product-detail-category">الفئة</span>
              <span class="product-detail-category ltr-text" style="display: none;" id="product-detail-category-en">Category</span>
              <span class="product-detail-price" id="product-detail-price">$0.00</span>
              <div class="product-detail-rating">
                <div class="stars" id="product-detail-stars">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star-half-alt"></i>
                </div>
                <span class="rating-value" id="product-detail-rating">4.5/5</span>
              </div>
            </div>
            
            <!-- قسم معلومات المنتج الجديد -->
            <div id="product-summary-section"></div>
            
            <p class="product-detail-description rtl-text" id="product-detail-description">
              وصف المنتج سيظهر هنا...
            </p>
            <p class="product-detail-description ltr-text" style="display: none;" id="product-detail-description-en">
              Product description will appear here...
            </p>
            
            <div class="product-detail-sections">
              <!-- الأجزاء (للفيديوهات) -->
              <div class="product-detail-section" id="chapters-section" style="display: none;">
                <h3 class="section-label">
                  <i class="fas fa-list-ol"></i>
                  <span class="rtl-text">الأجزاء</span>
                  <span class="ltr-text" style="display: none;">Chapters</span>
                </h3>
                <div class="chapters-list" id="product-chapters">
                  <!-- سيتم ملؤها ديناميكياً -->
                </div>
              </div>
              
              <!-- التعليقات -->
              <div class="product-detail-section">
                <h3 class="section-label">
                  <i class="fas fa-comments"></i>
                  <span class="rtl-text">التعليقات</span>
                  <span class="ltr-text" style="display: none;">Comments</span>
                </h3>

                <div class="comments-section" id="product-comments">
                  <!-- سيتم ملؤها ديناميكياً -->
                </div>
                <div class="add-comment">
                  <textarea class="comment-input" placeholder="اكتب تعليقك هنا..." id="product-comment-input"></textarea>
                  <button class="submit-comment" onclick="addProductComment()">
                    <i class="fas fa-paper-plane"></i>
                    <span class="rtl-text">إضافة تعليق</span>
                    <span class="ltr-text" style="display: none;">Add Comment</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="product-detail-footer">
        <div>
          <h3 class="rtl-text" id="product-detail-name">اسم المنتج</h3>
          <h3 class="ltr-text" style="display: none;" id="product-detail-name-en">Product Name</h3>
          <p class="rtl-text" style="color: var(--text-secondary); margin-top: 5px;" id="product-detail-type">النوع - الفئة</p>
          <p class="ltr-text" style="color: var(--text-secondary); margin-top: 5px; display: none;" id="product-detail-type-en">Type - Category</p>
        </div>
        
        <button class="purchase-button" onclick="purchaseProduct()">
          <i class="fas fa-shopping-cart"></i>
          <span class="rtl-text">شراء الآن</span>
          <span class="ltr-text" style="display: none;">Buy Now</span>
        </button>
      </div>
    </div>
  </div>

  <!-- لوحة البحث مع المنتجات الصغيرة المحسنة -->
  <div class="search-overlay" id="search-overlay">
    <div class="search-container">
      <div class="search-header">
        <button class="close-search" onclick="closeSearch()">
          <i class="fas fa-times"></i>
        </button>
        <h2 class="search-title rtl-text">البحث عن المنتجات</h2>
        <h2 class="search-title ltr-text" style="display: none;">Search Products</h2>
        
        <div class="search-input-container">
          <input type="text" class="search-input" id="search-input" 
                 placeholder="ابحث عن كتب، قصص، فيديوهات..." 
                 onkeyup="searchProducts()">
          <i class="fas fa-search search-icon"></i>
        </div>
      </div>
      
      <div class="search-main" id="search-results">
        <!-- سيتم ملؤها ديناميكياً -->
      </div>
      
      <div class="search-footer">
        <p class="rtl-text" id="search-count">تم العثور على 0 منتج</p>
        <p class="ltr-text" style="display: none;" id="search-count-en">0 products found</p>
      </div>
    </div>
  </div>

  <!-- لوحة الإعدادات مع إضافة خيار ترتيب المنتجات -->
  <div id="panel">
    <div class="settings-header">
      <button class="close-settings" onclick="toggleSettings()">
        <i class="fas fa-times"></i>
      </button>
      <div class="user-avatar">
        <i class="fas fa-user"></i>
      </div>
      <h2 class="settings-title rtl-text">الإعدادات</h2>
      <h2 class="settings-title ltr-text" style="display: none;">Settings</h2>
      <p class="settings-subtitle rtl-text">تخصيص تجربتك في المتجر</p>
      <p class="settings-subtitle ltr-text" style="display: none;">Customize your store experience</p>
    </div>
    
    <div class="settings-menu">
      <!-- اللغة -->
      <div class="settings-item" onclick="toggleLanguage()">
        <i class="fas fa-language"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">اللغة</div>
          <div class="settings-item-title ltr-text" style="display: none;">Language</div>
          <div class="settings-item-desc rtl-text">اختر لغة العرض المفضلة</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Choose your preferred display language</div>
        </div>
        <span class="settings-value" id="language-value">العربية</span>
      </div>
      
      <!-- المظهر -->
      <div class="settings-item" onclick="toggleTheme()">
        <i class="fas fa-palette"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">المظهر</div>
          <div class="settings-item-title ltr-text" style="display: none;">Theme</div>
          <div class="settings-item-desc rtl-text">داكن، فاتح، أو تلقائي</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Dark, Light, or Auto</div>
        </div>
        <span class="settings-value" id="theme-value">داكن</span>
      </div>
      
      <!-- ترتيب المنتجات -->
      <div class="settings-item" onclick="toggleDisplayMode()">
        <i class="fas fa-sort-amount-down"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">ترتيب المنتجات</div>
          <div class="settings-item-title ltr-text" style="display: none;">Product Order</div>
          <div class="settings-item-desc rtl-text">عشوائي، الأعلى تقييماً، أو الأحدث</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Random, Highest Rated, or Newest</div>
        </div>
        <span class="settings-value" id="display-mode-value">عشوائي</span>
      </div>
      
      <!-- حجم النص -->
      <div class="settings-item">
        <i class="fas fa-text-height"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">حجم النص</div>
          <div class="settings-item-title ltr-text" style="display: none;">Text Size</div>
          <div class="settings-item-desc rtl-text">تكبير أو تصغير حجم الخط</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Increase or decrease font size</div>
        </div>
        <div class="settings-control">
          <input type="range" class="range-slider" id="textSizeSlider" 
                 min="0" max="200" value="100" 
                 onchange="updateTextSize(this.value)">
          <span id="textSizePercent">100%</span>
        </div>
      </div>
      
      <!-- الإشعارات -->
      <div class="settings-item">
        <i class="fas fa-bell"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">الإشعارات</div>
          <div class="settings-item-title ltr-text" style="display: none;">Notifications</div>
          <div class="settings-item-desc rtl-text">إدارة التنبيهات والإشعارات</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Manage alerts and notifications</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="notifications-toggle" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      
      <!-- الخصوصية -->
      <a style="text-decoration: none; color: white;" href="Alr-comment.html"><div class="settings-item" onclick="openPrivacy()">
        <i class="fas fa-shield-alt"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">الخصوصية</div>
          <div class="settings-item-title ltr-text" style="display: none;">Privacy</div>
          <div class="settings-item-desc rtl-text">إعدادات الأمان والخصوصية</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Security and privacy settings</div>
        </div>
        <i class="fas fa-chevron-left" style="color: var(--text-secondary);"></i>
      </div></a>
      
      <!-- سجل الطلبات -->
      <a style="text-decoration: none; color: white;" href="Alr-comment.html"><div class="settings-item" >
        <i class="fas fa-history"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">سجل الطلبات</div>
          <div class="settings-item-title ltr-text" style="display: none;">Order History</div>
          <div class="settings-item-desc rtl-text">عرض جميع طلباتك السابقة</div>
          <div class="settings-item-desc ltr-text" style="display: none;">View all your previous orders</div>
        </div>
        <i class="fas fa-chevron-left" style="color: var(--text-secondary);"></i>
      </div></a>
      
      <!-- الحساب -->
      <a style="text-decoration: none; color: white;" href="Alr-comment.html"><div class="settings-item" onclick="openAccount()">
        <i class="fas fa-user-cog"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">الحساب والبيانات</div>
          <div class="settings-item-title ltr-text" style="display: none;">Account & Data</div>
          <div class="settings-item-desc rtl-text">إدارة حسابك ومعلوماتك</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Manage your account and information</div>
        </div>
        <i class="fas fa-chevron-left" style="color: var(--text-secondary);"></i>
      </div></a>
      
      <!-- الرأي العام -->
      <a style="text-decoration: none; color: white;" href="Alr-comment.html"><div class="settings-item" >
        <i class="fas fa-comments"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">الرأي العام</div>
          <div class="settings-item-title ltr-text" style="display: none;">Public Opinion</div>
          <div class="settings-item-desc rtl-text">تقييمات وآراء المستخدمين</div>
          <div class="settings-item-desc ltr-text" style="display: none;">User ratings and opinions</div>
        </div>
        <i class="fas fa-chevron-left" style="color: var(--text-secondary);"></i>
      </div></a>
      
      <!-- سياسة الاستخدام -->
      <a style="text-decoration: none; color: white;" href="Terms of Use.html"><div class="settings-item" >
        <i class="fas fa-file-contract"></i>
        <div class="settings-item-content">
          <div class="settings-item-title rtl-text">سياسة الاستخدام</div>
          <div class="settings-item-title ltr-text" style="display: none;">Usage Policy</div>
          <div class="settings-item-desc rtl-text">الشروط والأحكام</div>
          <div class="settings-item-desc ltr-text" style="display: none;">Terms and Conditions</div>
        </div>
        <i class="fas fa-chevron-left" style="color: var(--text-secondary);"></i>
      </div>
    </div></a>
    
<div class="settings-item" onclick="logout()">
  <i class="fas fa-sign-out-alt"></i>
  <div class="settings-item-content">
    <div class="settings-item-title rtl-text">تسجيل الخروج</div>
    <div class="settings-item-title ltr-text" style="display: none;">Logout</div>
    <div class="settings-item-desc rtl-text">إنهاء الجلسة الحالية</div>
    <div class="settings-item-desc ltr-text" style="display: none;">End current session</div>
  </div>
  <i class="fas fa-chevron-left" style="color: var(--text-secondary);"></i>
</div>
  </div>

  <!-- التذييل -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-section">
        <h3><i class="fas fa-store"></i> <span class="rtl-text">مكتبة الفجر</span><span class="ltr-text" style="display: none;">Fajr Library</span></h3>
        <p style="color: var(--text-secondary); line-height: 1.6;" class="rtl-text">
          وجهتك الأولى للحصول على أفضل القصص والكتب والوسائط التعليمية باللغة العربية
        </p>
        <p style="color: var(--text-secondary); line-height: 1.6;" class="ltr-text" style="display: none;">
          Your first destination for the best stories, books, and educational media in Arabic
        </p>
      </div>
      
      <div class="footer-section">
        <h3><i class="fas fa-link"></i> <span class="rtl-text">روابط سريعة</span><span class="ltr-text" style="display: none;">Quick Links</span></h3>
        <ul class="footer-links">
          <li><a href="index.html" onclick="scrollToTop()"><i class="fas fa-home"></i> <span class="rtl-text">الرئيسية</span><span class="ltr-text" style="display: none;">Home</span></a></li>
          <li><a href="javascript:void(0)" onclick="openSearch()"><i class="fas fa-book"></i> <span class="rtl-text">المكتبة</span><span class="ltr-text" style="display: none;">Library</span></a></li>
          <li><a href="basket.html" onclick="goToCart()"><i class="fas fa-shopping-cart"></i> <span class="rtl-text">عربة التسوق</span><span class="ltr-text" style="display: none;">Shopping Cart</span></a></li>
          <li><a href="Rt-chat.html" ><i class="fas fa-user"></i> <span class="rtl-text">المساعد الذكي</span><span class="ltr-text" style="display: none;">My Account</span></a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h3><i class="fas fa-headset"></i> <span class="rtl-text">الدعم</span><span class="ltr-text" style="display: none;">Support</span></h3>
        <ul class="footer-links">
          <li><a href="javascript:void(0)" onclick="openFAQ()"><i class="fas fa-question-circle"></i> <span class="rtl-text">الأسئلة الشائعة</span><span class="ltr-text" style="display: none;">FAQ</span></a></li>
          <li><a href="call.html" ><i class="fas fa-phone"></i> <span class="rtl-text">الاتصال بنا</span><span class="ltr-text" style="display: none;">Contact Us</span></a></li>
          <li><a href="call.html" ><i class="fas fa-exclamation-circle"></i> <span class="rtl-text">الإبلاغ عن مشكلة</span><span class="ltr-text" style="display: none;">Report Issue</span></a></li>
          <li><a href="call.html" ><i class="fas fa-lightbulb"></i> <span class="rtl-text">مقترحات</span><span class="ltr-text" style="display: none;">Suggestions</span></a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h3><i class="fas fa-share-alt"></i> <span class="rtl-text">تواصل معنا</span><span class="ltr-text" style="display: none;">Connect With Us</span></h3>
        <div style="display: flex; gap: 15px; margin-top: 20px;">
          <a href="#" class="icon-wrapper" style="width: 40px; height: 40px;">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="#" class="icon-wrapper" style="width: 40px; height: 40px;">
            <i class="fab fa-twitter"></i>
          </a>
          <a href="#" class="icon-wrapper" style="width: 40px; height: 40px;">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="#" class="icon-wrapper" style="width: 40px; height: 40px;">
            <i class="fab fa-whatsapp"></i>
          </a>
        </div>
      </div>
    </div>
    
    <div class="copyright">
      <span class="rtl-text">© 2026 مكتبة الفجر. جميع الحقوق محفوظة.</span>
      <span class="ltr-text" style="display: none;">© 2026 Fajr Library. All rights reserved.</span>
    </div>
  </footer>

<script type="module">
    // ====== استيراد Firebase ======
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getDatabase, ref, get, set, push, onValue, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

    // ====== تهيئة Firebase ======
    const firebaseConfig = {
        apiKey: "AIzaSyBlcKC2ncX9mTOPlhDOnfmyzdJ5mLinWYY",
        authDomain: "al-fajr-digital-library.firebaseapp.com",
        databaseURL: "https://al-fajr-digital-library-default-rtdb.firebaseio.com",
        projectId: "al-fajr-digital-library",
        storageBucket: "al-fajr-digital-library.firebasestorage.app",
        messagingSenderId: "739899495618",
        appId: "1:739899495618:web:8e60409193ec1408b4d75b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // ====== البيانات والتكوين ======
    let currentLanguage = 'ar';
    let currentTheme = 'dark';
    let displayMode = 'random';
    let cartCount = 0;
    let currentMangaPage = 0;
    const mangaItemsPerPage = 4;
    let currentProductId = null;
    
    // إعدادات التقسيم
    const novelsPerPage = 6;
    const videosPerPage = 3;
    
    // حالات التقسيم
    let novelPages = {
      '16': { current: 0, total: 0, items: [] },
      '18': { current: 0, total: 0, items: [] },
      'all': { current: 0, total: 0, items: [] }
    };
    
    let videoPages = {
      'fantasy': { current: 0, total: 0, items: [] },
      'horror': { current: 0, total: 0, items: [] },
      'mystery': { current: 0, total: 0, items: [] },
      'comedy': { current: 0, total: 0, items: [] },
      'adventure': { current: 0, total: 0, items: [] }
    };

    // جميع المنتجات
    let allProducts = [];

    // ====== دالة مساعدة للحصول على الصورة ======
    function getProductImage(product) {
        // إعطاء الأولوية لـ Base64
        if (product.imageBase64) {
            return product.imageBase64;
        }
        // ثم الرابط
        else if (product.image) {
            return product.image;
        }
        // ثم صورة افتراضية
        else {
            return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjMzMzMzMzIi8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgdGV4dC1kb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIj5ObyBJbWFnZTwvdGV4dD4KPC9zdmc+';
        }
    }

    // ====== التحقق من تسجيل الدخول ======
    function checkAuth() {
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (!user || !user.uid) {
        window.location.href = 'login.html';
        return null;
      }
      return user;
    }

    // ====== دالة لتسجيل الخروج ======
    async function logout() {
      try {
        await signOut(auth);
        
        localStorage.removeItem('user');
        localStorage.removeItem('cart');
        showNotification(currentLanguage === 'ar' ? 
          'تم تسجيل الخروج بنجاح' : 
          'Logged out successfully');
        
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 1500);
      } catch (error) {
        console.error('Error logging out:', error);
        showNotification(currentLanguage === 'ar' ? 
          'حدث خطأ أثناء تسجيل الخروج' : 
          'Error logging out');
      }
    }

    // ====== دالة التحقق من تسجيل الدخول قبل إضافة تعليق ======
    function checkAuthBeforeComment() {
      const user = checkAuth();
      if (!user) {
        showNotification(currentLanguage === 'ar' ? 
          'الرجاء تسجيل الدخول لإضافة تعليق' : 
          'Please login to add a comment');
        return null;
      }
      return user;
    }

    // ====== دالة التحقق من تسجيل الدخول قبل الشراء ======
    function checkAuthBeforePurchase() {
      const user = checkAuth();
      if (!user) {
        showNotification(currentLanguage === 'ar' ? 
          'الرجاء تسجيل الدخول لإكمال عملية الشراء' : 
          'Please login to complete purchase');
        return null;
      }
      return user;
    }

    // ====== تحميل المنتجات من Firebase مع دعم Base64 ======
    async function loadProductsFromFirebase() {
        try {
            const productsRef = ref(database, 'products');
            const snapshot = await get(productsRef);
            allProducts = [];
            
            if (snapshot.exists()) {
                const products = snapshot.val();
                Object.keys(products).forEach(productId => {
                    const product = {
                        id: productId,
                        ...products[productId]
                    };
                    
                    // التأكد من وجود صورة
                    product.image = getProductImage(product);
                    
                    allProducts.push(product);
                });
                console.log(`تم تحميل ${allProducts.length} منتج من Firebase`);
            } else {
                console.log("لا توجد منتجات في Firebase، يتم استخدام بيانات عينة");
                loadSampleProducts();
            }
            
            renderAllContent();
            return true;
        } catch (error) {
            console.error("خطأ في تحميل المنتجات من Firebase:", error);
            loadSampleProducts();
            renderAllContent();
            return false;
        }
    }

    // ====== إعداد مستمع في الوقت الحقيقي للمنتجات ======
    function setupRealtimeProductsListener() {
        try {
            const productsRef = ref(database, 'products');
            
            // الاستماع للتغييرات في الوقت الحقيقي
            onValue(productsRef, (snapshot) => {
                if (snapshot.exists()) {
                    const products = snapshot.val();
                    allProducts = [];
                    
                    Object.keys(products).forEach(productId => {
                        const product = {
                            id: productId,
                            ...products[productId]
                        };
                        
                        product.image = getProductImage(product);
                        allProducts.push(product);
                    });
                    
                    console.log(`تم تحديث المنتجات في الوقت الحقيقي: ${allProducts.length} منتج`);
                    
                    // تحديث الواجهة
                    renderAllContent();
                    
                    // إذا كانت نافذة البحث مفتوحة، تحديث نتائج البحث
                    if (document.getElementById('search-overlay').style.display === 'block') {
                        searchProducts();
                    }
                    
                    // إذا كانت نافذة عرض الكل للقصص مفتوحة، تحديثها
                    if (document.getElementById('all-stories-modal').style.display === 'block') {
                        displayAllStories();
                    }
                }
            });
            
            console.log("تم إعداد مستمع المنتجات في الوقت الحقيقي");
        } catch (error) {
            console.error("خطأ في إعداد مستمع المنتجات:", error);
        }
    }

    // ====== بيانات عينة للمنتجات مع Base64 ======
    function loadSampleProducts() {
        allProducts = [
            {
                id: 'story1',
                title: 'النبات الأحمر',
                titleEn: 'The Red Plant',
                category: 'قصص',
                categoryEn: 'Stories',
                subcategory: 'ضحك، تفاهة',
                subcategoryEn: 'Comedy, Triviality',
                price: '$9.99',
                description: 'قصة ممتعة تحكي مغامرات نبات أحمر في عالم غريب.',
                descriptionEn: 'A fun story about the adventures of a red plant in a strange world.',
                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkY2QjM1Ii8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZGlyZWN0aW9uPSJydGwiPiDZhdi52LHYp9inINin2YTZitmE2YrYpzwvdGV4dD4KPC9zdmc+',
                rating: 4.2,
                type: 'قصة',
                typeEn: 'Story',
                format: 'رقمي',
                formatEn: 'Digital',
                ratingCategory: 'all',
                chapters: [],
                comments: []
            },
            {
                id: 'story2',
                title: 'مغامرات في الغابة',
                titleEn: 'Adventures in the Forest',
                category: 'قصص',
                categoryEn: 'Stories',
                subcategory: 'مغامرة، خيال',
                subcategoryEn: 'Adventure, Fantasy',
                price: '$12.99',
                description: 'مغامرات مثيرة في أعماق الغابات السحرية.',
                descriptionEn: 'Exciting adventures in the depths of magical forests.',
                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI400IiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzQyODVGNCIvPgogICAgPHRleHQgeD0iMjAwIiB5PSIxNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRpcmVjdGlvbj0icnRsIj4g2LPZiNin2KjYp9ix2YIg2YrZhNin2YYg2YfYs9io2YIKPC90ZXh0Pgo8L3N2Zz4=',
                rating: 4.5,
                type: 'قصة',
                typeEn: 'Story',
                format: 'رقمي',
                formatEn: 'Digital',
                ratingCategory: 'all',
                chapters: [],
                comments: []
            },
            {
                id: 'manga1',
                title: 'مانجا الفانتازيا 1',
                titleEn: 'Fantasy Manga 1',
                category: 'مانجا',
                categoryEn: 'Manga',
                subcategory: 'خيال سحري',
                subcategoryEn: 'Magic Fantasy',
                price: '$8.99',
                description: 'مانجا فانتازيا سحرية مليئة بالمغامرات.',
                descriptionEn: 'Magical fantasy manga full of adventures.',
                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkY2QjM1Ii8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZGlyZWN0aW9uPSJydGwiPiDYs9mI2KfYqNinINin2YXYudin2KggMQo8L3RleHQ+Cjwvc3ZnPg==',
                rating: 4.3,
                type: 'مانجا',
                typeEn: 'Manga',
                format: 'رقمي',
                formatEn: 'Digital',
                ratingCategory: 'all',
                chapters: [],
                comments: []
            },
            {
                id: 'fantasy1',
                title: 'أساطير السحر القديم',
                titleEn: 'Legends of Ancient Magic',
                category: 'فيديوهات',
                categoryEn: 'Videos',
                subcategory: 'الخيال السحري',
                subcategoryEn: 'Magic Fantasy',
                price: '$24.99',
                description: 'رحلة سحرية إلى عالم الأساطير القديمة.',
                descriptionEn: 'A magical journey to the world of ancient legends.',
                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkY2QjM1Ii8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjIwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZGlyZWN0aW9uPSJydGwiPiDYqNmH2YjYryDZh9mI2KfYryDYqdin2KjZhiA8L3RleHQ+Cjwvc3ZnPg==',
                rating: 4.5,
                type: 'فيديو',
                typeEn: 'Video',
                format: 'رقمي',
                formatEn: 'Digital',
                ratingCategory: 'all',
                chapters: [
                    { title: 'الفصل الأول: البداية', duration: '25:45', id: 'ch1' },
                    { title: 'الفصل الثاني: الاكتشاف', duration: '28:30', id: 'ch2' }
                ],
                comments: []
            },
            {
                id: 'novel16-1',
                title: 'الهدف السري',
                titleEn: 'The Secret Target',
                category: 'روايات',
                categoryEn: 'Novels',
                subcategory: 'تشويق، إثارة',
                subcategoryEn: 'Suspense, Thriller',
                price: '$19.99',
                description: 'رواية تشويقية مليئة بالأحداث المثيرة.',
                descriptionEn: 'A suspenseful novel full of exciting events.',
                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkY2QjM1Ii8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjIyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZGlyZWN0aW9uPSJydGwiPiDZhdi52LHYp9inINin2YTZitmE2YrYpzwvdGV4dD4KPC9zdmc+',
                rating: 4.6,
                type: 'رواية',
                typeEn: 'Novel',
                format: 'ورقي',
                formatEn: 'Paperback',
                ratingCategory: '16',
                chapters: [],
                comments: []
            },
            {
                id: 'novel18-1',
                title: 'الظلام القاتم',
                titleEn: 'The Deep Darkness',
                category: 'روايات',
                categoryEn: 'Novels',
                subcategory: 'رعب، نفسي',
                subcategoryEn: 'Horror, Psychological',
                price: '$24.99',
                description: 'رواية رعب نفسي عن مواجهة المخاوف الداخلية.',
                descriptionEn: 'A psychological horror novel about facing inner fears.',
                image: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRkY2QjM1Ii8+CiAgICA8dGV4dCB4PSIyMDAiIHk9IjE1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjIyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZGlyZWN0aW9uPSJydGwiPiDZhdiv2LXYudin2Kcg2KfZgtmI2LHYpzwvdGV4dD4KPC9zdmc+',
                rating: 4.9,
                type: 'رواية',
                typeEn: 'Novel',
                format: 'ورقي',
                formatEn: 'Paperback',
                ratingCategory: '18',
                chapters: [],
                comments: []
            }
        ];
    }

    // ====== الوظائف الأساسية ======
    // تحديث عداد السلة
    function updateCartBadge() {
        try {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (!user || !user.email) {
                cartCount = 0;
            } else {
                const userEmail = user.email;
                const CART_KEY = `cart_${userEmail}`;
                const cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
                cartCount = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            }
            
            const badgeElement = document.getElementById('cart-badge');
            if (badgeElement) {
                badgeElement.textContent = cartCount;
                if (cartCount > 0) {
                    badgeElement.style.display = 'flex';
                } else {
                    badgeElement.style.display = 'none';
                }
            }
        } catch (error) {
            console.error('Error updating cart badge:', error);
            cartCount = 0;
            const badgeElement = document.getElementById('cart-badge');
            if (badgeElement) {
                badgeElement.textContent = '0';
            }
        }
    }

    // ====== دالة إضافة المنتج إلى السلة ======
    function addToCart(productId, event = null) {
        if (event) {
            event.stopPropagation();
            event.preventDefault();
        }
        
        const user = checkAuth();
        if (!user) {
            showNotification(currentLanguage === 'ar' ? 
                'الرجاء تسجيل الدخول أولاً' : 
                'Please login first');
            return;
        }
        
        const product = allProducts.find(p => p.id === productId);
        if (!product) {
            console.error('Product not found:', productId);
            showNotification(currentLanguage === 'ar' ? 
                'المنتج غير موجود' : 
                'Product not found');
            return;
        }
        
        const priceValue = parseFloat(product.price.replace('$', ''));
        const userEmail = user.email;
        const CART_KEY = `cart_${userEmail}`;
        let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
        const existingIndex = cart.findIndex(item => item.id === productId);
        
        if (existingIndex > -1) {
            cart[existingIndex].quantity++;
        } else {
            cart.push({
                id: product.id,
                title: currentLanguage === 'ar' ? product.title : product.titleEn,
                price: priceValue,
                image: getProductImage(product),
                quantity: 1,
                category: currentLanguage === 'ar' ? product.category : product.categoryEn,
                type: currentLanguage === 'ar' ? product.type : product.typeEn,
                format: currentLanguage === 'ar' ? product.format : product.formatEn,
                rating: product.rating,
                description: currentLanguage === 'ar' ? product.description : product.descriptionEn
            });
        }
        
        try {
            localStorage.setItem(CART_KEY, JSON.stringify(cart));
            updateCartBadge();
            
            const productName = currentLanguage === 'ar' ? product.title : product.titleEn;
            showNotification(currentLanguage === 'ar' ? 
                `تمت إضافة "${productName}" إلى السلة بنجاح!` : 
                `"${productName}" added to cart successfully!`);
                
            trackUserActivity('add_to_cart', productId);
            
        } catch (error) {
            console.error('Error saving cart:', error);
            showNotification(currentLanguage === 'ar' ? 
                'حدث خطأ أثناء حفظ السلة' : 
                'Error saving cart');
        }
    }

    // إظهار إشعار
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FF6B35, #FF8E53);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // ====== دالة الانتقال إلى صفحة السلة ======
    function goToCart() {
        const user = checkAuth();
        if (!user) return;
        
        window.location.href = 'cart.html';
    }

    // تبديل الإعدادات
    function toggleSettings() {
        const panel = document.getElementById('panel');
        panel.classList.toggle('show');
    }

    // تبديل اللغة
    function toggleLanguage() {
        currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
        const languageValue = document.getElementById('language-value');
        
        if (currentLanguage === 'ar') {
            languageValue.textContent = 'العربية';
            document.documentElement.setAttribute('lang', 'ar');
            document.documentElement.setAttribute('dir', 'rtl');
            document.querySelectorAll('.rtl-text').forEach(el => el.style.display = '');
            document.querySelectorAll('.ltr-text').forEach(el => el.style.display = 'none');
        } else {
            languageValue.textContent = 'English';
            document.documentElement.setAttribute('lang', 'en');
            document.documentElement.setAttribute('dir', 'ltr');
            document.querySelectorAll('.rtl-text').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.ltr-text').forEach(el => el.style.display = '');
        }
        
        localStorage.setItem('language', currentLanguage);
        localStorage.setItem('direction', currentLanguage === 'ar' ? 'rtl' : 'ltr');
        updateMangaNavigation();
        updateSearchPlaceholder();
        renderAllContent();
    }

    // تبديل وضع العرض (ترتيب المنتجات)
    function toggleDisplayMode() {
        const modes = ['random', 'rating', 'newest'];
        const modeNames = { random: 'عشوائي', rating: 'الأعلى تقييماً', newest: 'الأحدث' };
        const modeNamesEn = { random: 'Random', rating: 'Highest Rated', newest: 'Newest' };
        
        const currentIndex = modes.indexOf(displayMode);
        const nextIndex = (currentIndex + 1) % modes.length;
        displayMode = modes[nextIndex];
        
        const displayModeValue = document.getElementById('display-mode-value');
        if (currentLanguage === 'ar') {
            displayModeValue.textContent = modeNames[displayMode];
        } else {
            displayModeValue.textContent = modeNamesEn[displayMode];
        }
        
        localStorage.setItem('displayMode', displayMode);
        renderAllContent();
    }

    // دالة ترتيب المنتجات حسب الوضع
    function sortProducts(products) {
        const sortedProducts = [...products];
        
        switch(displayMode) {
            case 'rating':
                return sortedProducts.sort((a, b) => b.rating - a.rating);
            case 'newest':
                return sortedProducts.sort((a, b) => b.id.localeCompare(a.id));
            case 'random':
            default:
                return shuffleArray(sortedProducts);
        }
    }

    // دالة خلط عشوائي
    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    // تطبيق المظهر
    function applyTheme() {
        if (currentTheme === 'فاتح') {
            document.documentElement.style.setProperty('--dark-bg', '#f5f5f5');
            document.documentElement.style.setProperty('--darker-bg', '#e0e0e0');
            document.documentElement.style.setProperty('--card-bg', '#ffffff');
            document.documentElement.style.setProperty('--text-primary', '#333333');
            document.documentElement.style.setProperty('--text-secondary', '#666666');
            document.documentElement.style.setProperty('--border-color', '#dddddd');
        } else if (currentTheme === 'تلقائي') {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
                applyDarkTheme();
            } else {
                applyLightTheme();
            }
        } else {
            applyDarkTheme();
        }
    }

    function applyDarkTheme() {
        document.documentElement.style.setProperty('--dark-bg', '#121212');
        document.documentElement.style.setProperty('--darker-bg', '#0d0d0d');
        document.documentElement.style.setProperty('--card-bg', '#1e1e1e');
        document.documentElement.style.setProperty('--text-primary', '#ffffff');
        document.documentElement.style.setProperty('--text-secondary', '#b0b0b0');
        document.documentElement.style.setProperty('--border-color', '#333333');
    }

    function applyLightTheme() {
        document.documentElement.style.setProperty('--dark-bg', '#f5f5f5');
        document.documentElement.style.setProperty('--darker-bg', '#e0e0e0');
        document.documentElement.style.setProperty('--card-bg', '#ffffff');
        document.documentElement.style.setProperty('--text-primary', '#333333');
        document.documentElement.style.setProperty('--text-secondary', '#666666');
        document.documentElement.style.setProperty('--border-color', '#dddddd');
    }

    // تغيير حجم النص
    function updateTextSize(value) {
        const percent = parseInt(value);
        document.getElementById('textSizePercent').textContent = percent + '%';
        const scale = percent / 100;
        document.documentElement.style.fontSize = `calc(1rem * ${scale})`;
        localStorage.setItem('textSize', value);
    }

    // ====== إدارة التنقل في قسم المانجا ======
    function initializeMangaNavigation() {
        const mangaItems = allProducts.filter(p => p.category === 'مانجا');
        const sortedManga = sortProducts(mangaItems);
        const totalPages = Math.ceil(sortedManga.length / mangaItemsPerPage);
        
        document.getElementById('total-manga').textContent = totalPages;
        const dotsContainer = document.getElementById('manga-dots');
        if (dotsContainer) {
            dotsContainer.innerHTML = '';
            
            for (let i = 0; i < totalPages; i++) {
                const dot = document.createElement('div');
                dot.className = 'page-dot';
                if (i === 0) dot.classList.add('active');
                dot.dataset.page = i;
                dot.addEventListener('click', () => goToMangaPage(i));
                dotsContainer.appendChild(dot);
            }
        }
        
        showMangaPage(0);
    }
    
    function showMangaPage(page) {
        currentMangaPage = page;
        const mangaItems = allProducts.filter(p => p.category === 'مانجا');
        const sortedManga = sortProducts(mangaItems);
        const startIndex = page * mangaItemsPerPage;
        const endIndex = startIndex + mangaItemsPerPage;
        const itemsToShow = sortedManga.slice(startIndex, endIndex);
        
        const container = document.getElementById('manga-container');
        if (container) {
            container.innerHTML = '';
            
            itemsToShow.forEach(product => {
                const item = document.createElement('div');
                item.className = 'scroll-item manga-item';
                item.onclick = () => openProductDetail(product.id);
                item.innerHTML = `
                    <img src="${getProductImage(product)}" alt="${product.title}" class="scroll-image">
                    <div class="scroll-info">
                        <div class="scroll-title rtl-text">${product.title}</div>
                        <div class="scroll-title ltr-text" style="display: none;">${product.titleEn}</div>
                        <div class="scroll-type rtl-text">${product.subcategory}</div>
                        <div class="scroll-type ltr-text" style="display: none;">${product.subcategoryEn}</div>
                    </div>
                `;
                container.appendChild(item);
            });
            
            document.getElementById('current-manga').textContent = page + 1;
            document.querySelectorAll('.page-dot').forEach((dot, index) => {
                if (index === page) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        updateMangaNavigation();
    }
    
    function goToMangaPage(page) {
        const mangaItems = allProducts.filter(p => p.category === 'مانجا');
        const sortedManga = sortProducts(mangaItems);
        if (page >= 0 && page < Math.ceil(sortedManga.length / mangaItemsPerPage)) {
            showMangaPage(page);
        }
    }
    
    function scrollManga(direction) {
        const mangaItems = allProducts.filter(p => p.category === 'مانجا');
        const sortedManga = sortProducts(mangaItems);
        const totalPages = Math.ceil(sortedManga.length / mangaItemsPerPage);
        
        if (direction === 'next') {
            if (currentMangaPage < totalPages - 1) {
                goToMangaPage(currentMangaPage + 1);
            }
        } else if (direction === 'prev') {
            if (currentMangaPage > 0) {
                goToMangaPage(currentMangaPage - 1);
            }
        }
    }
    
    function updateMangaNavigation() {
        const mangaItems = allProducts.filter(p => p.category === 'مانجا');
        const sortedManga = sortProducts(mangaItems);
        const totalPages = Math.ceil(sortedManga.length / mangaItemsPerPage);
        const prevButton = document.getElementById('prev-manga');
        const nextButton = document.getElementById('next-manga');
        
        if (prevButton) prevButton.disabled = currentMangaPage === 0;
        if (nextButton) nextButton.disabled = currentMangaPage === totalPages - 1;
    }

    // ====== إدارة التقسيم للروايات ======
    function initializeNovels() {
        // تصنيف 16+
        const novels16 = allProducts.filter(p => p.category === 'روايات' && p.ratingCategory === '16');
        const sortedNovels16 = sortProducts(novels16);
        novelPages['16'].items = sortedNovels16;
        novelPages['16'].total = Math.ceil(sortedNovels16.length / novelsPerPage);
        showNovelPage('16', 0);
        
        // تصنيف 18+
        const novels18 = allProducts.filter(p => p.category === 'روايات' && p.ratingCategory === '18');
        const sortedNovels18 = sortProducts(novels18);
        novelPages['18'].items = sortedNovels18;
        novelPages['18'].total = Math.ceil(sortedNovels18.length / novelsPerPage);
        showNovelPage('18', 0);
        
        // جميع الأعمار
        const novelsAll = allProducts.filter(p => p.category === 'روايات' && p.ratingCategory === 'all');
        const sortedNovelsAll = sortProducts(novelsAll);
        novelPages['all'].items = sortedNovelsAll;
        novelPages['all'].total = Math.ceil(sortedNovelsAll.length / novelsPerPage);
        showNovelPage('all', 0);
    }
    
    function showNovelPage(category, page) {
        novelPages[category].current = page;
        const items = novelPages[category].items;
        const startIndex = page * novelsPerPage;
        const endIndex = startIndex + novelsPerPage;
        const itemsToShow = items.slice(startIndex, endIndex);
        
        const container = document.getElementById(`novels-${category}`);
        if (container) {
            container.innerHTML = '';
            
            itemsToShow.forEach(product => {
                const card = createProductCard(product);
                container.appendChild(card);
            });
            
            // تحديث المعلومات
            const currentPageEl = document.getElementById(`novels-${category}-current-page`);
            const totalPagesEl = document.getElementById(`novels-${category}-total-pages`);
            if (currentPageEl) currentPageEl.textContent = page + 1;
            if (totalPagesEl) totalPagesEl.textContent = novelPages[category].total;
            
            // إظهار/إخفاء أزرار التنقل
            const nav = document.getElementById(`novels-${category}-navigation`);
            if (nav) {
                if (novelPages[category].total > 1) {
                    nav.style.display = 'flex';
                } else {
                    nav.style.display = 'none';
                }
            }
        }
    }
    
    function prevNovelPage(category) {
        if (novelPages[category].current > 0) {
            showNovelPage(category, novelPages[category].current - 1);
        }
    }
    
    function nextNovelPage(category) {
        if (novelPages[category].current < novelPages[category].total - 1) {
            showNovelPage(category, novelPages[category].current + 1);
        }
    }
    
    function switchNovelTab(index) {
        const tabs = document.querySelectorAll('.tabs .tab');
        const contents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => tab.classList.remove('active'));
        contents.forEach(content => content.classList.remove('active'));
        
        tabs[index].classList.add('active');
        contents[index].classList.add('active');
        
        // إعادة تعيين إلى الصفحة الأولى عند التبديل
        const categories = ['16', '18', 'all'];
        const currentCategory = categories[index];
        if (novelPages[currentCategory].items.length > 0) {
            showNovelPage(currentCategory, 0);
        }
    }

    // ====== إدارة التقسيم للفيديوهات ======
    function initializeVideos() {
        // خيال سحري
        const fantasyVideos = allProducts.filter(p => p.category === 'فيديوهات' && p.subcategory === 'الخيال السحري');
        const sortedFantasy = sortProducts(fantasyVideos);
        videoPages['fantasy'].items = sortedFantasy;
        videoPages['fantasy'].total = Math.ceil(sortedFantasy.length / videosPerPage);
        showVideoPage('fantasy', 0);
        
        // رعب
        const horrorVideos = allProducts.filter(p => p.category === 'فيديوهات' && p.subcategory === 'الرعب');
        const sortedHorror = sortProducts(horrorVideos);
        videoPages['horror'].items = sortedHorror;
        videoPages['horror'].total = Math.ceil(sortedHorror.length / videosPerPage);
        showVideoPage('horror', 0);
        
        // غموض
        const mysteryVideos = allProducts.filter(p => p.category === 'فيديوهات' && p.subcategory === 'الغموض');
        const sortedMystery = sortProducts(mysteryVideos);
        videoPages['mystery'].items = sortedMystery;
        videoPages['mystery'].total = Math.ceil(sortedMystery.length / videosPerPage);
        showVideoPage('mystery', 0);
        
        // سخرية
        const comedyVideos = allProducts.filter(p => p.category === 'فيديوهات' && p.subcategory === 'السخرية');
        const sortedComedy = sortProducts(comedyVideos);
        videoPages['comedy'].items = sortedComedy;
        videoPages['comedy'].total = Math.ceil(sortedComedy.length / videosPerPage);
        showVideoPage('comedy', 0);
        
        // مغامرة
        const adventureVideos = allProducts.filter(p => p.category === 'فيديوهات' && p.subcategory === 'المغامرة');
        const sortedAdventure = sortProducts(adventureVideos);
        videoPages['adventure'].items = sortedAdventure;
        videoPages['adventure'].total = Math.ceil(sortedAdventure.length / videosPerPage);
        showVideoPage('adventure', 0);
    }
    
    function showVideoPage(category, page) {
        videoPages[category].current = page;
        const items = videoPages[category].items;
        const startIndex = page * videosPerPage;
        const endIndex = startIndex + videosPerPage;
        const itemsToShow = items.slice(startIndex, endIndex);
        
        const container = document.getElementById(`${category}-videos`);
        if (container) {
            container.innerHTML = '';
            
            itemsToShow.forEach(product => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => openProductDetail(product.id);
                card.innerHTML = `
                    <div class="video-player">
                        <img src="${getProductImage(product)}" alt="${product.title}" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="video-info">
                        <div class="video-title rtl-text">${product.title}</div>
                        <div class="video-title ltr-text" style="display: none;">${product.titleEn}</div>
                        <div class="video-duration">
                            <i class="far fa-clock"></i>
                            ${product.chapters ? product.chapters.reduce((sum, ch) => sum + parseInt(ch.duration), 0) : '60'} دقيقة
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // تحديث المعلومات
            const currentPageEl = document.getElementById(`${category}-current-page`);
            const totalPagesEl = document.getElementById(`${category}-total-pages`);
            if (currentPageEl) currentPageEl.textContent = page + 1;
            if (totalPagesEl) totalPagesEl.textContent = videoPages[category].total;
            
            // إظهار/إخفاء أزرار التنقل
            const nav = document.getElementById(`${category}-navigation`);
            if (nav) {
                if (videoPages[category].total > 1) {
                    nav.style.display = 'flex';
                } else {
                    nav.style.display = 'none';
                }
            }
        }
    }
    
    function prevVideoPage(category) {
        if (videoPages[category].current > 0) {
            showVideoPage(category, videoPages[category].current - 1);
        }
    }
    
    function nextVideoPage(category) {
        if (videoPages[category].current < videoPages[category].total - 1) {
            showVideoPage(category, videoPages[category].current + 1);
        }
    }
    
    function switchVideoTab(index) {
        const tabs = document.querySelectorAll('.video-tab');
        const contents = document.querySelectorAll('.video-tab-content');
        
        tabs.forEach(tab => tab.classList.remove('active'));
        contents.forEach(content => content.classList.remove('active'));
        
        tabs[index].classList.add('active');
        contents[index].classList.add('active');
        
        // إعادة تعيين إلى الصفحة الأولى عند التبديل
        const categories = ['fantasy', 'horror', 'mystery', 'comedy', 'adventure'];
        const currentCategory = categories[index];
        if (videoPages[currentCategory].items.length > 0) {
            showVideoPage(currentCategory, 0);
        }
    }

    // ====== إنشاء بطاقة المنتج مع دعم Base64 ======
    function createProductCard(product) {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.onclick = () => openProductDetail(product.id);
        card.innerHTML = `
            <img src="${getProductImage(product)}" alt="${product.title}" class="card-image">
            <div class="card-content">
                <h3 class="card-title rtl-text">${product.title}</h3>
                <h3 class="card-title ltr-text" style="display: none;">${product.titleEn}</h3>
                <div class="card-category">
                    <i class="fas fa-tag"></i>
                    <span class="rtl-text">${product.subcategory}</span>
                    <span class="ltr-text" style="display: none;">${product.subcategoryEn}</span>
                </div>
                <p class="card-description rtl-text">${product.description.substring(0, 80)}...</p>
                <p class="card-description ltr-text" style="display: none;">${product.descriptionEn.substring(0, 80)}...</p>
                <div class="card-footer">
                    <span class="card-price">${product.price}</span>
                    <button class="card-button" onclick="addToCart('${product.id}', event)">
                        <i class="fas fa-cart-plus"></i>
                        <span class="rtl-text">شراء</span>
                        <span class="ltr-text" style="display: none;">Buy</span>
                    </button>
                </div>
            </div>
        `;
        return card;
    }

    // ====== عرض جميع المحتوى ======
    function renderAllContent() {
        // قصص
        const storiesContainer = document.getElementById('stories-container');
        if (storiesContainer) {
            storiesContainer.innerHTML = '';
            const stories = allProducts.filter(p => p.category === 'قصص');
            const sortedStories = sortProducts(stories);
            sortedStories.forEach(product => {
                const card = createProductCard(product);
                storiesContainer.appendChild(card);
            });
        }
        
        // تهيئة باقي المحتوى
        initializeMangaNavigation();
        initializeVideos();
        initializeNovels();
    }

    // ====== دالة مساعدة لتنسيق التاريخ ======
    function formatCommentDate(dateString) {
        if (!dateString) return currentLanguage === 'ar' ? 'تاريخ غير معروف' : 'Unknown date';
        
        try {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (currentLanguage === 'ar') {
                if (diffMins < 1) return 'الآن';
                if (diffMins < 60) return `قبل ${diffMins} دقيقة`;
                if (diffHours < 24) return `قبل ${diffHours} ساعة`;
                if (diffDays === 1) return 'أمس';
                if (diffDays < 7) return `قبل ${diffDays} يوم`;
                return date.toLocaleDateString('ar-SA', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } else {
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} mins ago`;
                if (diffHours < 24) return `${diffHours} hours ago`;
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
        } catch (error) {
            console.error('Error formatting date:', error);
            return dateString;
        }
    }

    // ====== لوحة تفاصيل المنتج ======
    async function openProductDetail(productId) {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        
        currentProductId = productId;
        
        // تعيين البيانات الأساسية
        document.getElementById('product-detail-title').textContent = product.title;
        document.getElementById('product-detail-title-en').textContent = product.titleEn;
        document.getElementById('product-detail-poster').src = getProductImage(product);
        document.getElementById('product-detail-category').textContent = product.subcategory;
        document.getElementById('product-detail-category-en').textContent = product.subcategoryEn;
        document.getElementById('product-detail-price').textContent = product.price;
        document.getElementById('product-detail-description').textContent = product.description;
        document.getElementById('product-detail-description-en').textContent = product.descriptionEn;
        document.getElementById('product-detail-name').textContent = product.title;
        document.getElementById('product-detail-name-en').textContent = product.titleEn;
        document.getElementById('product-detail-type').textContent = `${product.type} - ${product.subcategory}`;
        document.getElementById('product-detail-type-en').textContent = `${product.typeEn} - ${product.subcategoryEn}`;
        
        // تحديث التقييم
        updateRatingStars(product.rating);
        
        // إضافة قسم معلومات المنتج
        const summarySection = document.getElementById('product-summary-section');
        if (summarySection) {
            summarySection.innerHTML = `
                <div class="product-detail-summary">
                    <h3 class="section-label">
                        <i class="fas fa-info-circle"></i>
                        <span class="rtl-text">معلومات المنتج</span>
                        <span class="ltr-text" style="display: none;">Product Information</span>
                    </h3>
                    <div class="product-detail-summary-grid">
                        <div class="summary-item">
                            <i class="fas fa-tag"></i>
                            <div>
                                <div class="summary-label rtl-text">الفئة</div>
                                <div class="summary-label ltr-text" style="display: none;">Category</div>
                                <div class="summary-value rtl-text">${product.category}</div>
                                <div class="summary-value ltr-text" style="display: none;">${product.categoryEn}</div>
                            </div>
                        </div>
                        
                        <div class="summary-item">
                            <i class="fas fa-layer-group"></i>
                            <div>
                                <div class="summary-label rtl-text">النوع</div>
                                <div class="summary-label ltr-text" style="display: none;">Type</div>
                                <div class="summary-value rtl-text">${product.type}</div>
                                <div class="summary-value ltr-text" style="display: none;">${product.typeEn}</div>
                            </div>
                        </div>
                        
                        <div class="summary-item">
                            <i class="fas fa-dollar-sign"></i>
                            <div>
                                <div class="summary-label rtl-text">السعر</div>
                                <div class="summary-label ltr-text" style="display: none;">Price</div>
                                <div class="summary-value">${product.price}</div>
                            </div>
                        </div>
                        
                        <div class="summary-item">
                            <i class="fas fa-box"></i>
                            <div>
                                <div class="summary-label rtl-text">التنسيق</div>
                                <div class="summary-label ltr-text" style="display: none;">Format</div>
                                <div class="summary-value rtl-text">${product.format}</div>
                                <div class="summary-value ltr-text" style="display: none;">${product.formatEn}</div>
                            </div>
                        </div>
                        
                        <div class="summary-item">
                            <i class="fas fa-star"></i>
                            <div>
                                <div class="summary-label rtl-text">التقييم</div>
                                <div class="summary-label ltr-text" style="display: none;">Rating</div>
                                <div class="summary-value">${product.rating}/5</div>
                            </div>
                        </div>
                        
                        <div class="summary-item">
                            <i class="fas fa-calendar-alt"></i>
                            <div>
                                <div class="summary-label rtl-text">التصنيف العمري</div>
                                <div class="summary-label ltr-text" style="display: none;">Age Rating</div>
                                <div class="summary-value rtl-text">${product.ratingCategory === 'all' ? 'جميع الأعمار' : product.ratingCategory + '+'}</div>
                                <div class="summary-value ltr-text" style="display: none;">${product.ratingCategory === 'all' ? 'All Ages' : product.ratingCategory + '+'}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // تحديث العناصر بناءً على اللغة
        updateLanguageElements();
        
        // إظهار/إخفاء قسم الأجزاء (للفيديوهات فقط)
        const chaptersSection = document.getElementById('chapters-section');
        if (chaptersSection) {
            if (product.chapters && product.chapters.length > 0) {
                chaptersSection.style.display = 'block';
                const chaptersContainer = document.getElementById('product-chapters');
                if (chaptersContainer) {
                    chaptersContainer.innerHTML = '';
                    product.chapters.forEach(chapter => {
                        const chapterElement = document.createElement('div');
                        chapterElement.className = 'chapter-item';
                        chapterElement.innerHTML = `
                            <div class="chapter-info">
                                <h4>${chapter.title}</h4>
                                <div class="chapter-duration">
                                    <i class="far fa-clock"></i> ${chapter.duration}
                                </div>
                            </div>
                            <button class="watch-button" onclick="watchChapter('${chapter.id}')">
                                <i class="fas fa-play"></i>
                                <span class="rtl-text">مشاهدة</span>
                                <span class="ltr-text" style="display: none;">Watch</span>
                            </button>
                        `;
                        chaptersContainer.appendChild(chapterElement);
                    });
                }
            } else {
                chaptersSection.style.display = 'none';
            }
        }
        
        // إنشاء قسم التعليقات
        const commentsSection = document.getElementById('comments-section');
        if (commentsSection) {
            commentsSection.innerHTML = `
                <div class="section-header">
                    <h3 id="comments-count" class="section-label">
                        <i class="fas fa-comments"></i>
                        <span class="rtl-text">التعليقات (0)</span>
                        <span class="ltr-text" style="display: none;">Comments (0)</span>
                    </h3>
                </div>
                
                <div class="comment-form">
                    <div class="comment-input-container">
                        <textarea 
                            id="product-comment-input" 
                            class="comment-input" 
                            placeholder="${currentLanguage === 'ar' ? 'اكتب تعليقك هنا...' : 'Write your comment here...'}"
                            rows="3"
                        ></textarea>
                        <button class="comment-submit-btn" onclick="addProductComment()">
                            <i class="fas fa-paper-plane"></i>
                            <span class="rtl-text">إرسال</span>
                            <span class="ltr-text" style="display: none;">Send</span>
                        </button>
                    </div>
                </div>
                
                <div id="product-comments" class="comments-list">
                    <!-- التعليقات سيتم تحميلها هنا -->
                </div>
            `;
        }
        
        // تحميل التعليقات من Firebase
        await loadCommentsFromFirebase(productId);
        
        // إظهار اللوحة
        document.getElementById('product-detail-overlay').style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // تحديث العناصر بناءً على اللغة
        updateLanguageElements();
    }
    
    function closeProductDetail() {
        document.getElementById('product-detail-overlay').style.display = 'none';
        document.body.style.overflow = 'auto';
        currentProductId = null;
    }
    
    function updateRatingStars(rating) {
        const starsContainer = document.getElementById('product-detail-stars');
        if (starsContainer) {
            starsContainer.innerHTML = '';
            
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 0; i < fullStars; i++) {
                const star = document.createElement('i');
                star.className = 'fas fa-star';
                starsContainer.appendChild(star);
            }
            
            if (hasHalfStar) {
                const halfStar = document.createElement('i');
                halfStar.className = 'fas fa-star-half-alt';
                starsContainer.appendChild(halfStar);
            }
            
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                const emptyStar = document.createElement('i');
                emptyStar.className = 'far fa-star';
                starsContainer.appendChild(emptyStar);
            }
            
            document.getElementById('product-detail-rating').textContent = `${rating}/5`;
        }
    }
    
    function watchChapter(chapterId) {
        alert(currentLanguage === 'ar' ? 
            `جاري تشغيل الفصل: ${chapterId}` : 
            `Playing chapter: ${chapterId}`);
    }
    
    // ====== إضافة تعليق مع Firebase ======
    async function addProductComment() {
        const user = checkAuthBeforeComment();
        if (!user) return;
        
        const input = document.getElementById('product-comment-input');
        const text = input.value.trim();
        
        if (!text) {
            showNotification(currentLanguage === 'ar' ? 
                'الرجاء كتابة تعليق' : 
                'Please write a comment');
            return;
        }
        
        if (!currentProductId) {
            showNotification(currentLanguage === 'ar' ? 
                'لم يتم تحديد منتج' : 
                'No product selected');
            return;
        }
        
        try {
            // إنشاء مرجع للتعليقات
            const commentsRef = ref(database, 'comments/' + currentProductId);
            const newCommentRef = push(commentsRef);
            
            const commentData = {
                author: user.username || user.email.split('@')[0],
                authorId: user.uid,
                text: text,
                date: new Date().toISOString(),
                productId: currentProductId,
                productTitle: allProducts.find(p => p.id === currentProductId)?.title || 'Unknown',
                timestamp: Date.now()
            };
            
            await set(newCommentRef, commentData);
            
            // إضافة التعليق إلى الواجهة مباشرة
            const commentsContainer = document.getElementById('product-comments');
            if (commentsContainer) {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment-item';
                commentElement.innerHTML = `
                    <div class="comment-header">
                        <span class="comment-author">${commentData.author}</span>
                        <span class="comment-date">${formatCommentDate(commentData.date)}</span>
                    </div>
                    <p class="comment-text">${commentData.text}</p>
                `;
                
                // إضافة التعليق في الأعلى
                if (commentsContainer.firstChild) {
                    commentsContainer.insertBefore(commentElement, commentsContainer.firstChild);
                } else {
                    commentsContainer.appendChild(commentElement);
                }
                
                // تحديث عداد التعليقات
                updateCommentsCount();
            }
            
            // مسح حقل الإدخال
            input.value = '';
            
            // إظهار إشعار النجاح
            showNotification(currentLanguage === 'ar' ? 
                'تمت إضافة تعليقك بنجاح' : 
                'Your comment has been added successfully');
                
        } catch (error) {
            console.error('Error adding comment:', error);
            showNotification(currentLanguage === 'ar' ? 
                'حدث خطأ أثناء إضافة التعليق' : 
                'Error adding comment');
        }
    }
    
    // ====== تحميل التعليقات من Firebase ======
    async function loadCommentsFromFirebase(productId) {
        try {
            const commentsRef = ref(database, 'comments/' + productId);
            const snapshot = await get(commentsRef);
            
            const commentsContainer = document.getElementById('product-comments');
            if (!commentsContainer) return;
            
            commentsContainer.innerHTML = '';
            
            if (snapshot.exists()) {
                const comments = snapshot.val();
                const commentsArray = [];
                
                // تحويل التعليقات إلى مصفوفة
                Object.keys(comments).forEach(commentId => {
                    const comment = comments[commentId];
                    commentsArray.push({
                        id: commentId,
                        ...comment
                    });
                });
                
                // ترتيب التعليقات من الأحدث إلى الأقدم
                commentsArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                
                // عرض التعليقات
                if (commentsArray.length > 0) {
                    commentsArray.forEach(comment => {
                        const commentElement = document.createElement('div');
                        commentElement.className = 'comment-item';
                        commentElement.innerHTML = `
                            <div class="comment-header">
                                <span class="comment-author">${comment.author}</span>
                                <span class="comment-date">${formatCommentDate(comment.date)}</span>
                            </div>
                            <p class="comment-text">${comment.text}</p>
                        `;
                        commentsContainer.appendChild(commentElement);
                    });
                } else {
                    showNoCommentsMessage(commentsContainer);
                }
            } else {
                showNoCommentsMessage(commentsContainer);
            }
            
            // تحديث عداد التعليقات
            updateCommentsCount();
            
        } catch (error) {
            console.error('Error loading comments:', error);
            const commentsContainer = document.getElementById('product-comments');
            if (commentsContainer) {
                showErrorMessage(commentsContainer);
            }
        }
    }
    
    // ====== تحديث عداد التعليقات ======
    function updateCommentsCount() {
        const commentsContainer = document.getElementById('product-comments');
        if (!commentsContainer) return;
        
        // عد العناصر التي لديها كلاس comment-item
        const commentItems = commentsContainer.querySelectorAll('.comment-item:not(.no-comments)');
        const commentsCount = commentItems.length;
        
        const countElement = document.getElementById('comments-count');
        if (countElement) {
            if (currentLanguage === 'ar') {
                countElement.innerHTML = `<i class="fas fa-comments"></i> التعليقات (${commentsCount})`;
            } else {
                countElement.innerHTML = `<i class="fas fa-comments"></i> Comments (${commentsCount})`;
            }
        }
    }
    
    function showNoCommentsMessage(container) {
        container.innerHTML = `
            <div class="comment-item no-comments">
                <p class="comment-text" style="text-align: center; color: var(--text-muted); padding: 30px 0;">
                    <i class="far fa-comment-dots" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></i><br>
                    <span class="rtl-text">لا توجد تعليقات بعد. كن أول من يعلق!</span>
                    <span class="ltr-text" style="display: none;">No comments yet. Be the first to comment!</span>
                </p>
            </div>
        `;
    }
    
    function showErrorMessage(container) {
        container.innerHTML = `
            <div class="comment-item">
                <p class="comment-text" style="text-align: center; color: var(--error-color); padding: 20px;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    <span class="rtl-text">حدث خطأ في تحميل التعليقات</span>
                    <span class="ltr-text" style="display: none;">Error loading comments</span>
                </p>
            </div>
        `;
    }
    
    function purchaseProduct() {
        const user = checkAuthBeforePurchase();
        if (!user) return;
        
        const product = allProducts.find(p => p.id === currentProductId);
        if (!product) {
            showNotification(currentLanguage === 'ar' ? 
                'المنتج غير موجود' : 
                'Product not found');
            return;
        }
        
        // إضافة المنتج إلى السلة
        addToCart(currentProductId);
        closeProductDetail();
    }

    // ====== تحديث دالة البحث لجلب المنتجات من Firebase مباشرة ======
    async function searchProducts() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        
        if (!searchTerm.trim()) {
            renderSearchResults([]);
            return;
        }
        
        try {
            // جلب جميع المنتجات من Firebase في كل بحث
            const productsRef = ref(database, 'products');
            const snapshot = await get(productsRef);
            let filteredProducts = [];
            
            if (snapshot.exists()) {
                const products = snapshot.val();
                
                Object.keys(products).forEach(productId => {
                    const product = {
                        id: productId,
                        ...products[productId]
                    };
                    
                    // التأكد من وجود صورة
                    product.image = getProductImage(product);
                    
                    // البحث في جميع الحقول
                    const searchFields = [
                        product.title?.toLowerCase() || '',
                        product.titleEn?.toLowerCase() || '',
                        product.category?.toLowerCase() || '',
                        product.categoryEn?.toLowerCase() || '',
                        product.subcategory?.toLowerCase() || '',
                        product.subcategoryEn?.toLowerCase() || '',
                        product.description?.toLowerCase() || '',
                        product.descriptionEn?.toLowerCase() || '',
                        product.type?.toLowerCase() || '',
                        product.typeEn?.toLowerCase() || '',
                        product.format?.toLowerCase() || '',
                        product.formatEn?.toLowerCase() || ''
                    ];
                    
                    if (searchFields.some(field => field.includes(searchTerm))) {
                        filteredProducts.push(product);
                    }
                });
                
                // تحديث المنتجات المحلية
                allProducts = Object.keys(products).map(productId => ({
                    id: productId,
                    ...products[productId],
                    image: getProductImage(products[productId])
                }));
            }
            
            renderSearchResults(filteredProducts);
            
        } catch (error) {
            console.error('Error searching products:', error);
            // البحث في المنتجات المحلية كبديل
            const localFiltered = allProducts.filter(product => {
                const searchFields = [
                    product.title?.toLowerCase() || '',
                    product.titleEn?.toLowerCase() || '',
                    product.category?.toLowerCase() || '',
                    product.categoryEn?.toLowerCase() || '',
                    product.subcategory?.toLowerCase() || '',
                    product.subcategoryEn?.toLowerCase() || '',
                    product.description?.toLowerCase() || '',
                    product.descriptionEn?.toLowerCase() || ''
                ];
                
                return searchFields.some(field => field.includes(searchTerm));
            });
            
            renderSearchResults(localFiltered);
        }
    }

    // ====== دالة عرض كل القصص ======
    function displayAllStories() {
        const stories = allProducts.filter(p => p.category === 'قصص');
        const sortedStories = sortProducts(stories);
        
        // إنشاء محتوى النافذة المنبثقة
        const modalContent = `
            <div class="all-stories-header">
                <h2>
                    <i class="fas fa-book"></i>
                    <span class="rtl-text">جميع القصص (${sortedStories.length})</span>
                    <span class="ltr-text" style="display: none;">All Stories (${sortedStories.length})</span>
                </h2>
                <button class="close-modal-btn" onclick="closeAllStories()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="all-stories-grid" id="all-stories-grid">
                ${sortedStories.map(product => `
                    <div class="all-stories-card" onclick="openProductDetail('${product.id}')">
                        <div class="all-stories-card-image">
                            <img src="${getProductImage(product)}" alt="${product.title}">
                        </div>
                        <div class="all-stories-card-content">
                            <h3 class="all-stories-card-title rtl-text">${product.title}</h3>
                            <h3 class="all-stories-card-title ltr-text" style="display: none;">${product.titleEn}</h3>
                            
                            <div class="all-stories-card-meta">
                                <span class="all-stories-meta-item">
                                    <i class="fas fa-star" style="color: var(--accent-color);"></i> ${product.rating}
                                </span>
                                
                                <span class="all-stories-meta-item rtl-text">
                                    <i class="fas fa-tag"></i> ${product.subcategory}
                                </span>
                                <span class="all-stories-meta-item ltr-text" style="display: none;">
                                    <i class="fas fa-tag"></i> ${product.subcategoryEn}
                                </span>
                            </div>
                            
                            <p class="all-stories-card-description rtl-text">
                                ${product.description.substring(0, 150)}...
                            </p>
                            <p class="all-stories-card-description ltr-text" style="display: none;">
                                ${product.descriptionEn.substring(0, 150)}...
                            </p>
                            
                            <div class="all-stories-card-footer">
                                <div class="all-stories-card-price">${product.price}</div>
                                <button class="all-stories-card-button" onclick="event.stopPropagation(); addToCart('${product.id}', event)">
                                    <i class="fas fa-cart-plus"></i>
                                    <span class="rtl-text">شراء</span>
                                    <span class="ltr-text" style="display: none;">Buy</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        
        // تعيين المحتوى في النافذة المنبثقة
        document.getElementById('all-stories-content').innerHTML = modalContent;
        
        // إظهار النافذة المنبثقة مع تأثير انزلاقي
        const modal = document.getElementById('all-stories-modal');
        modal.style.display = 'block';
        
        // إضافة تأثير ظهور تدريجي
        setTimeout(() => {
            modal.style.opacity = '1';
            modal.style.transform = 'translateY(0)';
        }, 10);
        
        document.body.style.overflow = 'hidden';
        
        // تحديث العناصر بناءً على اللغة
        updateLanguageElements();
    }
    
    function closeAllStories() {
        const modal = document.getElementById('all-stories-modal');
        
        // إضافة تأثير اختفاء تدريجي
        modal.style.opacity = '0';
        modal.style.transform = 'translateY(100%)';
        
        setTimeout(() => {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }, 300);
    }

    // ====== لوحة البحث مع المنتجات الصغيرة ======
    function openSearch() {
        document.getElementById('search-overlay').style.display = 'block';
        document.body.style.overflow = 'hidden';
        searchProducts();
        document.getElementById('search-input').focus();
    }
    
    function closeSearch() {
        document.getElementById('search-overlay').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    function updateSearchPlaceholder() {
        const input = document.getElementById('search-input');
        if (input) {
            input.placeholder = currentLanguage === 'ar' ? 
                'ابحث عن كتب، قصص، فيديوهات...' : 
                'Search for books, stories, videos...';
        }
    }
    
    function renderSearchResults(products) {
        const container = document.getElementById('search-results');
        if (!container) return;
        
        container.innerHTML = '';
        
        if (products.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.innerHTML = `
                <i class="fas fa-search"></i>
                <p class="rtl-text" style="margin-top: 20px;">لم يتم العثور على منتجات تطابق بحثك</p>
                <p class="ltr-text" style="display: none; margin-top: 20px;">No products found matching your search</p>
                <p style="color: var(--text-muted); margin-top: 10px; font-size: 14px;">
                    <span class="rtl-text">جرب كلمات بحث مختلفة</span>
                    <span class="ltr-text" style="display: none;">Try different search keywords</span>
                </p>
            `;
            container.appendChild(noResults);
        } else {
            const sortedProducts = sortProducts(products);
            const grid = document.createElement('div');
            grid.className = 'search-products-grid';
            
            sortedProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'search-product-card';
                card.onclick = () => openProductDetail(product.id);
                card.innerHTML = `
                    <img src="${getProductImage(product)}" alt="${product.title}">
                    <div class="search-product-card-content">
                        <h3 class="search-product-card-title rtl-text">${product.title}</h3>
                        <h3 class="search-product-card-title ltr-text" style="display: none;">${product.titleEn}</h3>
                        
                        <div class="search-product-card-meta">
                            <span class="search-product-meta-item rtl-text">
                                <i class="fas fa-tag"></i> ${product.category}
                            </span>
                            <span class="search-product-meta-item ltr-text" style="display: none;">
                                <i class="fas fa-tag"></i> ${product.categoryEn}
                            </span>
                            
                            <span class="search-product-meta-item">
                                <i class="fas fa-star" style="color: var(--accent-color);"></i> ${product.rating}
                            </span>
                            
                            <span class="search-product-meta-item rtl-text">
                                <i class="fas fa-box"></i> ${product.format}
                            </span>
                            <span class="search-product-meta-item ltr-text" style="display: none;">
                                <i class="fas fa-box"></i> ${product.formatEn}
                            </span>
                        </div>
                        
                        <p class="card-description rtl-text" style="font-size: 14px; margin-bottom: 15px;">
                            ${product.description.substring(0, 100)}...
                        </p>
                        <p class="card-description ltr-text" style="display: none; font-size: 14px; margin-bottom: 15px;">
                            ${product.descriptionEn.substring(0, 100)}...
                        </p>
                        
                        <div class="search-product-card-price">${product.price}</div>
                        
                        <div class="search-product-card-footer">
                            <button class="search-product-card-button" onclick="addToCart('${product.id}', event)">
                                <i class="fas fa-cart-plus"></i>
                                <span class="rtl-text">شراء</span>
                                <span class="ltr-text" style="display: none;">Buy</span>
                            </button>
                            
                            <button class="search-product-card-button" style="background: var(--gradient-secondary);" 
                                    onclick="event.stopPropagation(); openProductDetail('${product.id}')">
                                <i class="fas fa-eye"></i>
                                <span class="rtl-text">عرض</span>
                                <span class="ltr-text" style="display: none;">View</span>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            container.appendChild(grid);
        }
        
        // تحديث العداد
        if (currentLanguage === 'ar') {
            document.getElementById('search-count').textContent = `تم العثور على ${products.length} منتج`;
            document.getElementById('search-count-en').style.display = 'none';
        } else {
            document.getElementById('search-count-en').textContent = `${products.length} products found`;
            document.getElementById('search-count-en').style.display = '';
            document.getElementById('search-count').style.display = 'none';
        }
        
        // تحديث العناصر بناءً على اللغة
        updateLanguageElements();
    }

    // ====== وظائف مساعدة ======
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateLanguageElements() {
        // تحديث تنسيق المنتج بناءً على اللغة
        const formatElements = document.querySelectorAll('[id*="format"]');
        formatElements.forEach(el => {
            if (currentLanguage === 'ar') {
                if (el.id.includes('en')) {
                    el.style.display = 'none';
                } else if (!el.id.includes('badge')) {
                    el.style.display = '';
                }
            } else {
                if (el.id.includes('en')) {
                    el.style.display = '';
                } else if (!el.id.includes('badge')) {
                    el.style.display = 'none';
                }
            }
        });
    }

    function openPrivacy() {
        alert(currentLanguage === 'ar' ? 'صفحة الخصوصية قيد التطوير' : 'Privacy page under development');
    }

    function openOrderHistory() {
        const user = checkAuth();
        if (!user) return;
        
        alert(currentLanguage === 'ar' ? 'صفحة سجل الطلبات قيد التطوير' : 'Order history page under development');
    }

    function openAccount() {
        const user = checkAuth();
        if (!user) return;
        
        alert(currentLanguage === 'ar' ? 'صفحة الحساب قيد التطوير' : 'Account page under development');
    }

    function openFeedback() {
        const user = checkAuth();
        if (!user) return;
        
        alert(currentLanguage === 'ar' ? 'صفحة الرأي العام قيد التطوير' : 'Feedback page under development');
    }

    function openTerms() {
        alert(currentLanguage === 'ar' ? 'صفحة سياسة الاستخدام قيد التطوير' : 'Terms page under development');
    }

    function openFAQ() {
        alert(currentLanguage === 'ar' ? 'صفحة الأسئلة الشائعة قيد التطوير' : 'FAQ page under development');
    }

    function openContact() {
        alert(currentLanguage === 'ar' ? 'صفحة الاتصال بنا قيد التطوير' : 'Contact page under development');
    }

    function openReport() {
        const user = checkAuth();
        if (!user) return;
        
        alert(currentLanguage === 'ar' ? 'صفحة الإبلاغ عن مشكلة قيد التطوير' : 'Report issue page under development');
    }

    function openSuggestions() {
        const user = checkAuth();
        if (!user) return;
        
        alert(currentLanguage === 'ar' ? 'صفحة المقترحات قيد التطوير' : 'Suggestions page under development');
    }

    // ====== حفظ إحصائيات المستخدم ======
    async function trackUserActivity(action, productId = null) {
        try {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (!user || !user.uid) return;
            
            const activityRef = ref(database, `userActivity/${user.uid}`);
            const newActivityRef = push(activityRef);
            
            const activityData = {
                action: action,
                productId: productId,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent
            };
            
            await set(newActivityRef, activityData);
        } catch (error) {
            console.error('Error tracking user activity:', error);
        }
    }

    // ====== تهيئة الصفحة عند التحميل ======
    async function initializePage() {
        // التحقق من تسجيل الدخول أولاً
        const user = checkAuth();
        if (!user) return;
        
        // عرض اسم المستخدم في الشريط العلوي
        const userEmail = user.email || 'مستخدم';
        const welcomeText = document.querySelector('.welcome-text');
        if (welcomeText && currentLanguage === 'ar') {
            welcomeText.textContent = `مرحباً ${userEmail.split('@')[0]}`;
        }
        
        // استعادة الاتجاه
        const savedDirection = localStorage.getItem('direction') || 'rtl';
        document.documentElement.setAttribute('dir', savedDirection);
        
        // استعادة اللغة
        const savedLang = localStorage.getItem('language') || 'ar';
        currentLanguage = savedLang;
        
        if (currentLanguage === 'en') {
            // تطبيق اللغة الإنجليزية
            document.documentElement.setAttribute('lang', 'en');
            const languageValue = document.getElementById('language-value');
            if (languageValue) languageValue.textContent = 'English';
            document.querySelectorAll('.rtl-text').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.ltr-text').forEach(el => el.style.display = '');
        } else {
            // تأكد من أن العربية هي الافتراضية
            document.documentElement.setAttribute('lang', 'ar');
            document.documentElement.setAttribute('dir', 'rtl');
        }
        
        // استعادة وضع العرض
        const savedDisplayMode = localStorage.getItem('displayMode') || 'random';
        displayMode = savedDisplayMode;
        const modeNames = { random: 'عشوائي', rating: 'الأعلى تقييماً', newest: 'الأحدث' };
        const modeNamesEn = { random: 'Random', rating: 'Highest Rated', newest: 'Newest' };
        const displayModeValue = document.getElementById('display-mode-value');
        if (displayModeValue) {
            if (currentLanguage === 'ar') {
                displayModeValue.textContent = modeNames[displayMode];
            } else {
                displayModeValue.textContent = modeNamesEn[displayMode];
            }
        }
        
        updateCartBadge();
        updateSearchPlaceholder();
        
        // استعادة إعدادات النص
        const savedSize = localStorage.getItem('textSize');
        if (savedSize) {
            const textSizeSlider = document.getElementById('textSizeSlider');
            if (textSizeSlider) {
                textSizeSlider.value = savedSize;
                updateTextSize(savedSize);
            }
        }
        
        // استعادة المظهر
        const savedTheme = localStorage.getItem('theme') || 'dark';
        currentTheme = savedTheme;
        
        // ضبط نص المظهر بناءً على اللغة
        const themeValue = document.getElementById('theme-value');
        if (themeValue) {
            if (currentLanguage === 'ar') {
                themeValue.textContent = currentTheme;
            } else {
                const themeNames = {'داكن': 'Dark', 'فاتح': 'Light', 'تلقائي': 'Auto'};
                themeValue.textContent = themeNames[currentTheme] || 'Dark';
            }
        }
        
        // تطبيق المظهر
        applyTheme();
        
        // تحميل المنتجات من Firebase
        await loadProductsFromFirebase();
        
        // إعداد مستمع في الوقت الحقيقي للمنتجات
        setupRealtimeProductsListener();
        
        // إضافة أحداث الإغلاق
        const productDetailOverlay = document.getElementById('product-detail-overlay');
        if (productDetailOverlay) {
            productDetailOverlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeProductDetail();
                }
            });
        }
        
        const searchOverlay = document.getElementById('search-overlay');
        if (searchOverlay) {
            searchOverlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSearch();
                }
            });
        }
        
        const allStoriesModal = document.getElementById('all-stories-modal');
        if (allStoriesModal) {
            allStoriesModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAllStories();
                }
            });
        }
        
        // إضافة حدث للنقر على زر "عرض الكل" للقصص
        const showAllStoriesBtn = document.getElementById('show-all-stories');
        if (showAllStoriesBtn) {
            showAllStoriesBtn.addEventListener('click', displayAllStories);
        }
        
        // تحديث المعلومات الشخصية
        updateUserProfile();
    }

    // ====== تحديث معلومات المستخدم ======
    async function updateUserProfile() {
        try {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            if (!user || !user.uid) return;
            
            const userRef = ref(database, 'users/' + user.uid);
            const snapshot = await get(userRef);
            
            if (snapshot.exists()) {
                const userData = snapshot.val();
                
                // تحديث بيانات المستخدم في التخزين المحلي
                localStorage.setItem('user', JSON.stringify({
                    ...user,
                    username: userData.username,
                    phone: userData.phone
                }));
                
                // تحديث واجهة المستخدم إذا كان هناك مكان لعرض اسم المستخدم
                const userDisplayElements = document.querySelectorAll('.user-display-name');
                userDisplayElements.forEach(el => {
                    if (userData.username) {
                        el.textContent = userData.username;
                    }
                });
            }
        } catch (error) {
            console.error('Error updating user profile:', error);
        }
    }

    // إضافة أنماط CSS للرسوم المتحركة والعناصر الجديدة
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .user-display-name {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* أنماط التعليقات */
        .comments-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-color);
        }
        
        .comment-form {
            margin-bottom: 30px;
        }
        
        .comment-input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .comment-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background: var(--darker-bg);
            color: var(--text-primary);
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .comment-submit-btn {
            align-self: flex-end;
            padding: 10px 25px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .comment-submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .comment-item {
            padding: 15px;
            background: var(--darker-bg);
            border-radius: var(--border-radius-sm);
            border-left: 3px solid var(--primary-color);
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .comment-date {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .comment-text {
            line-height: 1.6;
            color: var(--text-secondary);
        }
        
        .no-comments {
            text-align: center;
            border-left: none;
            background: transparent;
        }
        
        /* تحسين عرض الصور Base64 */
        .card-image, .scroll-image, .video-player img {
            background: var(--darker-bg);
            transition: transform 0.3s ease;
        }
        
        .card-image:hover, .scroll-image:hover {
            transform: scale(1.05);
        }
        
        /* نافذة عرض كل القصص */
        .all-stories-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .all-stories-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            background: var(--dark-bg);
        }
        
        .all-stories-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .all-stories-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            color: var(--text-primary);
        }
        
        .close-modal-btn {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .close-modal-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .all-stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }
        
        .all-stories-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }
        
        .all-stories-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .all-stories-card-image {
            height: 200px;
            overflow: hidden;
        }
        
        .all-stories-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .all-stories-card:hover .all-stories-card-image img {
            transform: scale(1.05);
        }
        
        .all-stories-card-content {
            padding: 20px;
        }
        
        .all-stories-card-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--text-primary);
            line-height: 1.4;
        }
        
        .all-stories-card-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .all-stories-meta-item {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .all-stories-card-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .all-stories-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .all-stories-card-price {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .all-stories-card-button {
            padding: 8px 20px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .all-stories-card-button:hover {
            transform: translateY(-2px);
        }
        
        /* إخفاء الأزرار إذا لم يكن هناك اتصال بالإنترنت */
        @media (max-width: 768px) {
            .admin-nav {
                flex-wrap: wrap;
            }
            
            .all-stories-grid {
                grid-template-columns: 1fr;
            }
            
            .all-stories-header h2 {
                font-size: 20px;
            }
        }
    `;
    document.head.appendChild(style);

    // حفظ الإعدادات عند الخروج
    window.addEventListener('beforeunload', () => {
        localStorage.setItem('theme', currentTheme);
        localStorage.setItem('language', currentLanguage);
        localStorage.setItem('direction', currentLanguage === 'ar' ? 'rtl' : 'ltr');
        localStorage.setItem('displayMode', displayMode);
    });

    // تشغيل تهيئة الصفحة عند تحميل DOM
    document.addEventListener('DOMContentLoaded', initializePage);

    // جعل الدوال متاحة عالمياً للاستدعاء من HTML
    window.logout = logout;
    window.addToCart = addToCart;
    window.goToCart = goToCart;
    window.toggleSettings = toggleSettings;
    window.toggleLanguage = toggleLanguage;
    window.toggleDisplayMode = toggleDisplayMode;
    window.updateTextSize = updateTextSize;
    window.scrollManga = scrollManga;
    window.prevNovelPage = prevNovelPage;
    window.nextNovelPage = nextNovelPage;
    window.switchNovelTab = switchNovelTab;
    window.prevVideoPage = prevVideoPage;
    window.nextVideoPage = nextVideoPage;
    window.switchVideoTab = switchVideoTab;
    window.openProductDetail = openProductDetail;
    window.closeProductDetail = closeProductDetail;
    window.watchChapter = watchChapter;
    window.addProductComment = addProductComment;
    window.purchaseProduct = purchaseProduct;
    window.openSearch = openSearch;
    window.closeSearch = closeSearch;
    window.searchProducts = searchProducts;
    window.scrollToTop = scrollToTop;
    window.openPrivacy = openPrivacy;
    window.openOrderHistory = openOrderHistory;
    window.openAccount = openAccount;
    window.openFeedback = openFeedback;
    window.openTerms = openTerms;
    window.openFAQ = openFAQ;
    window.openContact = openContact;
    window.openReport = openReport;
    window.openSuggestions = openSuggestions;
    window.displayAllStories = displayAllStories;
    window.closeAllStories = closeAllStories;
</script>
</body>
</html>