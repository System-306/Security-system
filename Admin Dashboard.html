<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة التحكم - إدارة الطلبات</title>
<link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
<style>
:root {
  --admin-primary: #2c3e50;
  --admin-secondary: #34495e;
  --admin-accent: #3498db;
  --admin-success: #27ae60;
  --admin-warning: #f39c12;
  --admin-danger: #e74c3c;
  --admin-light: #ecf0f1;
  --admin-dark: #2c3e50;
  --admin-gray: #95a5a6;
  --shadow-heavy: 0 8px 25px rgba(0,0,0,0.15);
  --shadow-light: 0 4px 12px rgba(0,0,0,0.1);
  --transition-speed: 0.3s;
  --header-height: 70px;
  --sidebar-width: 250px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Almarai', sans-serif;
  background-color: #f5f7fa;
  color: #333;
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== تصميم المصادقة ===== */
.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
}

.auth-box {
  background: white;
  border-radius: 15px;
  box-shadow: var(--shadow-heavy);
  width: 100%;
  max-width: 400px;
  padding: 40px;
  text-align: center;
}

.auth-box h1 {
  color: var(--admin-primary);
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 1.8em;
}

.auth-box .input-group {
  margin-bottom: 20px;
  text-align: right;
}

.auth-box input {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 16px;
  transition: all var(--transition-speed);
  font-family: 'Almarai', sans-serif;
}

.auth-box input:focus {
  outline: none;
  border-color: var(--admin-accent);
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.auth-box button {
  width: 100%;
  padding: 14px;
  background: var(--admin-accent);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--transition-speed);
  font-family: 'Almarai', sans-serif;
}

.auth-box button:hover {
  background: #2980b9;
  transform: translateY(-2px);
}

.error-message {
  color: var(--admin-danger);
  margin-top: 10px;
  font-size: 14px;
  display: none;
}

/* ===== الهيكل الرئيسي بعد المصادقة ===== */
.dashboard-container {
  display: none;
  min-height: 100vh;
}

/* ===== الشريط العلوي ===== */
.admin-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--header-height);
  background: white;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 30px;
  z-index: 1000;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1.4em;
  font-weight: 700;
  color: var(--admin-primary);
}

.user-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

.user-info span {
  font-weight: 600;
  color: var(--admin-primary);
}

.logout-btn {
  padding: 8px 20px;
  background: var(--admin-danger);
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
  transition: all var(--transition-speed);
}

.logout-btn:hover {
  background: #c0392b;
  transform: translateY(-2px);
}

/* ===== الشريط الجانبي ===== */
.admin-sidebar {
  position: fixed;
  top: var(--header-height);
  left: 0;
  width: var(--sidebar-width);
  height: calc(100vh - var(--header-height));
  background: var(--admin-primary);
  color: white;
  padding: 20px 0;
  overflow-y: auto;
  transition: transform 0.3s ease;
}

.sidebar-menu {
  list-style: none;
}

.menu-item {
  margin: 5px 0;
}

.menu-item a {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px 25px;
  color: rgba(255,255,255,0.8);
  text-decoration: none;
  transition: all var(--transition-speed);
  font-size: 15px;
}

.menu-item a:hover {
  background: rgba(255,255,255,0.1);
  color: white;
  padding-right: 30px;
}

.menu-item a.active {
  background: var(--admin-accent);
  color: white;
  border-right: 4px solid white;
}

/* ===== المحتوى الرئيسي ===== */
.admin-content {
  margin-top: var(--header-height);
  margin-right: var(--sidebar-width);
  padding: 30px;
  min-height: calc(100vh - var(--header-height));
}

/* ===== بطاقات الإحصائيات ===== */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  border-radius: 10px;
  padding: 25px;
  box-shadow: var(--shadow-light);
  transition: all var(--transition-speed);
  border-top: 4px solid var(--admin-accent);
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-heavy);
}

.stat-card.processing { border-color: var(--admin-warning); }
.stat-card.shipped { border-color: var(--admin-accent); }
.stat-card.delivered { border-color: var(--admin-success); }
.stat-card.total { border-color: var(--admin-primary); }

.stat-card .stat-value {
  font-size: 2.2em;
  font-weight: 700;
  color: var(--admin-primary);
  margin-bottom: 10px;
}

.stat-card .stat-label {
  font-size: 14px;
  color: var(--admin-gray);
  margin-bottom: 15px;
}

.stat-card .stat-change {
  font-size: 13px;
  padding: 3px 10px;
  border-radius: 15px;
  background: rgba(52, 152, 219, 0.1);
  color: var(--admin-accent);
  display: inline-block;
}

/* ===== قسم الفلاتر ===== */
.filters-section {
  background: white;
  border-radius: 10px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: var(--shadow-light);
}

.filters-section h3 {
  margin-bottom: 20px;
  color: var(--admin-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.filter-group {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 10px 25px;
  background: white;
  color: var(--admin-primary);
  border: 2px solid #e0e0e0;
  border-radius: 25px;
  cursor: pointer;
  font-weight: 600;
  transition: all var(--transition-speed);
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-btn:hover {
  border-color: var(--admin-accent);
  color: var(--admin-accent);
}

.filter-btn.active {
  background: var(--admin-accent);
  color: white;
  border-color: var(--admin-accent);
}

.search-box {
  position: relative;
  flex: 1;
  min-width: 250px;
}

.search-box input {
  width: 100%;
  padding: 12px 45px 12px 15px;
  border: 2px solid #e0e0e0;
  border-radius: 25px;
  font-size: 15px;
  transition: all var(--transition-speed);
}

.search-box input:focus {
  outline: none;
  border-color: var(--admin-accent);
}

.search-box i {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--admin-gray);
}

/* ===== جدول الطلبات ===== */
.orders-table-section {
  background: white;
  border-radius: 10px;
  padding: 25px;
  box-shadow: var(--shadow-light);
}

.orders-table-section h3 {
  margin-bottom: 20px;
  color: var(--admin-primary);
  display: flex;
  align-items: center;
  gap: 10px;
}

.table-container {
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.orders-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 1000px;
}

.orders-table thead {
  background: var(--admin-primary);
  color: white;
}

.orders-table th {
  padding: 15px;
  text-align: right;
  font-weight: 600;
  font-size: 14px;
}

.orders-table tbody tr {
  border-bottom: 1px solid #e0e0e0;
  transition: all var(--transition-speed);
}

.orders-table tbody tr:hover {
  background: #f8f9fa;
}

.orders-table td {
  padding: 15px;
  text-align: right;
  font-size: 14px;
}

/* ===== حالات الطلب ===== */
.order-status-badge {
  padding: 6px 15px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.status-processing {
  background: rgba(243, 156, 18, 0.1);
  color: var(--admin-warning);
  border: 1px solid rgba(243, 156, 18, 0.3);
}

.status-shipped {
  background: rgba(52, 152, 219, 0.1);
  color: var(--admin-accent);
  border: 1px solid rgba(52, 152, 219, 0.3);
}

.status-delivered {
  background: rgba(39, 174, 96, 0.1);
  color: var(--admin-success);
  border: 1px solid rgba(39, 174, 96, 0.3);
}

/* ===== أزرار الإجراءات ===== */
.action-buttons {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
  transition: all var(--transition-speed);
  display: flex;
  align-items: center;
  gap: 5px;
}

.view-btn {
  background: rgba(52, 152, 219, 0.1);
  color: var(--admin-accent);
}

.view-btn:hover {
  background: var(--admin-accent);
  color: white;
}

.edit-btn {
  background: rgba(243, 156, 18, 0.1);
  color: var(--admin-warning);
}

.edit-btn:hover {
  background: var(--admin-warning);
  color: white;
}

.delete-btn {
  background: rgba(231, 76, 60, 0.1);
  color: var(--admin-danger);
}

.delete-btn:hover {
  background: var(--admin-danger);
  color: white;
}

/* ===== نافذة تعديل الحالة ===== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 20px;
}

.modal-content {
  background: white;
  border-radius: 15px;
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  padding: 25px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  color: var(--admin-primary);
  margin: 0;
}

.close-modal {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--admin-gray);
  transition: color var(--transition-speed);
}

.close-modal:hover {
  color: var(--admin-danger);
}

.modal-body {
  padding: 25px;
}

.status-options {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin: 20px 0;
}

.status-option {
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  cursor: pointer;
  transition: all var(--transition-speed);
  display: flex;
  align-items: center;
  gap: 10px;
}

.status-option:hover {
  border-color: var(--admin-accent);
  background: rgba(52, 152, 219, 0.05);
}

.status-option.selected {
  border-color: var(--admin-accent);
  background: rgba(52, 152, 219, 0.1);
}

.modal-footer {
  padding: 25px;
  border-top: 1px solid #e0e0e0;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.save-btn {
  padding: 12px 30px;
  background: var(--admin-success);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all var(--transition-speed);
}

.save-btn:hover {
  background: #219653;
  transform: translateY(-2px);
}

.cancel-btn {
  padding: 12px 30px;
  background: var(--admin-gray);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all var(--transition-speed);
}

.cancel-btn:hover {
  background: #7f8c8d;
}

/* ===== رسائل التنبيه ===== */
.notification {
  position: fixed;
  top: 90px;
  right: 30px;
  padding: 15px 25px;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  display: none;
  align-items: center;
  gap: 10px;
  z-index: 3000;
  animation: slideInRight 0.3s ease;
  max-width: 400px;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.notification.success {
  background: var(--admin-success);
  border-left: 4px solid #219653;
}

.notification.error {
  background: var(--admin-danger);
  border-left: 4px solid #c0392b;
}

.notification.warning {
  background: var(--admin-warning);
  border-left: 4px solid #d68910;
}

/* ===== التصميم المتجاوب ===== */
@media (max-width: 992px) {
  .admin-sidebar {
    transform: translateX(-100%);
  }
  
  .admin-content {
    margin-right: 0;
  }
  
  .admin-header .menu-toggle {
    display: block;
    background: none;
    border: none;
    font-size: 20px;
    color: var(--admin-primary);
    cursor: pointer;
  }
  
  .admin-sidebar.active {
    transform: translateX(0);
  }
}

@media (max-width: 768px) {
  .admin-header {
    padding: 0 15px;
  }
  
  .admin-content {
    padding: 15px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .filter-group {
    flex-direction: column;
  }
  
  .search-box {
    min-width: 100%;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .auth-box {
    padding: 30px 20px;
  }
}
</style>
<style>
:root {
  --admin-primary: #2c3e50;
  --admin-secondary: #34495e;
  --admin-accent: #3498db;
  --admin-success: #27ae60;
  --admin-warning: #f39c12;
  --admin-danger: #e74c3c;
  --admin-light: #ecf0f1;
  --admin-dark: #2c3e50;
  --admin-gray: #95a5a6;
  --shadow-heavy: 0 8px 25px rgba(0,0,0,0.15);
  --shadow-light: 0 4px 12px rgba(0,0,0,0.1);
  --transition-speed: 0.3s;
  --header-height: 70px;
  --sidebar-width: 250px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Almarai', sans-serif;
  background-color: #f5f7fa;
  color: #333;
  min-height: 100vh;
  overflow-x: hidden;
  font-size: 14px;
}

/* ===== تصميم المصادقة ===== */
.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
}

.auth-box {
  background: white;
  border-radius: 15px;
  box-shadow: var(--shadow-heavy);
  width: 100%;
  max-width: 400px;
  padding: 30px;
  text-align: center;
}

.auth-box h1 {
  color: var(--admin-primary);
  margin-bottom: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 1.6em;
}

.auth-box .input-group {
  margin-bottom: 15px;
  text-align: right;
}

.auth-box input {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 15px;
  transition: all var(--transition-speed);
  font-family: 'Almarai', sans-serif;
}

.auth-box button {
  width: 100%;
  padding: 14px;
  background: var(--admin-accent);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--transition-speed);
  font-family: 'Almarai', sans-serif;
}

/* ===== الهيكل الرئيسي ===== */
.dashboard-container {
  display: none;
  min-height: 100vh;
}

/* ===== الشريط العلوي ===== */
.admin-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--header-height);
  background: white;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  z-index: 1000;
  gap: 15px;
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 1.2em;
  font-weight: 700;
  color: var(--admin-primary);
  white-space: nowrap;
}

.menu-toggle {
  display: none;
  background: none;
  border: none;
  font-size: 1.4em;
  color: var(--admin-primary);
  cursor: pointer;
  padding: 8px;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.user-info span {
  font-weight: 600;
  color: var(--admin-primary);
  font-size: 0.95em;
}

.logout-btn {
  padding: 8px 15px;
  background: var(--admin-danger);
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.9em;
  white-space: nowrap;
}

/* ===== الشريط الجانبي ===== */
.admin-sidebar {
  position: fixed;
  top: var(--header-height);
  right: 0;
  width: var(--sidebar-width);
  height: calc(100vh - var(--header-height));
  background: var(--admin-primary);
  color: white;
  padding: 15px 0;
  overflow-y: auto;
  transform: translateX(0);
  transition: transform 0.3s ease;
  z-index: 999;
}

.sidebar-menu {
  list-style: none;
}

.menu-item a {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 20px;
  color: rgba(255,255,255,0.8);
  text-decoration: none;
  transition: all var(--transition-speed);
  font-size: 0.95em;
}

/* ===== المحتوى الرئيسي ===== */
.admin-content {
  margin-top: var(--header-height);
  margin-right: var(--sidebar-width);
  padding: 20px;
  min-height: calc(100vh - var(--header-height));
}

/* ===== بطاقات الإحصائيات ===== */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 15px;
  margin-bottom: 25px;
}

.stat-card {
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: var(--shadow-light);
  transition: all var(--transition-speed);
  border-top: 4px solid var(--admin-accent);
}

.stat-card .stat-value {
  font-size: 1.8em;
  font-weight: 700;
  color: var(--admin-primary);
  margin-bottom: 8px;
}

.stat-card .stat-label {
  font-size: 0.9em;
  color: var(--admin-gray);
  margin-bottom: 10px;
}

/* ===== قسم الفلاتر ===== */
.filters-section {
  background: white;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: var(--shadow-light);
}

.filter-group {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
}

.filter-btn {
  padding: 8px 20px;
  background: white;
  color: var(--admin-primary);
  border: 2px solid #e0e0e0;
  border-radius: 25px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.9em;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.search-box {
  position: relative;
  flex: 1;
  min-width: 200px;
}

.search-box input {
  width: 100%;
  padding: 10px 40px 10px 15px;
  border: 2px solid #e0e0e0;
  border-radius: 25px;
  font-size: 0.95em;
}

/* ===== جدول الطلبات ===== */
.orders-table-section {
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: var(--shadow-light);
  overflow: hidden;
}

.table-container {
  overflow-x: auto;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
  -webkit-overflow-scrolling: touch;
}

.orders-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 800px;
}

.orders-table th,
.orders-table td {
  padding: 12px 10px;
  text-align: right;
  font-size: 0.9em;
  white-space: nowrap;
}

.orders-table th {
  background: var(--admin-primary);
  color: white;
  font-weight: 600;
}

/* ===== حالات الطلب ===== */
.order-status-badge {
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.85em;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
}

/* ===== أزرار الإجراءات ===== */
.action-buttons {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.action-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.85em;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
}

/* ===== النوافذ المنبثقة ===== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 15px;
}

.modal-content {
  background: white;
  border-radius: 12px;
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  animation: modalSlideIn 0.3s ease;
}

.modal-header {
  padding: 20px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-body {
  padding: 20px;
  max-height: 60vh;
  overflow-y: auto;
}

.modal-footer {
  padding: 20px;
  border-top: 1px solid #e0e0e0;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

/* ===== إشعارات ===== */
.notification {
  position: fixed;
  top: 80px;
  right: 15px;
  left: 15px;
  padding: 15px 20px;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  display: none;
  align-items: center;
  gap: 10px;
  z-index: 3000;
  animation: slideInTop 0.3s ease;
  max-width: 500px;
  margin: 0 auto;
}

/* ===== الأنيميشن ===== */
@keyframes modalSlideIn {
  from { opacity: 0; transform: translateY(-30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInTop {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ============================================= */
/* ============ التصميم المتجاوب ============ */
/* ============================================= */

/* الأجهزة اللوحية الكبيرة (992px وما فوق) */
@media (min-width: 992px) {
  .stats-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .orders-table {
    min-width: 1000px;
  }
}

/* الأجهزة اللوحية المتوسطة (768px - 991px) */
@media (max-width: 991px) {
  .admin-sidebar {
    transform: translateX(100%);
  }
  
  .admin-sidebar.active {
    transform: translateX(0);
  }
  
  .admin-content {
    margin-right: 0;
  }
  
  .menu-toggle {
    display: block;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .orders-table th,
  .orders-table td {
    padding: 10px 8px;
    font-size: 0.85em;
  }
}

/* الأجهزة اللوحية الصغيرة والهواتف الكبيرة (576px - 767px) */
@media (max-width: 767px) {
  :root {
    --header-height: 60px;
    --sidebar-width: 280px;
  }
  
  .admin-header {
    padding: 0 15px;
  }
  
  .logo {
    font-size: 1.1em;
  }
  
  .user-info {
    flex-direction: column;
    align-items: flex-end;
    gap: 5px;
  }
  
  .user-info span {
    font-size: 0.9em;
  }
  
  .logout-btn {
    padding: 6px 12px;
    font-size: 0.85em;
  }
  
  .admin-content {
    padding: 15px;
  }
  
  .stats-grid {
    gap: 12px;
  }
  
  .stat-card {
    padding: 15px;
  }
  
  .stat-card .stat-value {
    font-size: 1.6em;
  }
  
  .filters-section {
    padding: 15px;
  }
  
  .filter-group {
    gap: 8px;
  }
  
  .filter-btn {
    padding: 7px 15px;
    font-size: 0.85em;
  }
  
  .search-box {
    min-width: 100%;
  }
  
  .orders-table-section {
    padding: 15px;
  }
  
  .orders-table {
    min-width: 700px;
  }
  
  .action-buttons {
    flex-direction: column;
    min-width: 120px;
  }
  
  .action-btn {
    width: 100%;
    justify-content: center;
  }
  
  .modal-content {
    max-width: 95%;
  }
  
  .modal-header,
  .modal-body,
  .modal-footer {
    padding: 15px;
  }
  
  .notification {
    right: 10px;
    left: 10px;
    padding: 12px 15px;
    font-size: 0.9em;
  }
}

/* الهواتف الصغيرة (480px - 575px) */
@media (max-width: 575px) {
  :root {
    --header-height: 55px;
  }
  
  .auth-box {
    padding: 25px 20px;
  }
  
  .auth-box h1 {
    font-size: 1.4em;
    flex-direction: column;
    gap: 8px;
  }
  
  .admin-header {
    padding: 0 10px;
  }
  
  .logo {
    font-size: 1em;
  }
  
  .menu-toggle {
    font-size: 1.2em;
    padding: 5px;
  }
  
  .admin-content {
    padding: 12px;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  
  .stat-card .stat-value {
    font-size: 1.8em;
  }
  
  .filter-btn {
    flex: 1;
    min-width: calc(50% - 8px);
    justify-content: center;
  }
  
  .orders-table {
    min-width: 600px;
  }
  
  .orders-table th,
  .orders-table td {
    padding: 8px 6px;
    font-size: 0.8em;
  }
  
  .order-status-badge {
    padding: 4px 8px;
    font-size: 0.8em;
  }
  
  .modal-header h3 {
    font-size: 1.1em;
  }
}

/* الهواتف الصغيرة جداً (أقل من 480px) */
@media (max-width: 479px) {
  :root {
    --sidebar-width: 100%;
  }
  
  .auth-box {
    padding: 20px 15px;
  }
  
  .auth-box h1 {
    font-size: 1.3em;
  }
  
  .auth-box input,
  .auth-box button {
    padding: 10px 12px;
    font-size: 14px;
  }
  
  .admin-header {
    flex-wrap: wrap;
    height: auto;
    padding: 10px;
  }
  
  .logo {
    order: 1;
  }
  
  .menu-toggle {
    order: 2;
  }
  
  .user-info {
    order: 3;
    width: 100%;
    margin-top: 10px;
    flex-direction: row;
    justify-content: space-between;
  }
  
  .admin-content {
    margin-top: 90px;
  }
  
  .filter-group {
    flex-direction: column;
  }
  
  .filter-btn {
    width: 100%;
  }
  
  .orders-table {
    min-width: 500px;
  }
  
  .action-buttons {
    min-width: 100px;
  }
  
  .action-btn {
    padding: 5px 8px;
    font-size: 0.8em;
  }
  
  .status-option {
    padding: 12px;
    font-size: 0.9em;
  }
  
  .modal-content {
    max-width: 98%;
    max-height: 95vh;
  }
  
  .modal-header {
    flex-direction: column;
    gap: 10px;
    align-items: flex-start;
  }
  
  .modal-footer {
    flex-direction: column-reverse;
  }
  
  .modal-footer button {
    width: 100%;
  }
  
  .notification {
    font-size: 0.85em;
    padding: 10px 12px;
    top: 100px;
  }
}

/* ============================================= */
/* ============ تحسينات خاصة ============ */
/* ============================================= */

/* تحسين الأداء على الأجهزة القديمة */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* تحسين التباين للوصول الشامل */
@media (prefers-contrast: high) {
  :root {
    --admin-primary: #000000;
    --admin-accent: #0066cc;
    --admin-success: #006400;
    --admin-warning: #8b4513;
    --admin-danger: #8b0000;
  }
}

/* وضع التوفير في الطاقة */
@media (prefers-color-scheme: dark) {
  body {
    background-color: #1a1a1a;
    color: #ffffff;
  }
  
  .stat-card,
  .filters-section,
  .orders-table-section {
    background: #2d2d2d;
    color: #ffffff;
  }
  
  .filter-btn {
    background: #2d2d2d;
    color: #ffffff;
    border-color: #444;
  }
  
  .orders-table {
    color: #ffffff;
  }
  
  .orders-table th {
    background: #000000;
  }
  
  .orders-table tbody tr:hover {
    background: #3d3d3d;
  }
}

/* تحسين الخطوط للأجهزة المختلفة */
@media (max-width: 767px) {
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* تحسين اللمس على الأجهزة اللوحية */
@media (hover: none) and (pointer: coarse) {
  .filter-btn,
  .action-btn,
  .logout-btn {
    min-height: 44px;
    min-width: 44px;
  }
  
  .menu-item a {
    min-height: 44px;
  }
  
  .orders-table th,
  .orders-table td {
    padding: 15px 10px;
  }
}

/* دعم التوجه الأفقي على الأجهزة المحمولة */
@media (max-height: 500px) and (orientation: landscape) {
  .auth-container {
    padding: 10px;
  }
  
  .auth-box {
    max-width: 90%;
    padding: 20px;
  }
  
  .admin-sidebar {
    width: 200px;
  }
  
  .admin-content {
    margin-right: 200px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* دعم الشاشات الكبيرة جداً */
@media (min-width: 1440px) {
  .admin-content {
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .stats-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* إصلاح مشاكل الزوم على iOS */
@media (max-width: 767px) {
  input,
  select,
  textarea {
    font-size: 16px !important;
  }
}

/* تحسين الأداء عند التمرير */
.admin-sidebar,
.modal-body,
.table-container {
  scrollbar-width: thin;
  scrollbar-color: var(--admin-accent) #f0f0f0;
}

.admin-sidebar::-webkit-scrollbar,
.modal-body::-webkit-scrollbar,
.table-container::-webkit-scrollbar {
  width: 6px;
}

.admin-sidebar::-webkit-scrollbar-track,
.modal-body::-webkit-scrollbar-track,
.table-container::-webkit-scrollbar-track {
  background: #f0f0f0;
}

.admin-sidebar::-webkit-scrollbar-thumb,
.modal-body::-webkit-scrollbar-thumb,
.table-container::-webkit-scrollbar-thumb {
  background: var(--admin-accent);
  border-radius: 3px;
}

/* تحسين عرض الجدول على الشاشات الصغيرة */
@media (max-width: 767px) {
  .orders-table {
    font-size: 0.85em;
  }
  
  .orders-table td:not(:first-child),
  .orders-table th:not(:first-child) {
    min-width: 100px;
  }
}
</style>
</head>
<body>

<!-- ===== شاشة المصادقة ===== -->
<div class="auth-container" id="authContainer">
  <div class="auth-box">
    <h1><i class="fas fa-lock"></i> دخول المشرف</h1>
    <div class="input-group">
      <input type="text" id="adminUsername" placeholder="اسم المستخدم">
    </div>
    <div class="input-group">
      <input type="password" id="adminPassword" placeholder="كلمة المرور">
    </div>
    <div class="error-message" id="loginError">اسم المستخدم أو كلمة المرور غير صحيحة</div>
    <button onclick="loginAdmin()">تسجيل الدخول</button>
  </div>
</div>

<!-- ===== لوحة التحكم بعد المصادقة ===== -->
<div class="dashboard-container" id="dashboardContainer">
  <!-- الشريط العلوي -->
  <header class="admin-header">
    <div class="logo">
      <i class="fas fa-crown"></i>
      <span>لوحة التحكم</span>
    </div>
    <button class="menu-toggle" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
    </button>
    <div class="user-info">
      <span>مرحباً، <span id="adminName">المشرف</span></span>
      <button class="logout-btn" onclick="logoutAdmin()">
        <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
      </button>
    </div>
  </header>

  <!-- الشريط الجانبي -->
  <nav class="admin-sidebar" id="sidebar">
    <ul class="sidebar-menu">
      <li class="menu-item">
        <a href="#" class="active" onclick="showSection('orders')">
          <i class="fas fa-boxes"></i>
          <span>إدارة الطلبات</span>
        </a>
      </li>
      <li class="menu-item">
        <a href="#" onclick="showSection('statistics')">
          <i class="fas fa-chart-bar"></i>
          <span>الإحصائيات</span>
        </a>
      </li>
      <li class="menu-item">
        <a href="#" onclick="showSection('users')">
          <i class="fas fa-users"></i>
          <span>المستخدمين</span>
        </a>
      </li>
      <li class="menu-item">
        <a href="#" onclick="showSection('reports')">
          <i class="fas fa-file-alt"></i>
          <span>التقارير</span>
        </a>
      </li>
      <li class="menu-item">
        <a href="#" onclick="showSection('settings')">
          <i class="fas fa-cog"></i>
          <span>الإعدادات</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- المحتوى الرئيسي -->
  <main class="admin-content">
    <!-- قسم إدارة الطلبات -->
    <div id="ordersSection">
      <!-- بطاقات الإحصائيات -->
      <div class="stats-grid">
        <div class="stat-card total">
          <div class="stat-value" id="totalOrdersCount">0</div>
          <div class="stat-label">إجمالي الطلبات</div>
          <span class="stat-change"><i class="fas fa-arrow-up"></i> 12% من الشهر الماضي</span>
        </div>
        <div class="stat-card processing">
          <div class="stat-value" id="processingOrdersCount">0</div>
          <div class="stat-label">قيد التجهيز</div>
          <span class="stat-change"><i class="fas fa-clock"></i> تحتاج إلى متابعة</span>
        </div>
        <div class="stat-card shipped">
          <div class="stat-value" id="shippedOrdersCount">0</div>
          <div class="stat-label">قيد الشحن</div>
          <span class="stat-change"><i class="fas fa-shipping-fast"></i> في الطريق</span>
        </div>
        <div class="stat-card delivered">
          <div class="stat-value" id="deliveredOrdersCount">0</div>
          <div class="stat-label">تم التوصيل</div>
          <span class="stat-change"><i class="fas fa-check-circle"></i> 98% رضا العملاء</span>
        </div>
      </div>

      <!-- فلاتر البحث -->
      <div class="filters-section">
        <h3><i class="fas fa-filter"></i> فلترة الطلبات</h3>
        <div class="filter-group">
          <button class="filter-btn active" onclick="filterOrders('all')">
            <i class="fas fa-th-large"></i> الكل
          </button>
          <button class="filter-btn" onclick="filterOrders('processing')">
            <i class="fas fa-cog"></i> قيد التجهيز
          </button>
          <button class="filter-btn" onclick="filterOrders('shipped')">
            <i class="fas fa-shipping-fast"></i> قيد الشحن
          </button>
          <button class="filter-btn" onclick="filterOrders('delivered')">
            <i class="fas fa-check-circle"></i> تم التوصيل
          </button>
          <div class="search-box">
            <input type="text" id="searchOrders" placeholder="ابحث برقم الطلب أو اسم العميل..." 
                   onkeyup="searchOrders()">
            <i class="fas fa-search"></i>
          </div>
        </div>
      </div>

      <!-- جدول الطلبات -->
      <div class="orders-table-section">
        <h3><i class="fas fa-list"></i> قائمة الطلبات</h3>
        <div class="table-container">
          <table class="orders-table" id="ordersTable">
            <thead>
              <tr>
                <th>رقم الطلب</th>
                <th>العميل</th>
                <th>التاريخ</th>
                <th>المبلغ</th>
                <th>حالة الطلب</th>
                <th>المنتجات</th>
                <th>الإجراءات</th>
              </tr>
            </thead>
            <tbody id="ordersTableBody">
              <!-- سيتم ملؤها ديناميكياً -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- أقسام أخرى (ستكون مخفية) -->
    <div id="statisticsSection" style="display: none;">
      <h2>الإحصائيات</h2>
      <p>هذا القسم قيد التطوير...</p>
    </div>
    
    <div id="usersSection" style="display: none;">
      <h2>المستخدمين</h2>
      <p>هذا القسم قيد التطوير...</p>
    </div>
    
    <div id="reportsSection" style="display: none;">
      <h2>التقارير</h2>
      <p>هذا القسم قيد التطوير...</p>
    </div>
    
    <div id="settingsSection" style="display: none;">
      <h2>الإعدادات</h2>
      <p>هذا القسم قيد التطوير...</p>
    </div>
  </main>
</div>

<!-- ===== نافذة تعديل الحالة ===== -->
<div class="modal-overlay" id="statusModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> تغيير حالة الطلب</h3>
      <button class="close-modal" onclick="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>الطلب: <strong id="modalOrderId">#12345</strong></p>
      <p>العميل: <span id="modalCustomer">غير معروف</span></p>
      
      <div class="status-options" id="statusOptions">
        <div class="status-option" onclick="selectStatus('processing')">
          <i class="fas fa-cog"></i>
          <div>
            <strong>قيد التجهيز</strong>
            <small>الطلب قيد التحضير والتعبئة</small>
          </div>
        </div>
        <div class="status-option" onclick="selectStatus('shipped')">
          <i class="fas fa-shipping-fast"></i>
          <div>
            <strong>قيد الشحن</strong>
            <small>تم شحن الطلب وهو في الطريق</small>
          </div>
        </div>
        <div class="status-option" onclick="selectStatus('delivered')">
          <i class="fas fa-check-circle"></i>
          <div>
            <strong>تم التوصيل</strong>
            <small>تم تسليم الطلب للعميل</small>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" onclick="closeModal()">إلغاء</button>
      <button class="save-btn" onclick="saveOrderStatus()">
        <i class="fas fa-save"></i> حفظ التغييرات
      </button>
    </div>
  </div>
</div>

<!-- ===== نافذة عرض التفاصيل ===== -->
<div class="modal-overlay" id="detailsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-info-circle"></i> تفاصيل الطلب</h3>
      <button class="close-modal" onclick="closeDetailsModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" id="orderDetailsContent">
      <!-- سيتم ملؤها ديناميكياً -->
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" onclick="closeDetailsModal()">إغلاق</button>
    </div>
  </div>
</div>

<!-- ===== إشعارات ===== -->
<div class="notification" id="notification"></div>

<script>
// ====== بيانات المشرف ======
const ADMIN_CREDENTIALS = {
  username: "admin",
  password: "admin123"
};

const ADMIN_KEY = "admin_orders";
let allOrders = [];
let currentFilter = 'all';
let selectedOrderId = null;
let selectedStatus = null;

// ====== عناصر DOM ======
const authContainer = document.getElementById('authContainer');
const dashboardContainer = document.getElementById('dashboardContainer');
const loginError = document.getElementById('loginError');
const ordersTableBody = document.getElementById('ordersTableBody');
const totalOrdersCount = document.getElementById('totalOrdersCount');
const processingOrdersCount = document.getElementById('processingOrdersCount');
const shippedOrdersCount = document.getElementById('shippedOrdersCount');
const deliveredOrdersCount = document.getElementById('deliveredOrdersCount');
const statusModal = document.getElementById('statusModal');
const detailsModal = document.getElementById('detailsModal');
const notification = document.getElementById('notification');

// ====== دالة تسجيل دخول المشرف ======
function loginAdmin() {
  const username = document.getElementById('adminUsername').value;
  const password = document.getElementById('adminPassword').value;
  
  if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
    // تسجيل الدخول الناجح
    authContainer.style.display = 'none';
    dashboardContainer.style.display = 'block';
    
    // تحديث اسم المشرف
    document.getElementById('adminName').textContent = username;
    
    // جلب بيانات الطلبات
    loadAllOrders();
    
    // إظهار الإشعار
    showNotification('تم تسجيل الدخول بنجاح!', 'success');
  } else {
    // خطأ في تسجيل الدخول
    loginError.style.display = 'block';
    showNotification('اسم المستخدم أو كلمة المرور غير صحيحة', 'error');
  }
}

// ====== دالة تسجيل الخروج ======
function logoutAdmin() {
  if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
    authContainer.style.display = 'flex';
    dashboardContainer.style.display = 'none';
    
    // مسح حقول الدخول
    document.getElementById('adminUsername').value = '';
    document.getElementById('adminPassword').value = '';
    loginError.style.display = 'none';
    
    showNotification('تم تسجيل الخروج بنجاح', 'success');
  }
}

// ====== دالة تحميل جميع الطلبات من جميع المستخدمين ======
function loadAllOrders() {
  // في الواقع، هذه البيانات ستأتي من قاعدة بيانات مركزية
  // لكن هنا سنحاكي البيانات من التخزين المحلي لجميع المستخدمين
  
  allOrders = [];
  
  // جمع جميع الطلبات من التخزين المحلي (لجميع المستخدمين)
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    
    // البحث عن مفاتيح الطلبات (تبدأ بـ "orders_")
    if (key.startsWith('orders_')) {
      try {
        const userOrders = JSON.parse(localStorage.getItem(key));
        if (Array.isArray(userOrders)) {
          // استخراج البريد الإلكتروني من المفتاح
          const userEmail = key.replace('orders_', '');
          
          // إضافة الطلبات مع معلومات المستخدم
          userOrders.forEach(order => {
            order.userEmail = userEmail;
            allOrders.push(order);
          });
        }
      } catch (error) {
        console.error('Error loading orders for user:', key, error);
      }
    }
  }
  
  // إذا لم توجد بيانات، إنشاء بيانات تجريبية
  if (allOrders.length === 0) {
    createSampleOrders();
  }
  
  updateStatistics();
  renderOrdersTable();
}

// ====== إنشاء بيانات تجريبية ======
function createSampleOrders() {
  const sampleUsers = [
    { email: 'user1@example.com', name: 'أحمد محمد' },
    { email: 'user2@example.com', name: 'سارة علي' },
    { email: 'user3@example.com', name: 'خالد حسن' },
    { email: 'user4@example.com', name: 'فاطمة إبراهيم' },
    { email: 'user5@example.com', name: 'محمد عبدالله' }
  ];
  
  const statuses = ['processing', 'shipped', 'delivered'];
  const statusNames = {
    processing: 'قيد التجهيز',
    shipped: 'قيد الشحن', 
    delivered: 'تم التوصيل'
  };
  
  const products = [
    { title: 'رواية الظلام القاتم', price: 24.99 },
    { title: 'كتاب أسرار النجاح', price: 19.99 },
    { title: 'مجموعة قصص الأطفال', price: 29.99 },
    { title: 'كتاب الطبخ العربي', price: 34.99 },
    { title: 'رواية الحب المستحيل', price: 22.99 }
  ];
  
  const today = new Date();
  
  for (let i = 1; i <= 15; i++) {
    const user = sampleUsers[Math.floor(Math.random() * sampleUsers.length)];
    const status = statuses[Math.floor(Math.random() * statuses.length)];
    const numProducts = Math.floor(Math.random() * 3) + 1;
    const orderProducts = [];
    
    for (let j = 0; j < numProducts; j++) {
      const product = products[Math.floor(Math.random() * products.length)];
      orderProducts.push({
        ...product,
        quantity: Math.floor(Math.random() * 2) + 1
      });
    }
    
    const totalAmount = orderProducts.reduce((sum, p) => sum + (p.price * p.quantity), 0);
    
    const orderDate = new Date(today);
    orderDate.setDate(orderDate.getDate() - Math.floor(Math.random() * 30));
    
    const order = {
      orderId: `ORD${String(i).padStart(5, '0')}`,
      orderDate: orderDate.toLocaleDateString('ar-SA'),
      status: statusNames[status],
      totalAmount: totalAmount.toFixed(2),
      userEmail: user.email,
      userName: user.name,
      shippingAddress: 'عنوان التوصيل ' + Math.floor(Math.random() * 100),
      paymentMethod: 'بطاقة ائتمان',
      trackingNumber: 'TRK' + String(Math.floor(Math.random() * 1000000)).padStart(6, '0'),
      products: orderProducts
    };
    
    allOrders.push(order);
  }
}

// ====== تحديث الإحصائيات ======
function updateStatistics() {
  const total = allOrders.length;
  const processing = allOrders.filter(order => order.status === 'قيد التجهيز').length;
  const shipped = allOrders.filter(order => order.status === 'قيد الشحن').length;
  const delivered = allOrders.filter(order => order.status === 'تم التوصيل').length;
  
  totalOrdersCount.textContent = total;
  processingOrdersCount.textContent = processing;
  shippedOrdersCount.textContent = shipped;
  deliveredOrdersCount.textContent = delivered;
}

// ====== عرض جدول الطلبات ======
function renderOrdersTable(filteredOrders = allOrders) {
  ordersTableBody.innerHTML = '';
  
  if (filteredOrders.length === 0) {
    ordersTableBody.innerHTML = `
      <tr>
        <td colspan="7" style="text-align: center; padding: 40px;">
          <i class="fas fa-inbox" style="font-size: 48px; color: #ddd; margin-bottom: 15px;"></i>
          <p style="color: #95a5a6;">لا توجد طلبات متاحة</p>
        </td>
      </tr>
    `;
    return;
  }
  
  filteredOrders.forEach(order => {
    const row = document.createElement('tr');
    
    // تحديد لون حالة الطلب
    let statusClass = '';
    if (order.status === 'قيد التجهيز') {
      statusClass = 'status-processing';
    } else if (order.status === 'قيد الشحن') {
      statusClass = 'status-shipped';
    } else {
      statusClass = 'status-delivered';
    }
    
    // حساب عدد المنتجات
    const productsCount = order.products ? order.products.length : 0;
    
    row.innerHTML = `
      <td><strong>${order.orderId}</strong></td>
      <td>
        <div>${order.userName || order.userEmail}</div>
        <small style="color: #95a5a6;">${order.userEmail}</small>
      </td>
      <td>${order.orderDate}</td>
      <td><strong>${order.totalAmount} ر.س</strong></td>
      <td>
        <span class="order-status-badge ${statusClass}">
          <i class="fas fa-circle" style="font-size: 8px;"></i>
          ${order.status}
        </span>
      </td>
      <td>${productsCount} منتج</td>
      <td>
        <div class="action-buttons">
          <button class="action-btn view-btn" onclick="viewOrderDetails('${order.orderId}')">
            <i class="fas fa-eye"></i> عرض
          </button>
          <button class="action-btn edit-btn" onclick="openStatusModal('${order.orderId}')">
            <i class="fas fa-edit"></i> تعديل
          </button>
          <button class="action-btn delete-btn" onclick="deleteOrder('${order.orderId}')">
            <i class="fas fa-trash"></i> حذف
          </button>
        </div>
      </td>
    `;
    
    ordersTableBody.appendChild(row);
  });
}

// ====== فلترة الطلبات ======
function filterOrders(status) {
  currentFilter = status;
  
  // تحديث أزرار الفلترة
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  let filteredOrders = allOrders;
  
  if (status === 'processing') {
    filteredOrders = allOrders.filter(order => order.status === 'قيد التجهيز');
  } else if (status === 'shipped') {
    filteredOrders = allOrders.filter(order => order.status === 'قيد الشحن');
  } else if (status === 'delivered') {
    filteredOrders = allOrders.filter(order => order.status === 'تم التوصيل');
  }
  
  renderOrdersTable(filteredOrders);
}

// ====== بحث الطلبات ======
function searchOrders() {
  const searchTerm = document.getElementById('searchOrders').value.toLowerCase();
  
  const filteredOrders = allOrders.filter(order => {
    return order.orderId.toLowerCase().includes(searchTerm) ||
           order.userName.toLowerCase().includes(searchTerm) ||
           order.userEmail.toLowerCase().includes(searchTerm) ||
           order.trackingNumber.toLowerCase().includes(searchTerm);
  });
  
  renderOrdersTable(filteredOrders);
}

// ====== فتح نافذة تعديل الحالة ======
function openStatusModal(orderId) {
  selectedOrderId = orderId;
  selectedStatus = null;
  
  const order = allOrders.find(o => o.orderId === orderId);
  if (!order) return;
  
  // تحديث معلومات النافذة
  document.getElementById('modalOrderId').textContent = order.orderId;
  document.getElementById('modalCustomer').textContent = order.userName || order.userEmail;
  
  // مسح التحديد السابق
  document.querySelectorAll('.status-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  // إظهار النافذة
  statusModal.style.display = 'flex';
}

// ====== اختيار الحالة ======
function selectStatus(status) {
  selectedStatus = status;
  
  // تحديث التحديد البصري
  document.querySelectorAll('.status-option').forEach(option => {
    option.classList.remove('selected');
  });
  
  event.target.closest('.status-option').classList.add('selected');
}

// ====== حفظ حالة الطلب ======
function saveOrderStatus() {
  if (!selectedStatus || !selectedOrderId) {
    showNotification('الرجاء اختيار حالة جديدة للطلب', 'warning');
    return;
  }
  
  const orderIndex = allOrders.findIndex(o => o.orderId === selectedOrderId);
  if (orderIndex === -1) return;
  
  // تحديث الحالة في المصفوفة المحلية
  const statusNames = {
    processing: 'قيد التجهيز',
    shipped: 'قيد الشحن',
    delivered: 'تم التوصيل'
  };
  
  allOrders[orderIndex].status = statusNames[selectedStatus];
  
  // في الواقع، هنا سيتم تحديث قاعدة البيانات المركزية
  // لكن للتجربة سنقوم بتحديث التخزين المحلي للمستخدم المناسب
  
  // البحث عن الطلب في تخزين المستخدم وتحديثه
  updateUserOrder(allOrders[orderIndex]);
  
  // تحديث الإحصائيات والجدول
  updateStatistics();
  renderOrdersTable();
  
  // إغلاق النافذة
  closeModal();
  
  // إظهار إشعار النجاح
  showNotification('تم تحديث حالة الطلب بنجاح!', 'success');
}

// ====== تحديث طلب المستخدم في التخزين المحلي ======
function updateUserOrder(updatedOrder) {
  const userEmail = updatedOrder.userEmail;
  const ORDERS_KEY = `orders_${userEmail}`;
  
  try {
    let userOrders = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
    
    // البحث عن الطلب وتحديثه
    const orderIndex = userOrders.findIndex(o => o.orderId === updatedOrder.orderId);
    if (orderIndex !== -1) {
      userOrders[orderIndex] = updatedOrder;
      localStorage.setItem(ORDERS_KEY, JSON.stringify(userOrders));
    }
  } catch (error) {
    console.error('Error updating user order:', error);
  }
}

// ====== عرض تفاصيل الطلب ======
function viewOrderDetails(orderId) {
  const order = allOrders.find(o => o.orderId === orderId);
  if (!order) return;
  
  // إنشاء محتوى التفاصيل
  let productsHtml = '';
  if (order.products && order.products.length > 0) {
    productsHtml = order.products.map(product => `
      <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
        <strong>${product.title}</strong>
        <div style="display: flex; justify-content: space-between; margin-top: 8px;">
          <span>الكمية: ${product.quantity || 1}</span>
          <span>${product.price} ر.س</span>
        </div>
      </div>
    `).join('');
  }
  
  document.getElementById('orderDetailsContent').innerHTML = `
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
      <div>
        <strong style="color: #95a5a6;">رقم الطلب</strong>
        <div style="font-size: 18px; font-weight: bold; margin-top: 5px;">${order.orderId}</div>
      </div>
      <div>
        <strong style="color: #95a5a6;">التاريخ</strong>
        <div style="font-size: 18px; font-weight: bold; margin-top: 5px;">${order.orderDate}</div>
      </div>
      <div>
        <strong style="color: #95a5a6;">المبلغ الإجمالي</strong>
        <div style="font-size: 18px; font-weight: bold; margin-top: 5px; color: #e74c3c;">${order.totalAmount} ر.س</div>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
      <h4 style="margin-bottom: 15px; color: #2c3e50;">معلومات العميل</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <div>
          <strong>الاسم:</strong> ${order.userName || 'غير معروف'}
        </div>
        <div>
          <strong>البريد الإلكتروني:</strong> ${order.userEmail}
        </div>
        <div>
          <strong>عنوان التوصيل:</strong> ${order.shippingAddress || 'غير محدد'}
        </div>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
      <h4 style="margin-bottom: 15px; color: #2c3e50;">معلومات الشحن</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        <div>
          <strong>حالة الطلب:</strong>
          <span class="order-status-badge ${order.status === 'قيد التجهيز' ? 'status-processing' : 
                                          order.status === 'قيد الشحن' ? 'status-shipped' : 'status-delivered'}">
            ${order.status}
          </span>
        </div>
        <div>
          <strong>رقم التتبع:</strong> ${order.trackingNumber || 'غير متوفر'}
        </div>
        <div>
          <strong>طريقة الدفع:</strong> ${order.paymentMethod || 'غير معروفة'}
        </div>
      </div>
    </div>
    
    <div>
      <h4 style="margin-bottom: 15px; color: #2c3e50;">المنتجات (${order.products ? order.products.length : 0})</h4>
      ${productsHtml || '<p>لا توجد منتجات</p>'}
    </div>
  `;
  
  detailsModal.style.display = 'flex';
}

// ====== حذف الطلب ======
function deleteOrder(orderId) {
  if (!confirm('هل أنت متأكد من حذف هذا الطلب؟ لا يمكن التراجع عن هذا الإجراء.')) {
    return;
  }
  
  const orderIndex = allOrders.findIndex(o => o.orderId === orderId);
  if (orderIndex === -1) return;
  
  // حذف الطلب من المصفوفة المحلية
  const deletedOrder = allOrders.splice(orderIndex, 1)[0];
  
  // حذف الطلب من تخزين المستخدم
  deleteUserOrder(deletedOrder);
  
  // تحديث الإحصائيات والجدول
  updateStatistics();
  renderOrdersTable();
  
  showNotification('تم حذف الطلب بنجاح', 'success');
}

// ====== حذف طلب المستخدم من التخزين المحلي ======
function deleteUserOrder(order) {
  const userEmail = order.userEmail;
  const ORDERS_KEY = `orders_${userEmail}`;
  
  try {
    let userOrders = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
    userOrders = userOrders.filter(o => o.orderId !== order.orderId);
    localStorage.setItem(ORDERS_KEY, JSON.stringify(userOrders));
  } catch (error) {
    console.error('Error deleting user order:', error);
  }
}

// ====== إغلاق النوافذ المنبثقة ======
function closeModal() {
  statusModal.style.display = 'none';
  selectedOrderId = null;
  selectedStatus = null;
}

function closeDetailsModal() {
  detailsModal.style.display = 'none';
}

// ====== إظهار الإشعارات ======
function showNotification(message, type = 'success') {
  notification.textContent = message;
  notification.className = `notification ${type}`;
  notification.style.display = 'flex';
  
  setTimeout(() => {
    notification.style.display = 'none';
  }, 4000);
}

// ====== تبديل الشريط الجانبي (للأجهزة الصغيرة) ======
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('active');
}

// ====== تبديل الأقسام ======
function showSection(sectionId) {
  // إخفاء جميع الأقسام
  document.getElementById('ordersSection').style.display = 'none';
  document.getElementById('statisticsSection').style.display = 'none';
  document.getElementById('usersSection').style.display = 'none';
  document.getElementById('reportsSection').style.display = 'none';
  document.getElementById('settingsSection').style.display = 'none';
  
  // إظهار القسم المطلوب
  document.getElementById(sectionId + 'Section').style.display = 'block';
  
  // تحديث القائمة الجانبية
  document.querySelectorAll('.menu-item a').forEach(link => {
    link.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // إغلاق الشريط الجانبي على الأجهزة الصغيرة
  if (window.innerWidth <= 992) {
    toggleSidebar();
  }
}

// ====== إضافة أنماط CSS للرسوم المتحركة ======
const style = document.createElement('style');
style.textContent = `
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .dashboard-container {
    animation: fadeIn 0.5s ease;
  }
`;
document.head.appendChild(style);

// ====== تهيئة الصفحة ======
document.addEventListener('DOMContentLoaded', function() {
  // التحقق إذا كان المشرف مسجل الدخول بالفعل
  const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
  if (isLoggedIn === 'true') {
    authContainer.style.display = 'none';
    dashboardContainer.style.display = 'block';
    loadAllOrders();
  }
  
  // حفظ حالة تسجيل الدخول عند الخروج
  window.addEventListener('beforeunload', function() {
    if (dashboardContainer.style.display === 'block') {
      sessionStorage.setItem('adminLoggedIn', 'true');
    }
  });
});

// ====== إضافة اختصار لوحة المفاتيح ======
document.addEventListener('keydown', function(e) {
  // Ctrl + / للبحث
  if (e.ctrlKey && e.key === '/') {
    e.preventDefault();
    document.getElementById('searchOrders').focus();
  }
  
  // Esc لإغلاق النوافذ المنبثقة
  if (e.key === 'Escape') {
    closeModal();
    closeDetailsModal();
  }
});
</script>

</body>
</html>