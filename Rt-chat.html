<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <link rel="icon" type="image/x-icon" href="img/icon1.jpg">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getDatabase, ref, set, get, update, push, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBlcKC2ncX9mTOPlhDOnfmyzdJ5mLinWYY",
            authDomain: "al-fajr-digital-library.firebaseapp.com",
            databaseURL: "https://al-fajr-digital-library-default-rtdb.firebaseio.com",
            projectId: "al-fajr-digital-library",
            storageBucket: "al-fajr-digital-library.firebasestorage.app",
            messagingSenderId: "739899495618",
            appId: "1:739899495618:web:8e60409193ec1408b4d75b",
            measurementId: "G-FFRQP9CXYK"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);
        
        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        window.firebaseStorage = storage;
        window.firebaseApp = app;
        
        window.firebase = {
            ref,
            set,
            get,
            update,
            push,
            onValue,
            query,
            orderByChild,
            limitToLast,
            onAuthStateChanged,
            storageRef,
            uploadBytes,
            getDownloadURL
        };
    </script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --ai-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --user-gradient: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            --dark-bg: #0a0a0f;
            --chat-bg: #141420;
            --card-bg: rgba(25, 25, 40, 0.95);
            --border-color: rgba(255, 255, 255, 0.08);
            --text-light: #ffffff;
            --text-gray: #a0a0c0;
            --success: #00ffaa;
            --warning: #ffd166;
            --danger: #ff6b6b;
            --ai-color: #7b68ee;
            --user-color: #ff9a9e;
            --accent-color: #00d4ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-light);
            height: 100vh;
            overflow: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(107, 17, 203, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(37, 117, 252, 0.1) 0%, transparent 20%);
        }

        .container {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
        }

        /* Sidebar - ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ */
        .sidebar {
            width: 320px;
            background: rgba(20, 20, 32, 0.9);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.3);
        }

        .sidebar-header {
            padding: 30px 25px;
            background: linear-gradient(180deg, rgba(107, 17, 203, 0.2), transparent);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--ai-color), transparent);
        }

        .ai-avatar {
            width: 90px;
            height: 90px;
            background: var(--ai-gradient);
            border-radius: 25px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            position: relative;
            animation: float 6s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(107, 17, 203, 0.4);
            transition: all 0.3s ease;
        }

        .ai-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(107, 17, 203, 0.6);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(123, 104, 238, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(123, 104, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(123, 104, 238, 0); }
        }

        .ai-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 8px 16px;
            background: rgba(123, 104, 238, 0.1);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: blink 1.5s infinite;
            position: relative;
        }

        .status-dot::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--success);
            border-radius: 50%;
            opacity: 0.3;
            animation: pulse 2s infinite;
        }

        .sidebar-stats {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.02);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(123, 104, 238, 0.1);
            transform: translateX(-5px);
        }

        .stat-label {
            color: var(--text-gray);
            font-size: 13px;
            font-weight: 500;
        }

        .stat-value {
            font-weight: 700;
            font-size: 20px;
            background: var(--ai-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(123, 104, 238, 0.3);
        }

        .community-section {
            padding: 25px;
            flex: 1;
            overflow: hidden;
        }

        .community-section h3 {
            margin-bottom: 20px;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .community-section h3 i {
            color: var(--accent-color);
        }

        .active-users {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 25px;
        }

        .user-badge {
            padding: 8px 14px;
            background: linear-gradient(135deg, rgba(123, 104, 238, 0.15), rgba(0, 212, 255, 0.1));
            border-radius: 15px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(123, 104, 238, 0.2);
            transition: all 0.3s ease;
        }

        .user-badge:hover {
            transform: translateY(-2px);
            border-color: var(--ai-color);
            box-shadow: 0 5px 15px rgba(123, 104, 238, 0.2);
        }

        .user-badge i {
            color: var(--accent-color);
        }

        .sidebar-actions {
            padding: 25px;
            border-top: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.02);
        }

        .action-btn {
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(123, 104, 238, 0.15), rgba(0, 212, 255, 0.1));
            color: var(--text-light);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(123, 104, 238, 0.2);
        }

        .action-btn i {
            color: var(--accent-color);
            transition: transform 0.3s ease;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, rgba(123, 104, 238, 0.25), rgba(0, 212, 255, 0.2));
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(123, 104, 238, 0.3);
            border-color: var(--ai-color);
        }

        .action-btn:hover i {
            transform: translateX(-5px);
        }

        /* Main Chat Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(10, 10, 15, 0.7);
            position: relative;
        }

        .chat-header {
            padding: 22px 35px;
            background: rgba(20, 20, 32, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-color), transparent);
        }

        .chat-header h1 {
            font-size: 26px;
            background: linear-gradient(135deg, var(--ai-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-controls {
            display: flex;
            gap: 12px;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-btn:hover {
            background: rgba(123, 104, 238, 0.2);
            transform: translateY(-2px);
            border-color: var(--ai-color);
            box-shadow: 0 5px 20px rgba(123, 104, 238, 0.3);
        }

        .control-btn.active {
            background: rgba(123, 104, 238, 0.3);
            border-color: var(--ai-color);
            box-shadow: 0 0 20px rgba(123, 104, 238, 0.4);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            background: 
                radial-gradient(circle at 0% 0%, rgba(107, 17, 203, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(37, 117, 252, 0.05) 0%, transparent 50%);
        }

        /* Message Styles - ØªØµÙ…ÙŠÙ… Ù…ØªØ·ÙˆØ± */
        .message {
            display: flex;
            gap: 18px;
            animation: messageAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 85%;
            position: relative;
        }

        @keyframes messageAppear {
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.ai {
            align-self: flex-start;
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            flex-shrink: 0;
            position: relative;
            z-index: 2;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .avatar:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .avatar.ai-avatar-small {
            background: var(--ai-gradient);
            color: white;
            box-shadow: 0 5px 20px rgba(107, 17, 203, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .avatar.user-avatar-small {
            background: var(--user-gradient);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 154, 158, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .message-content {
            background: var(--card-bg);
            border-radius: 22px;
            padding: 20px 25px;
            max-width: 100%;
            position: relative;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .message-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, rgba(255, 154, 158, 0.15), rgba(250, 208, 196, 0.1));
            border-color: rgba(255, 154, 158, 0.3);
            border-bottom-right-radius: 8px;
        }

        .message.ai .message-content {
            background: linear-gradient(135deg, rgba(123, 104, 238, 0.15), rgba(37, 117, 252, 0.1));
            border-color: rgba(123, 104, 238, 0.3);
            border-bottom-left-radius: 8px;
        }

        .message-text {
            font-size: 15.5px;
            line-height: 1.7;
            word-wrap: break-word;
            color: var(--text-light);
            font-weight: 400;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® */
        .datetime-info {
            display: inline-block;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(123, 104, 238, 0.2));
            padding: 8px 16px;
            border-radius: 12px;
            margin: 10px 0;
            border: 1px solid rgba(0, 212, 255, 0.3);
            font-weight: 600;
            font-size: 15px;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(0, 212, 255, 0.3); }
            to { box-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙˆØ± */
        .message-image {
            max-width: 300px;
            max-height: 300px;
            border-radius: 16px;
            margin: 15px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .message-image:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
        }

        .image-container {
            position: relative;
            display: inline-block;
        }

        .image-caption {
            font-size: 13px;
            color: var(--text-gray);
            text-align: center;
            margin-top: 8px;
            font-style: italic;
        }

        .message-actions {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-icon {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .action-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--ai-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .action-icon:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 15px rgba(123, 104, 238, 0.4);
        }

        .action-icon:hover::before {
            opacity: 1;
        }

        .action-icon i {
            position: relative;
            z-index: 1;
            transition: color 0.3s ease;
        }

        .action-icon:hover i {
            color: white;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 12px;
            text-align: left;
            font-weight: 400;
            opacity: 0.8;
        }

        .message.user .message-time {
            text-align: right;
        }

        /* Typing Indicator - Ù…ØªØ·ÙˆØ± */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding: 15px 25px;
            background: rgba(123, 104, 238, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(123, 104, 238, 0.2);
            width: fit-content;
            backdrop-filter: blur(10px);
        }

        .typing-dots {
            display: flex;
            gap: 6px;
        }

        .typing-dot {
            width: 10px;
            height: 10px;
            background: var(--ai-color);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
            filter: drop-shadow(0 0 5px currentColor);
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; background: var(--accent-color); }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; background: #ff9a9e; }

        @keyframes typingBounce {
            0%, 60%, 100% { 
                transform: translateY(0) scale(1);
            }
            30% { 
                transform: translateY(-8px) scale(1.2);
            }
        }

        .typing-text {
            font-size: 14px;
            color: var(--ai-color);
            font-weight: 500;
            background: linear-gradient(90deg, var(--ai-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Input Area - ØªØµÙ…ÙŠÙ… Ù…ØªÙ‚Ø¯Ù… */
        .input-area {
            padding: 25px 35px;
            background: rgba(20, 20, 32, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-color);
            position: relative;
            z-index: 10;
        }

        .input-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-color), transparent);
        }

        .input-container {
            display: flex;
            gap: 18px;
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        #userInput {
            width: 100%;
            padding: 20px 70px 20px 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border-color);
            border-radius: 18px;
            color: var(--text-light);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            font-weight: 400;
            backdrop-filter: blur(10px);
        }

        #userInput:focus {
            border-color: var(--ai-color);
            box-shadow: 0 0 0 4px rgba(123, 104, 238, 0.2);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .input-icons {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 12px;
        }

        .input-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .input-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--ai-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .input-icon:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(123, 104, 238, 0.3);
        }

        .input-icon:hover::before {
            opacity: 1;
        }

        .input-icon i {
            position: relative;
            z-index: 1;
            transition: color 0.3s ease;
        }

        .input-icon:hover i {
            color: white;
        }

        .input-icon.active {
            background: var(--ai-gradient);
            color: white;
            box-shadow: 0 5px 20px rgba(123, 104, 238, 0.4);
        }

        #sendButton {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: var(--ai-gradient);
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(123, 104, 238, 0.4);
        }

        #sendButton::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #sendButton:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 12px 35px rgba(123, 104, 238, 0.6);
        }

        #sendButton:hover::before {
            opacity: 1;
        }

        #sendButton:active {
            transform: scale(0.95);
        }

        /* Suggestions */
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }

        .suggestion-btn {
            padding: 10px 20px;
            background: rgba(123, 104, 238, 0.1);
            border: 1px solid rgba(123, 104, 238, 0.3);
            border-radius: 15px;
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .suggestion-btn:hover {
            background: rgba(123, 104, 238, 0.2);
            transform: translateY(-3px);
            border-color: var(--ai-color);
            box-shadow: 0 8px 25px rgba(123, 104, 238, 0.3);
        }

        .suggestion-btn i {
            color: var(--accent-color);
            font-size: 13px;
        }

        /* Voice Recording Indicator */
        .voice-indicator {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 32, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            border: 2px solid var(--ai-color);
            backdrop-filter: blur(20px);
            animation: pulseBorder 2s infinite;
        }

        @keyframes pulseBorder {
            0%, 100% { border-color: var(--ai-color); }
            50% { border-color: var(--accent-color); }
        }

        .voice-waves {
            display: flex;
            gap: 6px;
            align-items: flex-end;
            height: 40px;
            margin: 20px 0;
        }

        .voice-wave {
            width: 6px;
            background: var(--ai-gradient);
            border-radius: 3px;
            animation: voiceWave 1.2s infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voiceWave {
            0%, 100% { height: 10px; }
            50% { height: 40px; }
        }

        /* Loading Animation */
        .loader {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--ai-color);
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 40px;
            right: 40px;
            padding: 18px 28px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 18px;
            z-index: 9999;
            transform: translateX(120px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(20px);
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast-success {
            border-right: 4px solid var(--success);
            background: linear-gradient(135deg, rgba(0, 255, 170, 0.05), rgba(20, 20, 32, 0.9));
        }

        .toast-error {
            border-right: 4px solid var(--danger);
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.05), rgba(20, 20, 32, 0.9));
        }

        .toast-info {
            border-right: 4px solid var(--ai-color);
            background: linear-gradient(135deg, rgba(123, 104, 238, 0.05), rgba(20, 20, 32, 0.9));
        }

        .toast-icon {
            font-size: 22px;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-success .toast-icon {
            background: rgba(0, 255, 170, 0.1);
            color: var(--success);
        }

        .toast-error .toast-icon {
            background: rgba(255, 107, 107, 0.1);
            color: var(--danger);
        }

        .toast-info .toast-icon {
            background: rgba(123, 104, 238, 0.1);
            color: var(--ai-color);
        }

        .toast-message {
            flex: 1;
            font-size: 14.5px;
            font-weight: 500;
            line-height: 1.5;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 60vh;
                overflow-y: auto;
            }
        }

        @media (max-width: 768px) {
            .chat-header {
                padding: 18px;
                flex-direction: column;
                gap: 18px;
            }
            
            .chat-container {
                padding: 20px;
            }
            
            .input-area {
                padding: 20px;
            }
            
            .message {
                max-width: 95%;
            }
            
            .message-content {
                padding: 16px 20px;
            }
            
            .suggestions {
                justify-content: center;
            }
            
            .toast {
                bottom: 20px;
                right: 20px;
                left: 20px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            #userInput {
                padding: 16px 60px 16px 20px;
            }
            
            .input-icon {
                width: 36px;
                height: 36px;
            }
            
            #sendButton {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .suggestion-btn {
                padding: 8px 14px;
                font-size: 12px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--ai-gradient);
            border-radius: 5px;
            border: 2px solid rgba(20, 20, 32, 0.9);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #7b68ee, #00d4ff);
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: scaleIn 0.4s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close-image-modal {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            backdrop-filter: blur(10px);
        }

        .close-image-modal:hover {
            background: var(--danger);
            transform: rotate(90deg);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: var(--ai-gradient);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(123, 104, 238, 0.2);
            color: var(--ai-color);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
            border: 1px solid rgba(123, 104, 238, 0.3);
        }

        /* Command Line Effect */
        .command-line {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid var(--ai-color);
            overflow-x: auto;
        }

        /* AI Memory Status */
        .memory-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 15px;
            font-size: 12px;
            margin: 5px 0;
        }

        .memory-bar {
            width: 60px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .memory-fill {
            height: 100%;
            background: var(--ai-gradient);
            border-radius: 3px;
        }
    </style>

    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Voice Recording Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div style="text-align: center;">
            <i class="fas fa-microphone" style="font-size: 30px; color: var(--ai-color); margin-bottom: 15px;"></i>
            <h3 style="color: white; margin-bottom: 15px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ...</h3>
            <div class="voice-waves">
                <div class="voice-wave"></div>
                <div class="voice-wave"></div>
                <div class="voice-wave"></div>
                <div class="voice-wave"></div>
                <div class="voice-wave"></div>
            </div>
            <p style="color: var(--text-gray); margin-top: 15px; font-size: 14px;">ØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù†... Ø³Ø£ØªÙˆÙ‚Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="image-modal" id="imageModal">
        <button class="close-image-modal" onclick="closeImageModal()">&times;</button>
        <img id="modalImage" src="" alt="ØµÙˆØ±Ø© Ù…ÙƒØ¨Ø±Ø©">
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="ai-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <h2>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h2>
                <div class="ai-status">
                    <div class="status-dot"></div>
                    <span>Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† â€¢ Ù…ØªØ¹Ù„Ù… Ù†Ø´Ø·</span>
                </div>
            </div>

            <div class="sidebar-stats">
                <div class="stat-item">
                    <span class="stat-label">Ø§Ù„Ù…Ø¹Ø§Ø±Ù Ø§Ù„Ù…Ø®Ø²Ù†Ø©</span>
                    <span class="stat-value" id="knowledgeCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    <span class="stat-value" id="activeUsersCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ù†Ø´Ø£Ø©</span>
                    <span class="stat-value" id="imagesGenerated">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ø°ÙƒØ§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    <span class="stat-value" id="accuracyRate">94%</span>
                </div>
            </div>

            <div class="community-section">
                <h3><i class="fas fa-users"></i> Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h3>
                <div class="active-users" id="activeUsersList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>

                <div class="suggestions">
                    <button class="suggestion-btn" onclick="sendSuggestion('Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¢Ù†ØŸ')">
                        <i class="fas fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
                    </button>
                    <button class="suggestion-btn" onclick="sendSuggestion('Ø£Ù†Ø´Ø¦ Ù„ÙŠ ØµÙˆØ±Ø© Ù„Ø£Ø³Ø¯')">
                        <i class="fas fa-image"></i> Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©
                    </button>
                    <button class="suggestion-btn" onclick="sendSuggestion('Ù…Ø§ Ù‡ÙŠ Ø£ÙØ¶Ù„ Ø±ÙˆØ§ÙŠØ§Øª 2024ØŸ')">
                        <i class="fas fa-book"></i> Ø±ÙˆØ§ÙŠØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </div>
            </div>

            <div class="sidebar-actions">
                <button class="action-btn" onclick="openTrainModal()">
                    <span>ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø°ÙƒØ§Ø¡</span>
                    <i class="fas fa-graduation-cap"></i>
                </button>
                <button class="action-btn" onclick="openKnowledgeBase()">
                    <span>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©</span>
                    <i class="fas fa-brain"></i>
                </button>
                <button class="action-btn" onclick="toggleVoice()" id="voiceToggleBtn">
                    <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</span>
                    <i class="fas fa-volume-up"></i>
                </button>
                <button class="action-btn" onclick="openImageGenerator()">
                    <span>Ù…ÙˆÙ„Ø¯ Ø§Ù„ØµÙˆØ±</span>
                    <i class="fas fa-magic"></i>
                </button>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-content">
            <div class="chat-header">
                <h1><i class="fas fa-sparkles"></i> Ù…Ø³Ø§Ø¹Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
                <div class="header-controls">
                    <button class="control-btn" onclick="toggleTheme()" id="themeToggleBtn">
                        <i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                    </button>
                    <button class="control-btn" onclick="exportConversation()">
                        <i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ±
                    </button>
                    <button class="control-btn" onclick="showMemoryStatus()">
                        <i class="fas fa-microchip"></i> Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    </button>
                </div>
            </div>

            <div class="chat-container" id="chatContainer">
                <!-- Messages will be added here -->
                <div class="message ai">
                    <div class="avatar ai-avatar-small">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">
                            <span class="badge">v2.0</span>
                            ğŸ¤– **Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…!**
                            
                            Ø£Ù†Ø§ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ·ÙˆØ± ÙŠÙ…ÙƒÙ†Ù†ÙŠ:
                            â€¢ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ Ø¹Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆØ§Ù„ÙƒØªØ¨
                            â€¢ Ø¥Ø®Ø¨Ø§Ø±Ùƒ Ø¨Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
                            â€¢ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ù…Ù† Ù†ØµÙƒ ğŸ“¸
                            â€¢ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªÙŠ ØªØ±Ø³Ù„Ù‡Ø§
                            â€¢ Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù† Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙ†Ø§
                            
                            <div class="memory-status">
                                <span>Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:</span>
                                <div class="memory-bar">
                                    <div class="memory-fill" style="width: 85%"></div>
                                </div>
                                <span>85%</span>
                            </div>
                            
                            Ø¬Ø±Ø¨ Ø£Ù† ØªØ³Ø£Ù„Ù†ÙŠ: "Ù…Ø§ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†ØŸ" Ø£Ùˆ "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ù‚Ø·Ø©"
                        </div>
                        <div class="message-actions">
                            <div class="action-icon" onclick="copyMessage(this)">
                                <i class="fas fa-copy"></i>
                            </div>
                            <div class="action-icon" onclick="likeMessage(this)">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="action-icon" onclick="shareMessage(this)">
                                <i class="fas fa-share-alt"></i>
                            </div>
                        </div>
                        <div class="message-time">Ø§Ù„Ø¢Ù†</div>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <div class="typing-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ± ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©...</div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <div class="input-wrapper">
                        <input type="text" id="userInput" 
                               placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø£Ùˆ Ù‚Ù„ 'Ø§Ù„ÙˆÙ‚Øª' Ø£Ùˆ 'Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø©'..." 
                               autocomplete="off" />
                        <div class="input-icons">
                            <div class="input-icon" onclick="toggleAttachment()" id="attachBtn">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="input-icon" onclick="toggleVoiceRecording()" id="voiceBtn">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                        </div>
                    </div>
                    <button id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>

                <div class="suggestions">
                    <button class="suggestion-btn" onclick="sendSuggestion('Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠØŸ')">
                        <i class="fas fa-calendar-alt"></i> Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
                    </button>
                    <button class="suggestion-btn" onclick="sendSuggestion('Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ù„Ù…Ù†Ø¸Ø± Ø·Ø¨ÙŠØ¹ÙŠ')">
                        <i class="fas fa-mountain"></i> Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©
                    </button>
                    <button class="suggestion-btn" onclick="sendSuggestion('Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹ØŸ')">
                        <i class="fas fa-chart-line"></i> Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹
                    </button>
                    <button class="suggestion-btn" onclick="sendSuggestion('Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©...')">
                        <i class="fas fa-search"></i> ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Training Modal -->
    <div class="modal-overlay" id="trainModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-graduation-cap"></i> ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                <button class="close-modal" onclick="closeTrainModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="training-steps">
                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTrainModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveTraining()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø±ÙØ©
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas" id="toastIcon"></i>
        </div>
        <div class="toast-message" id="toastMessage">ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</div>
    </div>

    <script>
// ====== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ======
let currentUser = null;
let aiKnowledge = {};
let activeUsers = new Set();
let conversationHistory = [];
let isVoiceEnabled = true;
let isRecording = false;
let recognition = null;
let imagesGenerated = 0;
let isVoiceSupported = false;
let currentTheme = 'dark';

// ====== Ø¹Ù†Ø§ØµØ± DOM ======
const chatContainer = document.getElementById('chatContainer');
const userInput = document.getElementById('userInput');
const sendButton = document.getElementById('sendButton');
const knowledgeCount = document.getElementById('knowledgeCount');
const activeUsersCount = document.getElementById('activeUsersCount');
const imagesGeneratedEl = document.getElementById('imagesGenerated');
const typingIndicator = document.getElementById('typingIndicator');
const voiceIndicator = document.getElementById('voiceIndicator');
const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toastMessage');
const toastIcon = document.getElementById('toastIcon');
const voiceBtn = document.getElementById('voiceBtn');
const attachBtn = document.getElementById('attachBtn');
const themeToggleBtn = document.getElementById('themeToggleBtn');
const voiceToggleBtn = document.getElementById('voiceToggleBtn');
const imageUpload = document.getElementById('imageUpload');

// ====== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ======
async function init() {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    imagesGenerated = parseInt(localStorage.getItem('imagesGenerated')) || 0;
    imagesGeneratedEl.textContent = imagesGenerated;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    setupEventListeners();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
    setupVoiceRecognition();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸
    loadConversationHistory();
    
    // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    loadDefaultKnowledge();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù…Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    loadSavedTheme();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    updateStats();
    
    // Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
    updateDateTime();
    setInterval(updateDateTime, 60000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¯ÙˆØ±ÙŠØ§Ù‹
    setInterval(updateStats, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    
    showToast('ğŸš€ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¢Ù†', 'success');
    console.log('âœ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§ÙƒØªÙ…Ù„Øª');
}

// ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ======
function updateDateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('ar-SA', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
    });
    
    const dateString = now.toLocaleDateString('ar-SA', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    window.currentDateTime = {
        time: timeString,
        date: dateString,
        timestamp: now.toISOString(),
        hijri: getHijriDate(now)
    };
    
    console.log('ğŸ•’ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø«:', timeString);
}

function getHijriDate(date) {
    // Ø­Ø³Ø§Ø¨ Ù…Ø¨Ø³Ø· Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ hijri-date)
    const gregorianYear = date.getFullYear();
    const hijriYear = Math.floor((gregorianYear - 622) * (33/32));
    
    const months = ['Ù…Ø­Ø±Ù…', 'ØµÙØ±', 'Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„', 'Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø±', 'Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰', 'Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©', 
                   'Ø±Ø¬Ø¨', 'Ø´Ø¹Ø¨Ø§Ù†', 'Ø±Ù…Ø¶Ø§Ù†', 'Ø´ÙˆØ§Ù„', 'Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©', 'Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©'];
    
    const randomMonth = months[Math.floor(Math.random() * months.length)];
    const day = date.getDate();
    
    return `${day} ${randomMonth} ${hijriYear} Ù‡Ù€`;
}

function handleDateTimeRequest() {
    updateDateTime(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø£ÙˆÙ„Ø§Ù‹
    
    return `
ğŸ•’ **Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:** ${window.currentDateTime.time}
ğŸ“… **Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ:** ${window.currentDateTime.date}
ğŸ“¿ **Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ:** ${window.currentDateTime.hijri}
ğŸ“ **Ø§Ù„ØªÙˆÙ‚ÙŠØª:** ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© (GMT+3)

â° Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
    `;
}

// ====== Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù… ======
function setupVoiceRecognition() {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        
        recognition.lang = 'ar-SA';
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.maxAlternatives = 1;
        
        isVoiceSupported = true;
        
        recognition.onstart = function() {
            console.log('ğŸ¤ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ');
            isRecording = true;
            voiceBtn.classList.add('active');
            voiceIndicator.style.display = 'block';
        };
        
        recognition.onresult = function(event) {
            let finalTranscript = '';
            let interimTranscript = '';
            
            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                } else {
                    interimTranscript += transcript;
                }
            }
            
            if (finalTranscript) {
                userInput.value = finalTranscript;
                console.log('ğŸ¤ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¹ØªØ±Ù Ø¨Ù‡:', finalTranscript);
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¤Ù‚Øª
            if (interimTranscript) {
                userInput.placeholder = interimTranscript;
            }
        };
        
        recognition.onend = function() {
            console.log('â¹ï¸ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ');
            isRecording = false;
            voiceBtn.classList.remove('active');
            voiceIndicator.style.display = 'none';
            userInput.placeholder = 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø£Ùˆ Ù‚Ù„ "Ø§Ù„ÙˆÙ‚Øª" Ø£Ùˆ "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø©"...';
            
            if (userInput.value.trim()) {
                processUserInput();
            }
        };
        
        recognition.onerror = function(event) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…:', event.error);
            isRecording = false;
            voiceBtn.classList.remove('active');
            voiceIndicator.style.display = 'none';
            
            if (event.error === 'no-speech') {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† ØµÙˆØª', 'warning');
            } else if (event.error === 'audio-capture') {
                showToast('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 'error');
            } else if (event.error === 'not-allowed') {
                showToast('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 'error');
            }
        };
        
        console.log('âœ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª Ù…ÙØ¹Ù„');
    } else {
        isVoiceSupported = false;
        console.warn('âš ï¸ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…');
        showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…', 'warning');
    }
}

function toggleVoiceRecording() {
    if (!isVoiceSupported) {
        showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø©', 'error');
        return;
    }
    
    if (!isRecording) {
        try {
            recognition.start();
        } catch (error) {
            console.error('âŒ ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
            showToast('ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ', 'error');
        }
    } else {
        recognition.stop();
    }
}

function toggleVoice() {
    isVoiceEnabled = !isVoiceEnabled;
    
    if (isVoiceEnabled) {
        voiceToggleBtn.innerHTML = '<span>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª</span><i class="fas fa-volume-mute"></i>';
        showToast('ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª', 'success');
    } else {
        voiceToggleBtn.innerHTML = '<span>ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</span><i class="fas fa-volume-up"></i>';
        showToast('ğŸ”‡ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª', 'info');
    }
    
    localStorage.setItem('voiceEnabled', isVoiceEnabled);
}

// ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± ======
function toggleAttachment() {
    imageUpload.click();
}

async function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ÙÙ‚Ø·', 'error');
        return;
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯Ø®Ù„
    event.target.value = '';
    
    showTypingIndicator();
    
    try {
        const reader = new FileReader();
        
        reader.onload = async function(e) {
            const imageData = e.target.result;
            
            addImageMessage(imageData, 'user', 'ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©');
            
            setTimeout(() => {
                hideTypingIndicator();
                analyzeImage(file, imageData);
            }, 1500);
        };
        
        reader.onerror = function() {
            hideTypingIndicator();
            showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©', 'error');
        };
        
        reader.readAsDataURL(file);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©:', error);
        hideTypingIndicator();
        showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©', 'error');
    }
}

async function analyzeImage(file, imageData) {
    const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
    const dimensions = await getImageDimensions(imageData);
    
    const responses = [
        `ğŸ” **ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©:**
        
ğŸ“Š **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±Ø©:**
â€¢ Ø§Ù„Ø­Ø¬Ù…: ${fileSizeMB} Ù…ÙŠØºØ§Ø¨Ø§ÙŠØª
â€¢ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ${dimensions.width} Ã— ${dimensions.height} Ø¨ÙƒØ³Ù„
â€¢ Ø§Ù„Ù†ÙˆØ¹: ${file.type.split('/')[1].toUpperCase()}
â€¢ Ø§Ù„Ø¯Ù‚Ø©: ${dimensions.width > 2000 ? 'Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹' : dimensions.width > 1000 ? 'Ø¹Ø§Ù„ÙŠØ©' : 'Ù‚ÙŠØ§Ø³ÙŠØ©'}

ğŸ¤– **Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:**
ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠØ© Ù„Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.
ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
1. Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ù…Ø´Ø§Ø¨Ù‡Ø©
2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø±Ø³Ù…
3. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ†
4. Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª ÙÙ†ÙŠØ©

ğŸ’¡ **Ø¬Ø±Ø¨:** Ù‚Ù„ "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ù…Ø´Ø§Ø¨Ù‡Ø©" Ø£Ùˆ "Ø­ÙˆÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Ø±Ø³Ù… ÙƒØ±ØªÙˆÙ†ÙŠ"`,

        `ğŸ¨ **ØªØ­Ù„ÙŠÙ„ ÙÙ†ÙŠ Ù„Ù„ØµÙˆØ±Ø©:**
        
âœ… **Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!**
ğŸ“ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: ${dimensions.width} Ã— ${dimensions.height}
ğŸ’¾ Ø§Ù„Ø­Ø¬Ù…: ${fileSizeMB} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª
ğŸ¯ Ø§Ù„Ø¬ÙˆØ¯Ø©: ${fileSizeMB > 2 ? 'Ø§Ø­ØªØ±Ø§ÙÙŠØ©' : 'Ø¬ÙŠØ¯Ø©'}

âœ¨ **Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:**
â€¢ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø® ÙÙ†ÙŠØ© Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
â€¢ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ±Ø§Øª Ø°ÙƒÙŠØ©
â€¢ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙÙ†ÙŠØ©
â€¢ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ù…Ø´Ø§Ø¨Ù‡Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ

ğŸ”§ **Ø§Ù„Ø£Ø¯ÙˆØ§Øª:** Ø¬Ø±Ø¨ Ø·Ù„Ø¨ "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨"`,

        `ğŸ¤– **Ø§Ø³ØªÙ„Ø§Ù… ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©:**
        
ğŸ“¸ **ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!**
Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙ†ÙŠØ© Ù…Ø³ØªØ¹Ø¯Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.

ğŸ”¬ **Ø§Ù„Ø¥Ù…ÙƒØ§Ù†ÙŠØ§Øª:**
â€¢ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©)
â€¢ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØµÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ
â€¢ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± Ù…Ø´Ø§Ø¨Ù‡Ø©
â€¢ ØªØ·Ø¨ÙŠÙ‚ ØªØ£Ø«ÙŠØ±Ø§Øª Ø°ÙƒÙŠØ©

ğŸ­ **Ø¬Ø±Ø¨ Ø¥Ø­Ø¯Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø±:**
"Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ù…Ø´Ø§Ø¨Ù‡Ø©"
"Ø­ÙˆÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø²ÙŠØªÙŠØ©"
"Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ù„ÙˆØ§Ù†"`
    ];
    
    const response = responses[Math.floor(Math.random() * responses.length)];
    addMessage(response, 'ai');
    speakText(response);
}

function getImageDimensions(dataUrl) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = function() {
            resolve({
                width: this.width,
                height: this.height
            });
        };
        img.src = dataUrl;
    });
}

// ====== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ======
async function generateRealImage(prompt) {
    showTypingIndicator();
    
    try {
        console.log('ğŸ¨ Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø©:', prompt);
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù…Ø¬Ø§Ù†ÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±
        const imageUrl = await createImageWithAPI(prompt);
        
        hideTypingIndicator();
        
        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ­ÙØ¸Ù‡
        imagesGenerated++;
        imagesGeneratedEl.textContent = imagesGenerated;
        localStorage.setItem('imagesGenerated', imagesGenerated.toString());
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©
        addImageMessage(imageUrl, 'ai', `Ø£Ù†Ø´Ø£ØªÙ‡Ø§ Ù…Ù†: "${prompt}"`);
        
        const message = `âœ… **ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!**
        
ğŸ¨ **Ø§Ù„ÙˆØµÙ:** ${prompt}
ğŸ¤– **Ø§Ù„Ù…Ø­Ø±Ùƒ:** Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±
ğŸ“Š **Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ:** #IMG-${imagesGenerated.toString().padStart(4, '0')}
âœ¨ **Ø§Ù„ØªÙ‚Ù†ÙŠØ©:** ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
â­ **Ø§Ù„Ø¬ÙˆØ¯Ø©:** Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¯Ù‚Ø© (AI Generated)

ğŸ’¡ **Ù†ØµÙŠØ­Ø©:** ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ø£Ø®Ø±Ù‰!
ğŸ”§ **Ø¬Ø±Ø¨:** "Ø§Ø¬Ø¹Ù„Ù‡Ø§ ÙˆØ§Ù‚Ø¹ÙŠØ© Ø£ÙƒØ«Ø±" Ø£Ùˆ "ØºÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù†"`;
        
        addMessage(message, 'ai');
        speakText(message);
        
        // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
        saveGeneratedImage(prompt, imageUrl);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©:', error);
        hideTypingIndicator();
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØ± Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        useFallbackImage(prompt);
    }
}

async function createImageWithAPI(prompt) {
    try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Replicate API (Ø¨Ø¯ÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ)
        const replicateResponse = await tryReplicateAPI(prompt);
        if (replicateResponse) return replicateResponse;
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Hugging Face
        const hfResponse = await tryHuggingFaceAPI(prompt);
        if (hfResponse) return hfResponse;
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… DALL-E Mini API
        const dalleMiniResponse = await tryDalleMiniAPI(prompt);
        if (dalleMiniResponse) return dalleMiniResponse;
        
        // Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
        throw new Error('ÙØ´Ù„ Ø¬Ù…ÙŠØ¹ ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª');
        
    } catch (error) {
        console.error('âŒ ÙØ´Ù„ Ø¬Ù…ÙŠØ¹ ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª:', error);
        throw error;
    }
}

async function tryReplicateAPI(prompt) {
    try {
        // Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ØŒ ØªØ­ØªØ§Ø¬ Ù„ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Replicate
        console.log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Replicate API...');
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…ÙˆØ°Ø¬ Stable Diffusion Ù…Ø¬Ø§Ù†Ø§Ù‹
        const response = await fetch('https://api.replicate.com/v1/predictions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${getReplicateToken()}`,
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                version: "stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b",
                input: {
                    prompt: prompt,
                    width: 512,
                    height: 512,
                    num_outputs: 1,
                    guidance_scale: 7.5,
                    num_inference_steps: 50
                }
            })
        });
        
        if (!response.ok) {
            console.warn('âš ï¸ Replicate API ØºÙŠØ± Ù…ØªØ§Ø­');
            return null;
        }
        
        const data = await response.json();
        console.log('ğŸ“¦ Replicate response:', data);
        
        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
        const imageUrl = await pollPredictionStatus(data.id);
        return imageUrl;
        
    } catch (error) {
        console.warn('âš ï¸ ÙØ´Ù„ Replicate API:', error.message);
        return null;
    }
}

async function tryHuggingFaceAPI(prompt) {
    try {
        console.log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Hugging Face API...');
        
        // Ù†Ù…ÙˆØ°Ø¬ Stable Diffusion Ø¹Ù„Ù‰ Hugging Face
        const model = "stabilityai/stable-diffusion-2-1";
        const apiUrl = `https://api-inference.huggingface.co/models/${model}`;
        
        const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${getHuggingFaceToken()}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                inputs: prompt,
                parameters: {
                    width: 512,
                    height: 512,
                    num_inference_steps: 20
                }
            }),
        });
        
        if (!response.ok) {
            console.warn('âš ï¸ Hugging Face API ØºÙŠØ± Ù…ØªØ§Ø­');
            return null;
        }
        
        const blob = await response.blob();
        const imageUrl = URL.createObjectURL(blob);
        
        console.log('âœ… Hugging Face Ù†Ø¬Ø­');
        return imageUrl;
        
    } catch (error) {
        console.warn('âš ï¸ ÙØ´Ù„ Hugging Face API:', error.message);
        return null;
    }
}

async function tryDalleMiniAPI(prompt) {
    try {
        console.log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Craiyon API...');
        
        // Craiyon (DALL-E Mini) API
        const response = await fetch('https://api.craiyon.com/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                prompt: prompt,
                version: "35s5hfwn9n78gb06"
            })
        });
        
        if (!response.ok) {
            console.warn('âš ï¸ Craiyon API ØºÙŠØ± Ù…ØªØ§Ø­');
            return null;
        }
        
        const data = await response.json();
        
        if (data.images && data.images.length > 0) {
            const base64Image = data.images[0];
            const imageUrl = `data:image/jpeg;base64,${base64Image}`;
            
            console.log('âœ… Craiyon Ù†Ø¬Ø­');
            return imageUrl;
        }
        
        return null;
        
    } catch (error) {
        console.warn('âš ï¸ ÙØ´Ù„ Craiyon API:', error.message);
        return null;
    }
}

async function pollPredictionStatus(predictionId) {
    // Ù‡Ø°Ø§ Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
    return new Promise((resolve, reject) => {
        let attempts = 0;
        const maxAttempts = 30; // 30 Ù…Ø­Ø§ÙˆÙ„Ø© ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ© = Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
        
        const checkStatus = async () => {
            try {
                const response = await fetch(`https://api.replicate.com/v1/predictions/${predictionId}`, {
                    headers: {
                        'Authorization': `Bearer ${getReplicateToken()}`,
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.status === 'succeeded') {
                    resolve(data.output[0]);
                } else if (data.status === 'failed' || attempts >= maxAttempts) {
                    reject(new Error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©'));
                } else {
                    attempts++;
                    setTimeout(checkStatus, 2000); // Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©
                }
            } catch (error) {
                reject(error);
            }
        };
        
        checkStatus();
    });
}

function getReplicateToken() {
    // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ token Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù†: https://replicate.com/
    // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø®Ø²Ù† Ù‡Ø°Ø§ ÙÙŠ Ù…ØªØºÙŠØ± Ø¨ÙŠØ¦Ø© Ø¢Ù…Ù†
    return 'YOUR_REPLICATE_TOKEN_HERE'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨ token Ø­Ù‚ÙŠÙ‚ÙŠ
}

function getHuggingFaceToken() {
    // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ token Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù†: https://huggingface.co/settings/tokens
    // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø®Ø²Ù† Ù‡Ø°Ø§ ÙÙŠ Ù…ØªØºÙŠØ± Ø¨ÙŠØ¦Ø© Ø¢Ù…Ù†
    return 'YOUR_HUGGINGFACE_TOKEN_HERE'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨ token Ø­Ù‚ÙŠÙ‚ÙŠ
}

function useFallbackImage(prompt) {
    // ØµÙˆØ± Unsplash Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„ÙˆØµÙ
    const fallbackImages = {
        'Ø£Ø³Ø¯': 'https://images.unsplash.com/photo-1546182990-dffeafbe841d?w=512&h=512&fit=crop',
        'Ù…Ù†Ø¸Ø± Ø·Ø¨ÙŠØ¹ÙŠ': 'https://images.unsplash.com/photo-1501854140801-50d01698950b?w=512&h=512&fit=crop',
        'ÙƒØªØ§Ø¨': 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=512&h=512&fit=crop',
        'Ù…ÙƒØªØ¨Ø©': 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=512&h=512&fit=crop',
        'Ù…Ø¯ÙŠÙ†Ø©': 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=512&h=512&fit=crop',
        'Ø¨Ø­Ø±': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=512&h=512&fit=crop',
        'ØºØ§Ø¨Ø©': 'https://images.unsplash.com/photo-1448375240586-882707db888b?w=512&h=512&fit=crop',
        'Ø³Ù…Ø§Ø¡': 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=512&h=512&fit=crop'
    };
    
    let selectedImage = 'https://images.unsplash.com/photo-1543852786-1cf6624b9987?w=512&h=512&fit=crop';
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØ±Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØµÙ
    for (const [keyword, url] of Object.entries(fallbackImages)) {
        if (prompt.includes(keyword)) {
            selectedImage = url;
            break;
        }
    }
    
    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
    imagesGenerated++;
    imagesGeneratedEl.textContent = imagesGenerated;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©
    addImageMessage(selectedImage, 'ai', `ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„Ù€: "${prompt}"`);
    
    const message = `ğŸ¨ **ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©:**
    
ğŸ’¡ **Ù…Ù„Ø§Ø­Ø¸Ø©:** Ø­Ø§Ù„ÙŠØ§Ù‹ Ø£Ø³ØªØ®Ø¯Ù… ØµÙˆØ±Ø§Ù‹ ØªÙˆØ¶ÙŠØ­ÙŠØ© Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª.
Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© token API Ø­Ù‚ÙŠÙ‚ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!

ğŸ”§ **ÙƒÙŠÙÙŠØ© Ø§Ù„ØªÙØ¹ÙŠÙ„:**
1. Ø³Ø¬Ù„ ÙÙŠ replicate.com (Ù…Ø¬Ø§Ù†ÙŠ)
2. Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ API token
3. Ø£Ø¶Ù token ÙÙŠ Ø³Ø·Ø± 656 Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
4. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ©!`;
    
    addMessage(message, 'ai');
    speakText(message);
}

function saveGeneratedImage(prompt, imageUrl) {
    const generatedImages = JSON.parse(localStorage.getItem('generatedImages') || '[]');
    
    generatedImages.push({
        prompt: prompt,
        imageUrl: imageUrl,
        timestamp: new Date().toISOString(),
        id: `IMG-${imagesGenerated}`
    });
    
    // Ø­ÙØ¸ Ø¢Ø®Ø± 50 ØµÙˆØ±Ø© ÙÙ‚Ø·
    if (generatedImages.length > 50) {
        generatedImages.shift();
    }
    
    localStorage.setItem('generatedImages', JSON.stringify(generatedImages));
}

// ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ======
async function processUserInput(inputText = null) {
    const text = inputText || userInput.value.trim();
    if (!text) return;

    console.log('ğŸ’¬ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:', text);
    
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    addMessage(text, 'user');
    userInput.value = '';
    
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„ØªØ­Ù„ÙŠÙ„
    const normalizedText = text.toLowerCase().replace(/[.,!ØŸØŒ]/g, '');
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø®Ø§ØµØ©
    if (normalizedText.includes('Ø§Ù„ÙˆÙ‚Øª') || normalizedText.includes('Ø§Ù„ØªØ§Ø±ÙŠØ®') || 
        normalizedText.includes('Ø§Ù„Ø³Ø§Ø¹Ø©') || normalizedText.includes('Ø§Ù„ØªÙˆÙ‚ÙŠØª')) {
        
        showTypingIndicator();
        setTimeout(() => {
            hideTypingIndicator();
            const response = handleDateTimeRequest();
            addMessage(response, 'ai');
            speakText(response);
        }, 800);
        return;
    }
    
    // Ø£ÙˆØ§Ù…Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±
    if (normalizedText.includes('Ø£Ù†Ø´Ø¦') || normalizedText.includes('Ø§ØµÙ†Ø¹') || 
        normalizedText.includes('Ø§Ø±Ø³Ù…') || (normalizedText.includes('ØµÙˆØ±Ø©') && 
        (normalizedText.includes('Ù„ÙŠ') || normalizedText.includes('Ù„Ù€') || 
         normalizedText.includes('Ù„ÙŠ') || normalizedText.includes('ØµÙˆØ±')))) {
        
        const prompt = extractImagePrompt(text);
        if (prompt) {
            generateRealImage(prompt);
        } else {
            addMessage("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø°ÙƒØ± Ù…Ø§ ØªØ±ÙŠØ¯ Ø£Ù† Ø£Ù†Ø´Ø¦Ù‡. Ù…Ø«Ø§Ù„: 'Ø£Ù†Ø´Ø¦ Ù„ÙŠ ØµÙˆØ±Ø© Ø£Ø³Ø¯' Ø£Ùˆ 'Ø§ØµÙ†Ø¹ ØµÙˆØ±Ø© Ù„Ù…Ù†Ø¸Ø± Ø·Ø¨ÙŠØ¹ÙŠ'", 'ai');
        }
        return;
    }
    
    // Ø£ÙˆØ§Ù…Ø± Ø£Ø®Ø±Ù‰ Ø®Ø§ØµØ©
    if (normalizedText.includes('Ù…Ø³Ø­') && normalizedText.includes('Ù…Ø­Ø§Ø¯Ø«Ø©')) {
        setTimeout(() => {
            const confirm = window.confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ');
            if (confirm) {
                clearChat();
            }
        }, 100);
        return;
    }
    
    if (normalizedText.includes('Ù…Ø³Ø§Ø¹Ø¯Ø©') || normalizedText.includes('Ù…Ø§Ø°Ø§ ØªØ³ØªØ·ÙŠØ¹')) {
        showHelp();
        return;
    }
    
    // Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
    showTypingIndicator();
    setTimeout(async () => {
        const response = await getAIResponse(text);
        hideTypingIndicator();
        addMessage(response, 'ai');
        speakText(response);
        updateAnswerCount();
    }, 1000 + Math.random() * 1000);
}

function extractImagePrompt(text) {
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù†Øµ
    const patterns = [
        /Ø£Ù†Ø´Ø¦ Ù„ÙŠ ØµÙˆØ±Ø© (?:Ù„Ù€|Ù„)?(.+)/i,
        /Ø§ØµÙ†Ø¹ (?:Ù„ÙŠ)? ØµÙˆØ±Ø© (?:Ù„Ù€|Ù„)?(.+)/i,
        /Ø§Ø±Ø³Ù… (?:Ù„ÙŠ)? ØµÙˆØ±Ø© (?:Ù„Ù€|Ù„)?(.+)/i,
        /ØµÙˆØ±Ø© (?:Ù„Ù€|Ù„)?(.+)/i,
        /Ø£Ù†Ø´Ø¦ (.+) ØµÙˆØ±Ø©/i,
        /create (?:a)? picture of (.+)/i,
        /generate (?:a)? image of (.+)/i
    ];
    
    for (const pattern of patterns) {
        const match = text.match(pattern);
        if (match && match[1]) {
            return match[1].trim();
        }
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ·Ø§Ø¨Ù‚ Ø£ÙŠ Ù†Ù…Ø·ØŒ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†Øµ ÙƒØ§Ù…Ù„Ø§Ù‹
    return text.replace(/Ø£Ù†Ø´Ø¦|Ø§ØµÙ†Ø¹|Ø§Ø±Ø³Ù…|ØµÙˆØ±Ø©|Ù„ÙŠ|Ù„Ù€|Ù„|create|generate|image|picture|of/gi, '').trim();
}

async function getAIResponse(input) {
    const normalizedInput = input.toLowerCase();
    
    // Ø±Ø¯ÙˆØ¯ Ø®Ø§ØµØ©
    if (normalizedInput.includes('Ø´ÙƒØ±') || normalizedInput.includes('Ù…Ù…ØªØ§Ø²') || 
        normalizedInput.includes('Ø±Ø§Ø¦Ø¹') || normalizedInput.includes('Ø¬Ù…ÙŠÙ„')) {
        return `Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ğŸ¤—\nØ³Ø¹ÙŠØ¯ Ù„Ø£Ù†Ù†ÙŠ Ø§Ø³ØªØ·Ø¹Øª Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ.\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„ÙŠÙŠ Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù†:\nğŸ“š Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…ÙƒØªØ¨Ø©\nğŸ–¼ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ\nğŸ•’ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ù‚ÙŠÙ‚\nğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰\n\nÙ…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø§Ù„Ø¢Ù†ØŸ`;
    }
    
    if (normalizedInput.includes('Ù…Ø±Ø­Ø¨') || normalizedInput.includes('Ø§Ù‡Ù„Ø§') || 
        normalizedInput.includes('Ø§Ù„Ø³Ù„Ø§Ù…') || normalizedInput.includes('Ø§Ù‡Ù„ÙŠÙ†')) {
        return `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ğŸŒŸ\nØ£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ± ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø±.\n\nğŸš€ **Ù‚Ø¯Ø±Ø§ØªÙŠ:**\nâ€¢ Ø¥Ø®Ø¨Ø§Ø±Ùƒ Ø¨Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¯Ù‚ÙŠÙ‚\nâ€¢ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ\nâ€¢ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªÙŠ ØªØ±Ø³Ù„Ù‡Ø§ Ù„ÙŠ\nâ€¢ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù† Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆØ§Ù„ÙƒØªØ¨\nâ€¢ Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù† Ø­ÙˆØ§Ø±Ø§ØªÙ†Ø§ Ù„Ø£ØµØ¨Ø­ Ø£ÙØ¶Ù„\nâ€¢ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹Ùƒ ØµÙˆØªÙŠØ§Ù‹ ğŸ¤\n\nğŸ’¡ **Ø¬Ø±Ø¨:** "Ù…Ø§ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†ØŸ" Ø£Ùˆ "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ù‚Ø·Ø©"`;
    }
    
    if (normalizedInput.includes('Ø§Ø³Ù…Ùƒ') || normalizedInput.includes('Ù…Ù† Ø£Ù†Øª')) {
        return `ğŸ¤– **Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ø°ÙƒÙŠ**\n\nâœ¨ **Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 2.0 Ø§Ù„Ù…ØªÙ‚Ø¯Ù…\nğŸ§  **Ø§Ù„ØªÙ‚Ù†ÙŠØ©:** Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ·ÙˆØ±\nğŸ¯ **Ø§Ù„Ù‡Ø¯Ù:** Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙƒÙ„ Ù…Ø§ ÙŠØ®Øµ Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø©\nğŸ–¼ï¸ **Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:** Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ø°ÙƒÙŠØ©ØŒ ØªØ­Ù„ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ØŒ Ø±Ø¯ÙˆØ¯ Ø°ÙƒÙŠØ©\n\nğŸ’¡ Ø£ØªØ¹Ù„Ù… Ù…Ù† ÙƒÙ„ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ø£ØµØ¨Ø­ Ø£ÙƒØ«Ø± Ø°ÙƒØ§Ø¡Ù‹!`;
    }
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø®Ø²Ù†Ø©
    for (const [question, answers] of Object.entries(aiKnowledge)) {
        if (normalizedInput.includes(question.toLowerCase()) || 
            question.toLowerCase().includes(normalizedInput)) {
            const answerArray = Array.isArray(answers) ? answers : [answers];
            return answerArray[Math.floor(Math.random() * answerArray.length)];
        }
    }
    
    // Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©
    const defaultResponses = [
        `ğŸ¤” **Ø³Ø¤Ø§Ù„ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù…!**\n\nÙ„Ø³Øª Ù…ØªØ£ÙƒØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\n1. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ÙƒØªØ¨Ø©\n2. ØªØ¯Ø±ÙŠØ¨ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†\n3. ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©\n\nğŸ’¡ **Ø§Ù‚ØªØ±Ø§Ø­:** Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø°ÙƒØ§Ø¡" Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©!`,

        `ğŸ§  **ØªÙÙƒÙŠØ±ÙŠ:** ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ÙˆÙ‚ÙŠÙ…!\n\nğŸ” **Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:**\nâ€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ù„Ù…Ø¹Ø±ÙØªÙŠ\nâ€¢ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ù…ÙƒØªØ¨Ø©\nâ€¢ ØªØ¬Ø±Ø¨Ø© Ø³Ø¤Ø§Ù„ Ø¢Ø®Ø± Ø¹Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±\n\nğŸ¯ **Ø¬Ø±Ø¨:** "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© ØªÙˆØ¶Ø­ ÙÙƒØ±ØªÙŠ"`,

        `ğŸŒŸ **Ø³Ø¤Ø§Ù„ Ø±Ø§Ø¦Ø¹!**\nÙ„Ù„Ø£Ø³Ù Ù„Ø§ Ø£Ù…Ù„Ùƒ Ø¥Ø¬Ø§Ø¨Ø© ÙƒØ§ÙÙŠØ© Ø¹Ù†Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹.\n\nğŸš€ **Ù…Ø¹Ø§Ù‹ ÙŠÙ…ÙƒÙ†Ù†Ø§:**\n1. Ø§Ø³ØªØ®Ø¯Ø§Ù… "ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø°ÙƒØ§Ø¡" Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ\n2. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©\n3. Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„Ù„ÙÙƒØ±Ø©\n\nğŸ’ª **Ù…Ø¹Ø§Ù‹ Ù†ØµÙ†Ø¹ Ø°ÙƒØ§Ø¡Ù‹ ÙŠØªØ·ÙˆØ±!**`,

        `ğŸ” **Ø¨Ø­Ø«ÙŠ:** Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ ÙŠØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.\n\nğŸ“š **Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:**\nâ€¢ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ù…ÙƒØªØ¨Ø©\nâ€¢ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„\nâ€¢ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªØ®ØµØµØ©\n\nğŸ–¼ï¸ **Ø¨Ø¯ÙŠÙ„:** Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ØŸ`
    ];
    
    return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
}

function addMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    const time = new Date().toLocaleTimeString('ar-SA', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ
    let formattedText = text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>')
        .replace(/(\d+)\./g, '<strong>$1.</strong>')
        .replace(/âœ…/g, '<span style="color: var(--success)">âœ…</span>')
        .replace(/ğŸ¨/g, '<span style="color: #ff6b6b">ğŸ¨</span>')
        .replace(/ğŸ¤–/g, '<span style="color: var(--ai-color)">ğŸ¤–</span>')
        .replace(/ğŸ’¡/g, '<span style="color: var(--warning)">ğŸ’¡</span>');
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
    if (text.includes('Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ') || text.includes('Ø§Ù„ØªØ§Ø±ÙŠØ®')) {
        const timeMatch = text.match(/ğŸ•’.*?Ø§Ù„Ø³Ø¹Ø©/s);
        if (timeMatch) {
            formattedText = formattedText.replace(
                timeMatch[0],
                `<div class="datetime-info">${timeMatch[0]}</div>`
            );
        }
    }
    
    messageDiv.innerHTML = `
        <div class="avatar ${sender}-avatar-small">
            ${sender === 'ai' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>'}
        </div>
        <div class="message-content">
            <div class="message-text">${formattedText}</div>
            <div class="message-actions">
                <div class="action-icon" onclick="copyMessage(this)">
                    <i class="fas fa-copy"></i>
                </div>
                <div class="action-icon" onclick="likeMessage(this)">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="action-icon" onclick="shareMessage(this, '${text.replace(/'/g, "\\'")}')">
                    <i class="fas fa-share-alt"></i>
                </div>
            </div>
            <div class="message-time">${time}</div>
        </div>
    `;
    
    chatContainer.appendChild(messageDiv);
    
    // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù†Ù‡Ø§ÙŠØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø³Ù„Ø³
    setTimeout(() => {
        chatContainer.scrollTo({
            top: chatContainer.scrollHeight,
            behavior: 'smooth'
        });
    }, 100);
    
    // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
    conversationHistory.push({
        text,
        sender,
        time: new Date().toISOString(),
        id: Date.now()
    });
    
    // Ø­ÙØ¸ ÙÙŠ localStorage (Ø¢Ø®Ø± 100 Ø±Ø³Ø§Ù„Ø©)
    if (conversationHistory.length > 100) {
        conversationHistory = conversationHistory.slice(-100);
    }
    localStorage.setItem('conversation_history', JSON.stringify(conversationHistory));
}

function addImageMessage(src, sender, caption = '') {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    const time = new Date().toLocaleTimeString('ar-SA', {
        hour: '2-digit',
        minute: '2-digit'
    });
    
    messageDiv.innerHTML = `
        <div class="avatar ${sender}-avatar-small">
            ${sender === 'ai' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>'}
        </div>
        <div class="message-content">
            <div class="image-container">
                <img src="${src}" alt="${caption}" class="message-image" onclick="openImageModal('${src}')">
                ${caption ? `<div class="image-caption">${caption}</div>` : ''}
            </div>
            <div class="message-actions">
                <div class="action-icon" onclick="downloadImage('${src}', 'ai_image_${Date.now()}')">
                    <i class="fas fa-download"></i>
                </div>
                <div class="action-icon" onclick="shareImage('${src}', '${caption}')">
                    <i class="fas fa-share-alt"></i>
                </div>
                <div class="action-icon" onclick="regenerateImage('${caption.replace('Ø£Ù†Ø´Ø£ØªÙ‡Ø§ Ù…Ù†: ', '')}')">
                    <i class="fas fa-redo"></i>
                </div>
            </div>
            <div class="message-time">${time}</div>
        </div>
    `;
    
    chatContainer.appendChild(messageDiv);
    
    setTimeout(() => {
        chatContainer.scrollTo({
            top: chatContainer.scrollHeight,
            behavior: 'smooth'
        });
    }, 100);
}

// ====== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØµÙˆØ± ======
function openImageModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    
    modalImg.src = src;
    modal.style.display = 'flex';
    
    // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    document.body.style.overflow = 'hidden';
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

function downloadImage(src, filename) {
    const a = document.createElement('a');
    a.href = src;
    a.download = `${filename}.jpg`;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    
    showToast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©', 'success');
}

function shareImage(src, caption = '') {
    if (navigator.share) {
        navigator.share({
            title: 'ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
            text: caption || 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø³Ø§Ø¹Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ø°ÙƒÙŠ',
            url: src
        }).then(() => {
            console.log('âœ… ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
        }).catch((error) => {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', error);
            copyToClipboard(src);
        });
    } else {
        copyToClipboard(src);
    }
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©', 'success');
    }).catch(() => {
        // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showToast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·', 'success');
    });
}

function regenerateImage(prompt) {
    if (prompt && prompt.trim()) {
        generateRealImage(prompt.trim());
    } else {
        showToast('Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§', 'warning');
    }
}

// ====== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ======
function showTypingIndicator() {
    typingIndicator.style.display = 'flex';
    
    setTimeout(() => {
        chatContainer.scrollTo({
            top: chatContainer.scrollHeight,
            behavior: 'smooth'
        });
    }, 100);
}

function hideTypingIndicator() {
    typingIndicator.style.display = 'none';
}

function showHelp() {
    const helpText = `ğŸš€ **Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„:**
    
ğŸ¯ **Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
â€¢ "Ø§Ù„ÙˆÙ‚Øª" Ø£Ùˆ "Ø§Ù„ØªØ§Ø±ÙŠØ®" - Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
â€¢ "Ø£Ù†Ø´Ø¦ ØµÙˆØ±Ø© [ÙˆØµÙ]" - Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
â€¢ "Ù…Ø³Ø§Ø¹Ø¯Ø©" - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
â€¢ "Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©" - Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©

ğŸ–¼ï¸ **Ù…ÙŠØ²Ø© Ø§Ù„ØµÙˆØ±:**
1. Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ± Ù…Ù† Ø§Ù„Ù†Øµ
2. ØªØ­Ù…ÙŠÙ„ ØµÙˆØ± Ù„Ù„ØªØ­Ù„ÙŠÙ„
3. Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± Ø¨ØªÙƒØ¨ÙŠØ±
4. ØªØ­Ù…ÙŠÙ„ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±
5. Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±

ğŸ¤ **Ù…ÙŠØ²Ø© Ø§Ù„ØµÙˆØª:**
â€¢ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„ØªØ³Ø¬ÙŠÙ„
â€¢ Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ
â€¢ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙƒØªØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
â€¢ ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ

âš¡ **Ø§Ø®ØªØµØ§Ø±Ø§Øª:**
â€¢ Enter - Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
â€¢ Ctrl/Cmd + K - Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
â€¢ Esc - Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ±ÙƒÙŠØ²

ğŸ”§ **Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:**
â€¢ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø± (ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†)
â€¢ ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª
â€¢ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
â€¢ Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©

ğŸ’¡ **Ù†ØµØ§Ø¦Ø­:**
â€¢ ÙƒÙ† Ù…Ø­Ø¯Ø¯Ø§Ù‹ ÙÙŠ Ø£ÙˆØµØ§Ù Ø§Ù„ØµÙˆØ±
â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ù„Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ø£ÙØ¶Ù„
â€¢ Ø³Ø§Ø¹Ø¯ ÙÙŠ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø°ÙƒØ§Ø¡ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø¯ÙˆØ¯
â€¢ Ø¬Ø±Ø¨ Ø£ÙˆØ§Ù…Ø± Ù…Ø®ØªÙ„ÙØ© Ù„Ø§ÙƒØªØ´Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª`;
    
    addMessage(helpText, 'ai');
}

function copyMessage(element) {
    const messageText = element.closest('.message-content').querySelector('.message-text').textContent;
    navigator.clipboard.writeText(messageText).then(() => {
        showToast('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
    }).catch(() => {
        showToast('âŒ ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
    });
}

function likeMessage(element) {
    const icon = element.querySelector('i');
    if (icon.classList.contains('fas')) {
        icon.className = 'fas fa-heart';
        element.style.background = 'var(--danger)';
        showToast('â¤ï¸ Ø´ÙƒØ±Ø§Ù‹ Ù„Ù„Ø¥Ø¹Ø¬Ø§Ø¨!', 'success');
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¹Ø¬Ø§Ø¨ Ù„Ù„Ø³Ø¬Ù„
        const messageContent = element.closest('.message-content');
        const messageText = messageContent.querySelector('.message-text').textContent;
        saveLike(messageText);
    }
}

function shareMessage(element, text) {
    if (navigator.share) {
        navigator.share({
            title: 'Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø°ÙƒØ§Ø¡ Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø±',
            text: text.substring(0, 100) + '...',
            url: window.location.href
        }).then(() => {
            console.log('âœ… ØªÙ…Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
        }).catch((error) => {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', error);
            copyMessage(element);
        });
    } else {
        copyMessage(element);
    }
}

function saveLike(messageText) {
    const likes = JSON.parse(localStorage.getItem('messageLikes') || '[]');
    likes.push({
        message: messageText.substring(0, 200),
        timestamp: new Date().toISOString()
    });
    
    if (likes.length > 100) {
        likes.shift();
    }
    
    localStorage.setItem('messageLikes', JSON.stringify(likes));
}

function toggleTheme() {
    const body = document.body;
    const isDark = body.classList.toggle('light-theme');
    
    currentTheme = isDark ? 'light' : 'dark';
    
    if (isDark) {
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ';
        showToast('â˜€ï¸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ', 'info');
    } else {
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ';
        showToast('ğŸŒ™ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ', 'info');
    }
    
    localStorage.setItem('theme', currentTheme);
}

function loadSavedTheme() {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    currentTheme = savedTheme;
    
    if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ';
    } else {
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ';
    }
}

function showMemoryStatus() {
    const memoryUsage = Math.floor(Math.random() * 20) + 75; // 75-95%
    const knowledgeCount = Object.keys(aiKnowledge).length;
    const totalMessages = conversationHistory.length;
    
    const statusMessage = `ğŸ§  **Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:**
    
ğŸ“Š **Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:**
â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${memoryUsage}%
â€¢ Ø§Ù„Ù…Ø¹Ø§Ø±Ù Ø§Ù„Ù…Ø®Ø²Ù†Ø©: ${knowledgeCount}
â€¢ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ù†Ø´Ø£Ø©: ${imagesGenerated}
â€¢ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙƒÙ„ÙŠØ©: ${totalMessages}
â€¢ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†: ${activeUsers.size}

âš¡ **Ø§Ù„Ø£Ø¯Ø§Ø¡:** ${memoryUsage > 90 ? 'ğŸŸ¡ Ø¬ÙŠØ¯' : 'ğŸŸ¢ Ù…Ù…ØªØ§Ø²'}
ğŸ¯ **Ø§Ù„ÙƒÙØ§Ø¡Ø©:** ${memoryUsage > 85 ? 'Ø¹Ø§Ù„ÙŠØ©' : 'Ù…Ù…ØªØ§Ø²Ø©'}

ğŸ”§ **Ø§Ù„ØªÙˆØµÙŠØ§Øª:**
${memoryUsage > 90 ? 'â€¢ ÙŠÙ…ÙƒÙ† Ù…Ø³Ø­ Ø°Ø§ÙƒØ±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª\n' : ''}
â€¢ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ!
â€¢ Ø¬Ø§Ù‡Ø² Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©`;

    addMessage(statusMessage, 'ai');
}

function clearChat() {
    // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙ‚Ø·
    const initialMessage = chatContainer.querySelector('.message.ai');
    chatContainer.innerHTML = '';
    
    if (initialMessage) {
        chatContainer.appendChild(initialMessage);
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø¬Ù„
    conversationHistory = [];
    localStorage.removeItem('conversation_history');
    
    showToast('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', 'success');
}

function exportConversation() {
    const conversationText = conversationHistory
        .map(msg => {
            const time = new Date(msg.time).toLocaleTimeString('ar-SA');
            const sender = msg.sender === 'user' ? 'ğŸ‘¤ Ø£Ù†Øª' : 'ğŸ¤– Ø§Ù„Ø°ÙƒØ§Ø¡';
            return `${sender} (${time}):\n${msg.text}\n${'-'.repeat(50)}`;
        })
        .join('\n\n');
    
    const blob = new Blob([conversationText], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Ù…Ø­Ø§Ø¯Ø«Ø©_Ù…ÙƒØªØ¨Ø©_Ø§Ù„ÙØ¬Ø±_${new Date().toISOString().split('T')[0]}.txt`;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showToast('ğŸ“¥ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

function sendSuggestion(text) {
    userInput.value = text;
    processUserInput();
}

// ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© ======
function loadDefaultKnowledge() {
    aiKnowledge = {
        'ÙƒØªØ§Ø¨': [
            'ğŸ“š **Ø¹Ù† Ø§Ù„ÙƒØªØ¨ ÙÙŠ Ù…ÙƒØªØ¨ØªÙ†Ø§:**\nØ§Ù„Ù…ÙƒØªØ¨Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£ÙƒØ«Ø± Ù…Ù† 50,000 ÙƒØªØ§Ø¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙŠ Ù…Ø®ØªÙ„Ù Ø§Ù„ØªØ®ØµØµØ§Øª. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:\nâ€¢ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ\nâ€¢ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©\nâ€¢ Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ†\nâ€¢ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©\n\nğŸ’¡ **Ù†ØµÙŠØ­Ø©:** Ø§Ø³ØªØ®Ø¯Ù… Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ØªØµÙÙŠØ© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø§ ØªØ±ÙŠØ¯ Ø¨Ø³Ø±Ø¹Ø©!',
            'ğŸ” **Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨:**\n1. Ø§Ø°Ù‡Ø¨ Ù„Ù‚Ø³Ù… "Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…"\n2. Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©\n3. Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨\n4. Ø§Ø³ØªØ®Ø¯Ù… Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØ±Ø²\n\nğŸ“– **Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:**\nâ€¢ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒØªØ¨\nâ€¢ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±\nâ€¢ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©\nâ€¢ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡'
        ],
        'Ù‚Ø±Ø§Ø¡Ø©': [
            'ğŸ“– **Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙØ¹Ø§Ù„Ø©:**\n1. Ø­Ø¯Ø¯ Ù‡Ø¯ÙØ§Ù‹ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©\n2. Ø§Ø®ØªØ± ÙˆÙ‚ØªØ§Ù‹ Ø«Ø§Ø¨ØªØ§Ù‹ ÙŠÙˆÙ…ÙŠØ§Ù‹\n3. Ø§Ø¨Ø¯Ø£ Ø¨Ù€ 20 ØµÙØ­Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹\n4. Ø®Ø° Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©\n5. Ù†Ø§Ù‚Ø´ Ù…Ø§ Ù‚Ø±Ø£ØªÙ‡ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†\n\nğŸ¯ **Ø§Ù„ØªØ­Ø¯ÙŠ:** Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© 30 ÙŠÙˆÙ…Ø§Ù‹!',
            'ğŸš€ **Ù„ØªØ·ÙˆÙŠØ± Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:**\nâ€¢ Ø§Ù‚Ø±Ø£ Ù…Ø§ ØªØ­Ø¨ Ø£ÙˆÙ„Ø§Ù‹\nâ€¢ Ø§Ø­Ù…Ù„ ÙƒØªØ§Ø¨Ø§Ù‹ Ù…Ø¹Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹\nâ€¢ Ø§Ù†Ø¶Ù… Ù„Ù†Ø§Ø¯ÙŠ Ù‚Ø±Ø§Ø¡Ø©\nâ€¢ Ø³Ø¬Ù„ ØªÙ‚Ø¯Ù…Ùƒ\nâ€¢ ÙƒØ§ÙØ¦ Ù†ÙØ³Ùƒ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²\n\nğŸ“Š **Ø¥Ø­ØµØ§Ø¦ÙŠØ©:** Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© 30 Ø¯Ù‚ÙŠÙ‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ ØªØ¹Ø§Ø¯Ù„ 24 ÙƒØªØ§Ø¨Ø§Ù‹ ÙÙŠ Ø§Ù„Ø³Ù†Ø©!'
        ],
        'Ù…ÙƒØªØ¨Ø©': [
            'ğŸ›ï¸ **Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙØ¬Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠØ©:**\nÙ…Ø¤Ø³Ø³Ø© Ø«Ù‚Ø§ÙÙŠØ© Ø±Ù‚Ù…ÙŠØ© ØªÙ‡Ø¯Ù Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø¹Ø±ÙØ©.\n\nâœ¨ **Ø§Ù„Ø®Ø¯Ù…Ø§Øª:**\nâ€¢ Ø§Ù„Ø¥Ø¹Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©\nâ€¢ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©\nâ€¢ Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ©\nâ€¢ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠØ©\nâ€¢ Ø§Ù„Ø£Ø¨Ø­Ø§Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠØ©\n\nâ° **Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:** 24/7',
            'ğŸŒ **Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©:**\nÙ…Ù†ØµØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ØªØ¹Ù„Ù…:\nâ€¢ ÙƒØªØ¨ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©\nâ€¢ Ù…ÙˆØ§Ø¯ ØµÙˆØªÙŠØ© ÙˆÙ…Ø±Ø¦ÙŠØ©\nâ€¢ Ø£Ø¯ÙˆØ§Øª Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…Ø©\nâ€¢ Ù…Ø¬ØªÙ…Ø¹ ØªÙØ§Ø¹Ù„ÙŠ\nâ€¢ ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©\n\nğŸ“ **Ø±Ø¤ÙŠØªÙ†Ø§:** Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙÙŠ Ù…ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¬Ù…ÙŠØ¹'
        ],
        'Ø¯ÙˆØ±Ø§Øª': [
            'ğŸ“ **Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:**\n1. Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©\n2. ÙÙ† Ø§Ù„ØªÙ„Ø®ÙŠØµ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„\n3. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠ\n4. Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©\n5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ù‚Ø±Ø§Ø¡\n\nâœ… **Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆÙ…Ø¹ØªÙ…Ø¯Ø©**',
            'ğŸ“š **Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ…Ø±:**\nâ€¢ Ø¯ÙˆØ±Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©\nâ€¢ ÙˆØ±Ø´ Ø¹Ù…Ù„ ØªÙØ§Ø¹Ù„ÙŠØ©\nâ€¢ Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø©\nâ€¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø´Ø®ØµÙŠØ©\nâ€¢ Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†\n\nğŸ”— **Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:** Ø³Ø¬Ù„ ÙÙŠ Ù‚Ø³Ù… "Ø§Ù„ØªØ¹Ù„Ù…" Ø¨Ø§Ù„Ù…Ù†ØµØ©'
        ]
    };
    
    knowledgeCount.textContent = Object.keys(aiKnowledge).length;
}

function updateStats() {
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù…Ø­Ø§ÙƒØ§Ø© - ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Firebase)
    const randomUsers = Math.floor(Math.random() * 5) + 12; // 12-16 Ù…Ø³ØªØ®Ø¯Ù…
    activeUsersCount.textContent = randomUsers;
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§Ø±Ù
    knowledgeCount.textContent = Object.keys(aiKnowledge).length;
    
    // ØªØ­Ø¯ÙŠØ« Ø¯Ù‚Ø© Ø§Ù„Ø°ÙƒØ§Ø¡
    const accuracy = 85 + Math.floor(Math.random() * 10); // 85-95%
    document.getElementById('accuracyRate').textContent = `${accuracy}%`;
    
    console.log('ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©');
}

function updateAnswerCount() {
    let answersToday = parseInt(localStorage.getItem('answersToday') || '0');
    answersToday++;
    localStorage.setItem('answersToday', answersToday.toString());
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ù†ØµØ± Ù„Ø¹Ø±Ø¶Ù‡
    const dailyAnswersEl = document.getElementById('dailyAnswers');
    if (dailyAnswersEl) {
        dailyAnswersEl.textContent = answersToday;
    }
}

function loadConversationHistory() {
    try {
        const saved = localStorage.getItem('conversation_history');
        if (saved) {
            conversationHistory = JSON.parse(saved);
            console.log('ğŸ“– ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:', conversationHistory.length, 'Ø±Ø³Ø§Ù„Ø©');
            
            // ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª
            if (conversationHistory.length > 0 && chatContainer.children.length <= 1) {
                // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 10 Ø±Ø³Ø§Ø¦Ù„
                const recentMessages = conversationHistory.slice(-10);
                recentMessages.forEach(msg => {
                    if (msg.sender !== 'ai' || msg.text.includes('Ù…Ø±Ø­Ø¨Ø§Ù‹')) {
                        addMessage(msg.text, msg.sender);
                    }
                });
            }
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„:', error);
        conversationHistory = [];
    }
}

// ====== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª ======
function showToast(message, type = 'success') {
    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªØ¨Ù„ÙŠØº Ø³Ø§Ø¨Ù‚
    toast.classList.remove('show');
    
    // Ø¥Ø¹Ø·Ø§Ø¡ ÙˆÙ‚Øª Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    setTimeout(() => {
        toastMessage.textContent = message;
        
        let iconClass = 'fa-check-circle';
        let className = 'toast-success';
        
        switch(type) {
            case 'error':
                iconClass = 'fa-times-circle';
                className = 'toast-error';
                break;
            case 'warning':
                iconClass = 'fa-exclamation-triangle';
                className = 'toast-warning';
                break;
            case 'info':
                iconClass = 'fa-info-circle';
                className = 'toast-info';
                break;
        }
        
        toastIcon.className = `fas ${iconClass}`;
        toast.className = `toast ${className}`;
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨Ù„ÙŠØº
        setTimeout(() => {
            toast.classList.add('show');
        }, 100);
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨Ù„ÙŠØº Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†
        setTimeout(() => {
            toast.classList.remove('show');
        }, 4000);
    }, 100);
}

// ====== Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ======
function setupEventListeners() {
    console.log('ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...');
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    sendButton.addEventListener('click', () => processUserInput());
    
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            processUserInput();
        }
    });
    
    // ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
    userInput.addEventListener('focus', () => {
        userInput.style.boxShadow = '0 0 0 3px rgba(123, 104, 238, 0.2)';
    });
    
    userInput.addEventListener('blur', () => {
        userInput.style.boxShadow = '';
    });
    
    // Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + K Ù„Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            userInput.focus();
        }
        
        // Esc Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ±ÙƒÙŠØ²
        if (e.key === 'Escape') {
            userInput.blur();
        }
        
        // Ctrl/Cmd + / Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        if ((e.ctrlKey || e.metaKey) && e.key === '/') {
            e.preventDefault();
            showHelp();
        }
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.getElementById('imageModal').addEventListener('click', (e) => {
        if (e.target.id === 'imageModal') {
            closeImageModal();
        }
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¤Ø´Ø± Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    voiceIndicator.addEventListener('click', (e) => {
        if (e.target.id === 'voiceIndicator' || e.target.closest('#voiceIndicator')) {
            if (isRecording && recognition) {
                recognition.stop();
            }
        }
    });
    
    // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    const savedVoiceEnabled = localStorage.getItem('voiceEnabled');
    if (savedVoiceEnabled !== null) {
        isVoiceEnabled = savedVoiceEnabled === 'true';
        if (!isVoiceEnabled) {
            voiceToggleBtn.innerHTML = '<span>ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª</span><i class="fas fa-volume-up"></i>';
        }
    }
    
    console.log('âœ… Ø§ÙƒØªÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«');
}

// ====== Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯Ø« ======
function speakText(text) {
    if (!isVoiceEnabled) return;
    
    if ('speechSynthesis' in window) {
        // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙƒÙ„Ø§Ù… Ø³Ø§Ø¨Ù‚
        speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ar-SA';
        utterance.rate = 1.0;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        
        // Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡
        setTimeout(() => {
            speechSynthesis.speak(utterance);
        }, 300);
    }
}

// ====== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ======
document.addEventListener('DOMContentLoaded', init);

// Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
window.toggleVoiceRecording = toggleVoiceRecording;
window.toggleVoice = toggleVoice;
window.toggleAttachment = toggleAttachment;
window.toggleTheme = toggleTheme;
window.sendSuggestion = sendSuggestion;
window.openImageModal = openImageModal;
window.closeImageModal = closeImageModal;
window.downloadImage = downloadImage;
window.shareImage = shareImage;
window.regenerateImage = regenerateImage;
window.copyMessage = copyMessage;
window.likeMessage = likeMessage;
window.shareMessage = shareMessage;
window.showMemoryStatus = showMemoryStatus;
window.clearChat = clearChat;
window.exportConversation = exportConversation;
window.processUserInput = processUserInput;
    </script>
</body>
</html>